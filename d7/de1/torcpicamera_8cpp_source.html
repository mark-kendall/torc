<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Torc: torcpicamera.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Torc
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d03bd041034a3e88cd281d61691321a9.html">outputs</a></li><li class="navelem"><a class="el" href="../../dir_3754304adc5e72dc4225506589d46714.html">platforms</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">torcpicamera.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d7/de1/torcpicamera_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Class TorcPiCamera</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">* This file is part of the Torc project.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">* Copyright (C) Mark Kendall 2018</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">* This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">* it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">* the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">* (at your option) any later version.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">* This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">* but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">* GNU General Public License for more details.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">* You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">* along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">* Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">* USA.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// Qt</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;QTime&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;QThread&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// Torc</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/df9/torclogging_8h.html">torclogging.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dd0/torctimer_8h.html">torctimer.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d41/torccentral_8h.html">torccentral.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dd4/torcpicamera_8h.html">torcpicamera.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d6c/torcdirectories_8h.html">torcdirectories.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">// OpenMax</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;OMX_Video.h&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// Broadcom</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;bcm_host.h&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;OMX_Broadcom.h&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a5607850813f33abc4f6bb038456a7044">   41</a></span>&#160;<span class="preprocessor">#define BROADCOM_CAMERA                &quot;OMX.broadcom.camera&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a0e23a8f888bc81dea4fd53634800fef7">   42</a></span>&#160;<span class="preprocessor">#define BROADCOM_ENCODER               &quot;OMX.broadcom.video_encode&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a9433bfd324f3e45bcc9b055c6a3f1524">   43</a></span>&#160;<span class="preprocessor">#define BROADCOM_NULLSINK              &quot;OMX.broadcom.null_sink&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a4f1bc79b124abc2a44f6a42c104a44c9">   44</a></span>&#160;<span class="preprocessor">#define BROADCOM_VIDEOSPLITTER         &quot;OMX.broadcom.video_splitter&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a3ba6874e7221f8482559cae4759d0a7e">   45</a></span>&#160;<span class="preprocessor">#define BROADCOM_IMAGEENCODER          &quot;OMX.broadcom.image_encode&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a6ab7dcbe8f8b98310bef8c23afab94a1">   46</a></span>&#160;<span class="preprocessor">#define CAMERA_SHARPNESS               0   // -100-&gt;100</span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a97ab08f8684b12e9d31a4b1c82fbd760">   47</a></span>&#160;<span class="preprocessor">#define CAMERA_CONTRAST                0   // -100-&gt;100</span></div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a052cb741945a6d84a542685794448caa">   48</a></span>&#160;<span class="preprocessor">#define CAMERA_BRIGHTNESS              50  //  0-&gt;100</span></div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a618416aa7755b2cd0a357ed2306e8d22">   49</a></span>&#160;<span class="preprocessor">#define CAMERA_SATURATION              0   // -100-&gt;100</span></div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#aa275da893a8c7a58204e73370b35f8cd">   50</a></span>&#160;<span class="preprocessor">#define CAMERA_METERING                OMX_MeteringModeAverage</span></div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a120561ba8b7e7bc0cad270c636bfd8c1">   51</a></span>&#160;<span class="preprocessor">#define CAMERA_EXPOSURE                OMX_ExposureControlAuto</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a15dd304042e8813e5ddb1d01cd17d894">   52</a></span>&#160;<span class="preprocessor">#define CAMERA_EXPOSURE_COMPENSATION   0   // -10-&gt;10</span></div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a86136ee5adbac1d39308d89bdf1ec051">   53</a></span>&#160;<span class="preprocessor">#define CAMERA_SHUTTER_SPEED_AUTO      OMX_TRUE</span></div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#add5daa9b1390a2eec248d334d39303ff">   54</a></span>&#160;<span class="preprocessor">#define CAMERA_SHUTTER_SPEED           1.0/8.0</span></div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#af9c832629487bda061b70df0c8f1447f">   55</a></span>&#160;<span class="preprocessor">#define CAMERA_ISO_AUTO                OMX_TRUE</span></div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#af380e1df9742759f4dc990701f322a99">   56</a></span>&#160;<span class="preprocessor">#define CAMERA_ISO                     100 // 100-&gt;800</span></div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a4ba947935dbf8483befe1ceb0daf7f25">   57</a></span>&#160;<span class="preprocessor">#define CAMERA_WHITE_BALANCE           OMX_WhiteBalControlAuto</span></div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a5f90851745e92ef6f519f439376a7412">   58</a></span>&#160;<span class="preprocessor">#define CAMERA_FRAME_STABILIZATION     OMX_FALSE</span></div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#af0270a47d4e04a0c6a88bed5aeee7b59">   59</a></span>&#160;<span class="preprocessor">#define CAMERA_WHITE_BALANCE_RED_GAIN  1000</span></div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a547b331ceb80a6a72367643adfab62ed">   60</a></span>&#160;<span class="preprocessor">#define CAMERA_WHITE_BALANCE_BLUE_GAIN 1000</span></div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a553c6df06d2cf696ff202fa00962059e">   61</a></span>&#160;<span class="preprocessor">#define CAMERA_IMAGE_FILTER            OMX_ImageFilterNone</span></div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a4290f8ebc7936700fe1b22ceb49efd58">   62</a></span>&#160;<span class="preprocessor">#define CAMERA_MIRROR                  OMX_MirrorNone</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#af378bb0691606be9f91323188b835ac9">   63</a></span>&#160;<span class="preprocessor">#define CAMERA_ROTATION                0</span></div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#af12a6688fd1fd42ed4e2a9285b028267">   64</a></span>&#160;<span class="preprocessor">#define CAMERA_COLOR_ENABLE            OMX_FALSE</span></div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#aaf50db39b2168af3a1e4c948834ba7ea">   65</a></span>&#160;<span class="preprocessor">#define CAMERA_COLOR_U                 128</span></div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#abb7c6eb5f47898443f12cfd79e67e91b">   66</a></span>&#160;<span class="preprocessor">#define CAMERA_COLOR_V                 128</span></div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#af419407f055801805856c57d9ef98593">   67</a></span>&#160;<span class="preprocessor">#define CAMERA_NOISE_REDUCTION         OMX_TRUE</span></div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a0e41e09234d05e2ed0ecf98bbc55e9be">   68</a></span>&#160;<span class="preprocessor">#define CAMERA_ROI_TOP                 0</span></div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a0cc36f01104ed3b4e56ab1a429010b1b">   69</a></span>&#160;<span class="preprocessor">#define CAMERA_ROI_LEFT                0</span></div><div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a862deba4a0034a552002ca4162f6c676">   70</a></span>&#160;<span class="preprocessor">#define CAMERA_ROI_WIDTH               100</span></div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#adac374f3533dc8b2ab8fa4a4f42c4706">   71</a></span>&#160;<span class="preprocessor">#define CAMERA_ROI_HEIGHT              100</span></div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a18aa65f8c3dd74eabdd406eefdfc03a0">   72</a></span>&#160;<span class="preprocessor">#define CAMERA_DRC                     OMX_DynRangeExpOff // Off/Low/Medium/High</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a5a4b2e687194b467bc05931c77e9dd8a">   74</a></span>&#160;<span class="preprocessor">#define ENCODER_QP                     OMX_FALSE</span></div><div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#abda579266812efec4ac60c130cbd54b5">   75</a></span>&#160;<span class="preprocessor">#define ENCODER_QP_I                   0</span></div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#aac8461b95883385ccbd0b39303e746c6">   76</a></span>&#160;<span class="preprocessor">#define ENCODER_QP_P                   0</span></div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a9594030c74b200cc53279ce37524fc91">   77</a></span>&#160;<span class="preprocessor">#define ENCODER_SEI                    OMX_FALSE</span></div><div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a66a6f9f928bdfe2a5c1abf6d268e9ce8">   78</a></span>&#160;<span class="preprocessor">#define ENCODER_EEDE                   OMX_FALSE</span></div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#ac3439ee3abb76c10961f60f007d10647">   79</a></span>&#160;<span class="preprocessor">#define ENCODER_EEDE_LOSS_RATE         0</span></div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a037c02f4478d15850c451dda15bac9e8">   80</a></span>&#160;<span class="preprocessor">#define ENCODER_INLINE_HEADERS         OMX_TRUE</span></div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#a853445f1aeec2ca3107cb20ff83d56e3">   81</a></span>&#160;<span class="preprocessor">#define ENCODER_SPS_TIMING             OMX_TRUE</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#ac3ec403f5d031aa8d9342e78208da03c">TorcPiCamera::gPiCameraDetected</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="../../da/da1/class_torc_pi_camera.html#a9cc4ad4c7af561dc122b13f82896c99b">   85</a></span>&#160;<a class="code" href="../../da/da1/class_torc_pi_camera.html#a9cc4ad4c7af561dc122b13f82896c99b">TorcPiCamera::TorcPiCamera</a>(<span class="keyword">const</span> <a class="code" href="../../da/dfa/class_torc_camera_params.html">TorcCameraParams</a> &amp;Params)</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  : <a class="code" href="../../d3/dfd/class_torc_camera_device.html">TorcCameraDevice</a>(Params),</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    m_cameraType(Unknown),</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    m_stillsEnabled(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a6bb428c1ccb88c717bfa26f1fcc7c33e">true</a>),</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    m_videoEnabled(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a6bb428c1ccb88c717bfa26f1fcc7c33e">true</a>),</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    m_core(),</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    m_camera((char*)<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a5607850813f33abc4f6bb038456a7044">BROADCOM_CAMERA</a>),</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    m_videoEncoder((char*)<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a0e23a8f888bc81dea4fd53634800fef7">BROADCOM_ENCODER</a>),</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    m_nullSink((char*)<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a9433bfd324f3e45bcc9b055c6a3f1524">BROADCOM_NULLSINK</a>),</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    m_splitter((char*)<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a4f1bc79b124abc2a44f6a42c104a44c9">BROADCOM_VIDEOSPLITTER</a>),</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    m_imageEncoder((char*)<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a3ba6874e7221f8482559cae4759d0a7e">BROADCOM_IMAGEENCODER</a>),</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    m_cameraPreviewPort(0),</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    m_cameraVideoPort(0),</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    m_videoEncoderInputPort(0),</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    m_videoEncoderOutputPort(0),</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    m_imageEncoderOutputPort(0),</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    m_splitterTunnel(&amp;m_camera, 1, OMX_IndexParamVideoInit, &amp;m_splitter, 0, OMX_IndexParamVideoInit),</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    m_videoTunnel(&amp;m_splitter, 0, OMX_IndexParamVideoInit, &amp;m_videoEncoder,  0, OMX_IndexParamVideoInit),</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    m_previewTunnel(&amp;m_camera, 0, OMX_IndexParamVideoInit, &amp;m_nullSink, 0, OMX_IndexParamVideoInit),</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    m_imageTunnel(&amp;m_splitter, 1, OMX_IndexParamVideoInit, &amp;m_imageEncoder,  0, OMX_IndexParamImageInit)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> &gt; 30 &amp;&amp; (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a989a540d79780335dfd9daa44acffd40">m_width</a> &gt; 1280 || <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a148f3d8696129cbc40de0bd5b76027f3">m_height</a> &gt; 720))</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> = 30;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Restricting camera framerate to 30fps for full HD&quot;</span>);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> &gt; 60 &amp;&amp; (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a989a540d79780335dfd9daa44acffd40">m_width</a> &gt; 720 || <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a148f3d8696129cbc40de0bd5b76027f3">m_height</a> &gt; 576))</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> = 60;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Restricting camera framerate to 60fps for partial HD&quot;</span>);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> &gt; 90)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> = 90;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Resticting camera framerate to 90fps for SD&quot;</span>);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// encoder requires stride to be divisible by 32 and slice height by 16</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a3d2856c5a5ed0bb283bc02f834796bca">m_stride</a>      = (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a3d2856c5a5ed0bb283bc02f834796bca">m_stride</a> + 31) &amp; ~31;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a8074dceec0e9059ea9ccbb9c9408d2be">m_sliceHeight</a> = (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a8074dceec0e9059ea9ccbb9c9408d2be">m_sliceHeight</a> + 15) &amp; ~15;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Camera encoder stride: %1 slice height: %2&quot;</span>).arg(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a3d2856c5a5ed0bb283bc02f834796bca">m_stride</a>).arg(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a8074dceec0e9059ea9ccbb9c9408d2be">m_sliceHeight</a>));</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;}</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="../../da/da1/class_torc_pi_camera.html#a023c86ca3d03436346554fb0621dc9f0">  128</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#a023c86ca3d03436346554fb0621dc9f0">TorcPiCamera::StreamVideo</a>(<span class="keywordtype">bool</span> Video)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;{</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    (void)Video;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="../../da/da1/class_torc_pi_camera.html#aa10b4831877c9c69e9ae8e83b08408b3">  133</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#aa10b4831877c9c69e9ae8e83b08408b3">TorcPiCamera::Setup</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// NB Pi hardware is initialised in TorcPiGPIO as it is static</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (!m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#aa93dd7b7f0ad6dd542fb56c61b3b6f42">IsValid</a>() || !m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#aa93dd7b7f0ad6dd542fb56c61b3b6f42">IsValid</a>() || !m_nullSink.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#aa93dd7b7f0ad6dd542fb56c61b3b6f42">IsValid</a>() || !m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#aa93dd7b7f0ad6dd542fb56c61b3b6f42">IsValid</a>() ||</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        !m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#aa93dd7b7f0ad6dd542fb56c61b3b6f42">IsValid</a>())</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// load drivers - Broadcom specific</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> (!LoadDrivers())</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// retrieve port numbers</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    m_cameraPreviewPort      = m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ac99925fb031273d7df4e4a8b57915d92">GetPort</a>(OMX_DirOutput,  0, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    m_cameraVideoPort        = m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ac99925fb031273d7df4e4a8b57915d92">GetPort</a>(OMX_DirOutput,  1, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    m_videoEncoderInputPort  = m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ac99925fb031273d7df4e4a8b57915d92">GetPort</a>(OMX_DirInput,  0, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    m_videoEncoderOutputPort = m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ac99925fb031273d7df4e4a8b57915d92">GetPort</a>(OMX_DirOutput, 0, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    m_imageEncoderOutputPort = m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ac99925fb031273d7df4e4a8b57915d92">GetPort</a>(OMX_DirOutput, 0, OMX_IndexParamImageInit);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span> (!m_cameraVideoPort || !m_cameraPreviewPort || !m_videoEncoderInputPort || !m_videoEncoderOutputPort || !m_imageEncoderOutputPort)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// configure camera</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (!ConfigureCamera())</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// configure encoders</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (!ConfigureVideoEncoder() || !ConfigureImageEncoder())</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// create tunnels</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> (m_splitterTunnel.<a class="code" href="../../d3/db6/class_torc_o_m_x_tunnel.html#a46d70f5d4eb102addc3d1a6eae5b8861">Create</a>() || m_previewTunnel.<a class="code" href="../../d3/db6/class_torc_o_m_x_tunnel.html#a46d70f5d4eb102addc3d1a6eae5b8861">Create</a>() || m_videoTunnel.<a class="code" href="../../d3/db6/class_torc_o_m_x_tunnel.html#a46d70f5d4eb102addc3d1a6eae5b8861">Create</a>() || m_imageTunnel.<a class="code" href="../../d3/db6/class_torc_o_m_x_tunnel.html#a46d70f5d4eb102addc3d1a6eae5b8861">Create</a>())</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// set to idle</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    m_nullSink.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// set splitter to image encoder to single shot</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// there is no setting for nothing - it is either streamed (0) or 1 or more single frames</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// so request 1 frame and then ignore it</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../da/da1/class_torc_pi_camera.html#a5beab970495724e8fa8f7b78d7ba3720">EnableStills</a>(1))</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a7032657a6f07cb58524050ff4e287c71">m_stillsRequired</a> = 0;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// TODO add error checking to these calls</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// enable ports</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirOutput, 0, <span class="keyword">true</span>, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirOutput, 1, <span class="keyword">true</span>, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirInput, 0, <span class="keyword">true</span>, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirOutput, 0, <span class="keyword">true</span>, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirOutput, 1, <span class="keyword">true</span>, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirInput, 0, <span class="keyword">true</span>, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirOutput, 0, <span class="keyword">true</span>, OMX_IndexParamVideoInit, <span class="keyword">false</span>);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a0e0694ead768dfe91f2e5d2dc09c3f2a">CreateBuffers</a>(OMX_DirOutput, 0, OMX_IndexParamVideoInit, <span class="keyword">this</span>);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a8d82f9db8f4d15db9c47f31a5addaff6">WaitForResponse</a>(OMX_CommandPortEnable, m_videoEncoderOutputPort, 1000);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirInput, 0, <span class="keyword">true</span>, OMX_IndexParamImageInit);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirOutput, 0, <span class="keyword">true</span>, OMX_IndexParamImageInit, <span class="keyword">false</span>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a0e0694ead768dfe91f2e5d2dc09c3f2a">CreateBuffers</a>(OMX_DirOutput, 0, OMX_IndexParamImageInit, <span class="keyword">this</span>);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a8d82f9db8f4d15db9c47f31a5addaff6">WaitForResponse</a>(OMX_CommandPortEnable, m_imageEncoderOutputPort, 1000);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    m_nullSink.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirInput, 0, <span class="keyword">true</span>, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// set state to execute</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateExecuting);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateExecuting);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateExecuting);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateExecuting);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    m_nullSink.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateExecuting);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// enable</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    OMX_CONFIG_PORTBOOLEANTYPE capture;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(capture);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    capture.nPortIndex = m_cameraVideoPort;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    capture.bEnabled   = OMX_TRUE;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigPortCapturing, &amp;capture))</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#af21b64e6a8d51587f9e113ea5afec9ae">TorcCameraDevice::Setup</a>())</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Pi camera setup&quot;</span>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Failed to setup Pi camera&quot;</span>);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="../../da/da1/class_torc_pi_camera.html#a8bd396ed881d52cc76d57ca4748edbd4">  229</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#a8bd396ed881d52cc76d57ca4748edbd4">TorcPiCamera::Start</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;{</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// there should be one still pipelined. We need to flush it.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="../../da/da1/class_torc_pi_camera.html#a42e54a5b8d6bdf092bdabfe86e039956">StartStill</a>();</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// video is currently just on...</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    StartVideo();</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="../../da/da1/class_torc_pi_camera.html#aa5556d4abb1cf5584c0a1894f996fe63">  245</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#aa5556d4abb1cf5584c0a1894f996fe63">TorcPiCamera::BufferReady</a>(OMX_BUFFERHEADERTYPE* Buffer, quint64 Type)</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;{</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span> (!Buffer)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// Stills</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// m_stillsExpected is always &gt;= m_stillsRequired</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a75ab4292e3b5c80bff2fce9b1d6ee703">m_stillsExpected</a> &amp;&amp; ((OMX_INDEXTYPE)Type == OMX_IndexParamImageInit) &amp;&amp; (m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a9a051570f47077ed79947acc55048056">GetAvailableBuffers</a>(OMX_DirOutput, 0, OMX_IndexParamImageInit) &gt; 0))</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        ProcessStillsBuffer(Buffer);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// Video</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> (((OMX_INDEXTYPE)Type == OMX_IndexParamVideoInit) &amp;&amp; m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a9a051570f47077ed79947acc55048056">GetAvailableBuffers</a>(OMX_DirOutput, 0, OMX_IndexParamVideoInit) &gt; 0)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        ProcessVideoBuffer(Buffer);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="../../da/da1/class_torc_pi_camera.html#a42e54a5b8d6bdf092bdabfe86e039956">  273</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#a42e54a5b8d6bdf092bdabfe86e039956">TorcPiCamera::StartStill</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (!m_stillsEnabled)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    OMX_BUFFERHEADERTYPE* buffer = m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ad5eaa5ada5057556e2bf6ead530f8695">GetBuffer</a>(OMX_DirOutput, 0, 1000, OMX_IndexParamImageInit);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span> (buffer)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        (void)m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#aadca0a2e0d591a065f98fdc0db669b75">FillThisBuffer</a>(buffer);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// else panic...</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordtype">void</span> TorcPiCamera::ProcessStillsBuffer(OMX_BUFFERHEADERTYPE *Buffer)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;{</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (!Buffer)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (Buffer-&gt;nFilledLen &gt; 0)</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        uint8_t* data = (uint8_t*)malloc(Buffer-&gt;nFilledLen);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        memcpy(data, Buffer-&gt;pBuffer + Buffer-&gt;nOffset, Buffer-&gt;nFilledLen);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <a class="code" href="../../d3/dfd/class_torc_camera_device.html#aef16c41057880802b59a2f3b45da850e">SaveStillBuffer</a>(Buffer-&gt;nFilledLen, data);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (Buffer-&gt;nFlags &amp; OMX_BUFFERFLAG_ENDOFFRAME)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <a class="code" href="../../d3/dfd/class_torc_camera_device.html#ae83bcf0a54d9a5badb22fd0c3045270b">SaveStill</a>();</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a75ab4292e3b5c80bff2fce9b1d6ee703">m_stillsExpected</a>)</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <a class="code" href="../../da/da1/class_torc_pi_camera.html#a42e54a5b8d6bdf092bdabfe86e039956">StartStill</a>();</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="keywordtype">bool</span> TorcPiCamera::EnableVideo(<span class="keywordtype">bool</span> Video)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;{</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    (void)Video;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;}</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordtype">void</span> TorcPiCamera::StartVideo(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;{</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (!m_videoEnabled)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    OMX_BUFFERHEADERTYPE* buffer = m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ad5eaa5ada5057556e2bf6ead530f8695">GetBuffer</a>(OMX_DirOutput, 0, 1000, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (buffer)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        (void)m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#aadca0a2e0d591a065f98fdc0db669b75">FillThisBuffer</a>(buffer);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keywordtype">void</span> TorcPiCamera::ProcessVideoBuffer(OMX_BUFFERHEADERTYPE *Buffer)</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;{</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">if</span> (!Buffer || !<a class="code" href="../../d3/dfd/class_torc_camera_device.html#ac056fbe706cb6173807cfcd5c6b8df6e">m_muxer</a>)</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordtype">bool</span> idr      = Buffer-&gt;nFlags &amp; OMX_BUFFERFLAG_SYNCFRAME;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordtype">bool</span> complete = Buffer-&gt;nFlags &amp; OMX_BUFFERFLAG_ENDOFFRAME;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordtype">bool</span> sps      = Buffer-&gt;nFlags &amp; OMX_BUFFERFLAG_CODECCONFIG;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> (!sps &amp;&amp; complete)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a364b5d59b11aa240054f67f899623ad8">m_frameCount</a>++;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// TODO wrap pts</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">// this increases the pts monotonically based on actual complete frames received</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    qint64 pts = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a364b5d59b11aa240054f67f899623ad8">m_frameCount</a> * ((float)<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a51b3b3b25ab465b6f385f48cdb19927c">m_timebase</a> / (<span class="keywordtype">float</span>)<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a>);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// sps is not considered a frame but muxer will complain if the pts does not increase</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> (sps)</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        pts++;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">// NB we use av_packet_from_data and av_grow_packet for the buffered packet - which uses the internal AVBufferRef structure</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// Do not manually release AVPacket-&gt;data</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        quint32 offset = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>-&gt;size;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        av_grow_packet(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>, Buffer-&gt;nFilledLen);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        memcpy(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>-&gt;data + offset, reinterpret_cast&lt;uint8_t*&gt;(Buffer-&gt;pBuffer) + Buffer-&gt;nOffset, Buffer-&gt;nFilledLen);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (complete)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        AVPacket *packet = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">if</span> (!packet)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            packet = av_packet_alloc();</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            av_init_packet(packet);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            packet-&gt;size = Buffer-&gt;nFilledLen;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            packet-&gt;data = <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(Buffer-&gt;pBuffer) + Buffer-&gt;nOffset;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        }</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        packet-&gt;stream_index = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a55b04c0f63acdac0d669f49c00efb279">m_videoStream</a>;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        packet-&gt;pts          = pts;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        packet-&gt;dts          = pts;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        packet-&gt;duration     = 1;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        packet-&gt;flags       |= idr ? AV_PKT_FLAG_KEY : 0;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            QWriteLocker locker(&amp;<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a669b5852085719e297cff4945800f005">m_ringBufferLock</a>); <span class="comment">// muxer accesses ringbuffer</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <a class="code" href="../../d3/dfd/class_torc_camera_device.html#ac056fbe706cb6173807cfcd5c6b8df6e">m_muxer</a>-&gt;<a class="code" href="../../d2/d10/class_torc_muxer.html#a14c2e7df6e41835fea3fdd9e3a823187">AddPacket</a>(packet, sps);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">if</span> (sps &amp;&amp; !<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a2c762428455ae5a421cb1c2bdc355c1e">m_haveInitSegment</a>)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                QByteArray config = QByteArray::fromRawData((<span class="keywordtype">char</span>*)packet-&gt;data, packet-&gt;size);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#aafa40a9c9b260fccdf1fdb407ace74e7">m_videoCodec</a> = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#ac056fbe706cb6173807cfcd5c6b8df6e">m_muxer</a>-&gt;<a class="code" href="../../d2/d10/class_torc_muxer.html#aecf0fd0c533cc4e6690982c4354c1839">GetAVCCodec</a>(config);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a2c762428455ae5a421cb1c2bdc355c1e">m_haveInitSegment</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <a class="code" href="../../d3/dfd/class_torc_camera_device.html#ac056fbe706cb6173807cfcd5c6b8df6e">m_muxer</a>-&gt;<a class="code" href="../../d2/d10/class_torc_muxer.html#a57ae0d84ebf94edb2484b06fd3a20db8">FinishSegment</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                <span class="comment">// video is notionally available once the init segment is available</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                emit <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a1baa4ea490967f823d9480f1e8fa4250">ParametersChanged</a>(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                emit <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a0c124658db3959b851d7b4b59dca3d94">WritingStarted</a>();</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            }</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!sps &amp;&amp; !(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a364b5d59b11aa240054f67f899623ad8">m_frameCount</a> % (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> * <a class="code" href="../../d3/d38/torccamera_8h.html#a763b1027721a78f930377580f17ca758">VIDEO_SEGMENT_TARGET</a>)))</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <a class="code" href="../../d3/dfd/class_torc_camera_device.html#ac056fbe706cb6173807cfcd5c6b8df6e">m_muxer</a>-&gt;<a class="code" href="../../d2/d10/class_torc_muxer.html#a57ae0d84ebf94edb2484b06fd3a20db8">FinishSegment</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                locker.unlock();</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a992e4b35f2699695d4bc59cc96ff1083">TrackDrift</a>();</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                locker.relock();</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                av_packet_free(&amp;<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                packet-&gt;data = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                av_packet_free(&amp;packet);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            uint8_t* data = (uint8_t*)av_malloc(Buffer-&gt;nFilledLen);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a> = av_packet_alloc();</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            av_init_packet(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            av_packet_from_data(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>, data, Buffer-&gt;nFilledLen);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            memcpy(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>-&gt;data, reinterpret_cast&lt;uint8_t*&gt;(Buffer-&gt;pBuffer) + Buffer-&gt;nOffset, Buffer-&gt;nFilledLen);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">m_bufferedPacket</a>-&gt;flags |= idr ? AV_PKT_FLAG_KEY : 0;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// and kick off another</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    StartVideo();</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno"><a class="line" href="../../da/da1/class_torc_pi_camera.html#a9cf694bde813b04d910fe5f08c7badc1">  422</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#a9cf694bde813b04d910fe5f08c7badc1">TorcPiCamera::Stop</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;{</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">// make sure no further buffers are requested</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    m_stillsEnabled = <span class="keyword">false</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    m_videoEnabled  = <span class="keyword">false</span>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// and ensure all FillBufferDone callbacks are complete</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">// NB this assumes only one buffer is allocated</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="../../da/da4/class_torc_timer.html">TorcTimer</a> timer;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    timer.<a class="code" href="../../da/da4/class_torc_timer.html#a6612b5aa2271a59e5cb85f8d8f19188f">Start</a>();</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">while</span> (m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#af77461c271e05a7c9908cfc14148ec1e">GetInUseBuffers</a>(OMX_DirOutput, 0, OMX_IndexParamImageInit) &amp;&amp;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;           m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#af77461c271e05a7c9908cfc14148ec1e">GetInUseBuffers</a>(OMX_DirOutput, 0, OMX_IndexParamVideoInit) &amp;&amp;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;           timer.<a class="code" href="../../da/da4/class_torc_timer.html#ac75eda8ade73ae5d5ac0b3989f202c90">Elapsed</a>() &lt; 1000)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        QThread::msleep(50);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    emit <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a114fb4fb4915926ac2005392f6faa62c">WritingStopped</a>();</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// stop camera</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    OMX_CONFIG_PORTBOOLEANTYPE capture;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(capture);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    capture.nPortIndex = m_cameraVideoPort;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    capture.bEnabled   = OMX_FALSE;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigPortCapturing, &amp;capture);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// set state to idle</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    m_nullSink.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateIdle);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// disable encoder output port</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirOutput, 0, <span class="keyword">false</span>, OMX_IndexParamVideoInit, <span class="keyword">false</span>);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a689491f534e30a23bcb3507da36c40eb">DestroyBuffers</a>(OMX_DirOutput, 0, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a8d82f9db8f4d15db9c47f31a5addaff6">WaitForResponse</a>(OMX_CommandPortDisable, m_videoEncoderOutputPort, 1000);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// disable image encoder output port</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">EnablePort</a>(OMX_DirOutput, 0, <span class="keyword">false</span>, OMX_IndexParamImageInit, <span class="keyword">false</span>);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a689491f534e30a23bcb3507da36c40eb">DestroyBuffers</a>(OMX_DirOutput, 0, OMX_IndexParamImageInit);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a8d82f9db8f4d15db9c47f31a5addaff6">WaitForResponse</a>(OMX_CommandPortDisable, m_imageEncoderOutputPort, 1000);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// disable remaining ports</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ad55d3d1a2ec01c2696478c7ad3df03e9">DisablePorts</a>(OMX_IndexParamVideoInit);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">// disabled due to inconsequential errors</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">//m_splitter.DisablePorts(OMX_IndexParamVideoInit);</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ad55d3d1a2ec01c2696478c7ad3df03e9">DisablePorts</a>(OMX_IndexParamVideoInit);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ad55d3d1a2ec01c2696478c7ad3df03e9">DisablePorts</a>(OMX_IndexParamImageInit);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    m_nullSink.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ad55d3d1a2ec01c2696478c7ad3df03e9">DisablePorts</a>(OMX_IndexParamVideoInit);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// destroy tunnels</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    m_videoTunnel.<a class="code" href="../../d3/db6/class_torc_o_m_x_tunnel.html#aecf99a01042aa48505654a8c97962a31">Destroy</a>();</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    m_previewTunnel.<a class="code" href="../../d3/db6/class_torc_o_m_x_tunnel.html#aecf99a01042aa48505654a8c97962a31">Destroy</a>();</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    m_splitterTunnel.<a class="code" href="../../d3/db6/class_torc_o_m_x_tunnel.html#aecf99a01042aa48505654a8c97962a31">Destroy</a>();</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    m_imageTunnel.<a class="code" href="../../d3/db6/class_torc_o_m_x_tunnel.html#aecf99a01042aa48505654a8c97962a31">Destroy</a>();</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// set state to loaded</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateLoaded);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateLoaded);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateLoaded);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateLoaded);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    m_nullSink.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">SetState</a>(OMX_StateLoaded);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="keywordtype">bool</span> TorcPiCamera::LoadDrivers(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;{</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Trying to load Broadcom drivers&quot;</span>);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">// request a callback</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    OMX_CONFIG_REQUESTCALLBACKTYPE callback;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(callback);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    callback.nPortIndex = OMX_ALL;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    callback.nIndex     = OMX_IndexParamCameraDeviceNumber;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    callback.bEnable    = OMX_TRUE;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigRequestCallback, &amp;callback))</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// and set the camera device number. Once we have a response, the relevant</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">// drivers should be loaded.</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    OMX_PARAM_U32TYPE device;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(device);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    device.nPortIndex = OMX_ALL;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    device.nU32       = 0;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexParamCameraDeviceNumber, &amp;device))</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a8d82f9db8f4d15db9c47f31a5addaff6">WaitForResponse</a>(OMX_EventParamOrConfigChanged, 0, 10000))</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Broadcom drivers loaded&quot;</span>);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    OMX_CONFIG_CAMERAINFOTYPE info;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(info);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">if</span> (!m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#af0bf7f61acad562996191bf34e627b8e">GetConfig</a>(OMX_IndexConfigCameraInfo, &amp;info))</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    {</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">if</span> (qstrcmp((<span class="keyword">const</span> <span class="keywordtype">char</span>*)info.cameraname, <span class="stringliteral">&quot;imx219&quot;</span>) == 0)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            m_cameraType = <a class="code" href="../../da/da1/class_torc_pi_camera.html#a794fa0cd433afe68d86e2397723b7786a641d820c0d6b0ec8ae9564ae9cb86fc9">V2</a>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (qstrcmp((<span class="keyword">const</span> <span class="keywordtype">char</span>*)info.cameraname, <span class="stringliteral">&quot;ov5647&quot;</span>) == 0)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            m_cameraType = <a class="code" href="../../da/da1/class_torc_pi_camera.html#a794fa0cd433afe68d86e2397723b7786a28cfe4dabda6cd6d86f83de70ffabc9d">V1</a>;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Camera: name &#39;%1&#39; (Version %2)&quot;</span>)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            .arg((<span class="keyword">const</span> <span class="keywordtype">char</span>*)info.cameraname)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            .arg(m_cameraType == <a class="code" href="../../da/da1/class_torc_pi_camera.html#a794fa0cd433afe68d86e2397723b7786a641d820c0d6b0ec8ae9564ae9cb86fc9">V2</a> ? <span class="stringliteral">&quot;2&quot;</span> : m_cameraType == <a class="code" href="../../da/da1/class_torc_pi_camera.html#a794fa0cd433afe68d86e2397723b7786a28cfe4dabda6cd6d86f83de70ffabc9d">V1</a> ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;Unknown&quot;</span>));</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="keywordtype">bool</span> TorcPiCamera::LoadCameraSettings(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;{</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordflow">if</span> (!m_cameraVideoPort)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="comment">// Sharpness</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    OMX_CONFIG_SHARPNESSTYPE sharpness;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(sharpness);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    sharpness.nPortIndex = OMX_ALL;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    sharpness.nSharpness = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a6ab7dcbe8f8b98310bef8c23afab94a1">CAMERA_SHARPNESS</a>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonSharpness, &amp;sharpness))</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">// Contrast</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    OMX_CONFIG_CONTRASTTYPE contrast;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(contrast);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    contrast.nPortIndex = OMX_ALL;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    contrast.nContrast  = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a97ab08f8684b12e9d31a4b1c82fbd760">CAMERA_CONTRAST</a>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonContrast, &amp;contrast))</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// Saturation</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    OMX_CONFIG_SATURATIONTYPE saturation;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(saturation);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    saturation.nPortIndex  = OMX_ALL;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    saturation.nSaturation = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a618416aa7755b2cd0a357ed2306e8d22">CAMERA_SATURATION</a>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonSaturation, &amp;saturation))</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// Brightness</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    OMX_CONFIG_BRIGHTNESSTYPE brightness;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(brightness);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    brightness.nPortIndex  = OMX_ALL;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    brightness.nBrightness = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a052cb741945a6d84a542685794448caa">CAMERA_BRIGHTNESS</a>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonBrightness, &amp;brightness))</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">// Exposure</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    OMX_CONFIG_EXPOSUREVALUETYPE exposure;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(exposure);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    exposure.nPortIndex        = OMX_ALL;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    exposure.eMetering         = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#aa275da893a8c7a58204e73370b35f8cd">CAMERA_METERING</a>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    exposure.xEVCompensation   = (OMX_S32)((<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a15dd304042e8813e5ddb1d01cd17d894">CAMERA_EXPOSURE_COMPENSATION</a> &lt;&lt; 16)/6.0);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    exposure.nShutterSpeedMsec = (OMX_U32)((<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#add5daa9b1390a2eec248d334d39303ff">CAMERA_SHUTTER_SPEED</a>)*1e6);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    exposure.bAutoShutterSpeed = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a86136ee5adbac1d39308d89bdf1ec051">CAMERA_SHUTTER_SPEED_AUTO</a>;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    exposure.nSensitivity      = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#af380e1df9742759f4dc990701f322a99">CAMERA_ISO</a>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    exposure.bAutoSensitivity  = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#af9c832629487bda061b70df0c8f1447f">CAMERA_ISO_AUTO</a>;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonExposureValue, &amp;exposure))</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">// Exposure control</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    OMX_CONFIG_EXPOSURECONTROLTYPE commonexposure;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(commonexposure);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    commonexposure.nPortIndex       = OMX_ALL;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    commonexposure.eExposureControl = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a120561ba8b7e7bc0cad270c636bfd8c1">CAMERA_EXPOSURE</a>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonExposure, &amp;commonexposure))</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="comment">// Frame stabilisation</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    OMX_CONFIG_FRAMESTABTYPE framestabilisation;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(framestabilisation);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    framestabilisation.nPortIndex = OMX_ALL;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    framestabilisation.bStab      = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a5f90851745e92ef6f519f439376a7412">CAMERA_FRAME_STABILIZATION</a>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonFrameStabilisation, &amp;framestabilisation))</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">// White balance</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    OMX_CONFIG_WHITEBALCONTROLTYPE whitebalance;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(whitebalance);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    whitebalance.nPortIndex       = OMX_ALL;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    whitebalance.eWhiteBalControl = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a4ba947935dbf8483befe1ceb0daf7f25">CAMERA_WHITE_BALANCE</a>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonWhiteBalance, &amp;whitebalance))</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">// White balance gain</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a4ba947935dbf8483befe1ceb0daf7f25">CAMERA_WHITE_BALANCE</a>)</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      OMX_CONFIG_CUSTOMAWBGAINSTYPE whitebalancegain;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(whitebalancegain);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      whitebalancegain.xGainR = (<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#af0270a47d4e04a0c6a88bed5aeee7b59">CAMERA_WHITE_BALANCE_RED_GAIN</a> &lt;&lt; 16) / 1000;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      whitebalancegain.xGainB = (<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a547b331ceb80a6a72367643adfab62ed">CAMERA_WHITE_BALANCE_BLUE_GAIN</a> &lt;&lt; 16) / 1000;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCustomAwbGains, &amp;whitebalancegain))</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="comment">// Image filter</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    OMX_CONFIG_IMAGEFILTERTYPE imagefilter;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(imagefilter);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    imagefilter.nPortIndex   = OMX_ALL;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    imagefilter.eImageFilter = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a553c6df06d2cf696ff202fa00962059e">CAMERA_IMAGE_FILTER</a>;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonImageFilter, &amp;imagefilter))</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="comment">// Mirror</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    OMX_CONFIG_MIRRORTYPE mirror;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(mirror);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    mirror.nPortIndex = m_cameraVideoPort;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    mirror.eMirror    = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a4290f8ebc7936700fe1b22ceb49efd58">CAMERA_MIRROR</a>;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonMirror, &amp;mirror))</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// Rotation</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    OMX_CONFIG_ROTATIONTYPE rotation;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(rotation);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    rotation.nPortIndex = m_cameraVideoPort;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    rotation.nRotation  = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#af378bb0691606be9f91323188b835ac9">CAMERA_ROTATION</a>;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonRotate, &amp;rotation))</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">// Color enhancement</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    OMX_CONFIG_COLORENHANCEMENTTYPE color_enhancement;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(color_enhancement);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    color_enhancement.nPortIndex        = OMX_ALL;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    color_enhancement.bColorEnhancement = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#af12a6688fd1fd42ed4e2a9285b028267">CAMERA_COLOR_ENABLE</a>;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    color_enhancement.nCustomizedU      = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#aaf50db39b2168af3a1e4c948834ba7ea">CAMERA_COLOR_U</a>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    color_enhancement.nCustomizedV      = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#abb7c6eb5f47898443f12cfd79e67e91b">CAMERA_COLOR_V</a>;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigCommonColorEnhancement, &amp;color_enhancement))</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// Denoise</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    OMX_CONFIG_BOOLEANTYPE denoise;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(denoise);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    denoise.bEnabled = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#af419407f055801805856c57d9ef98593">CAMERA_NOISE_REDUCTION</a>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigStillColourDenoiseEnable, &amp;denoise))</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="comment">//ROI</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    OMX_CONFIG_INPUTCROPTYPE roi;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(roi);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    roi.nPortIndex = OMX_ALL;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    roi.xLeft      = (<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a0cc36f01104ed3b4e56ab1a429010b1b">CAMERA_ROI_LEFT</a> &lt;&lt; 16) / 100;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    roi.xTop       = (<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a0e41e09234d05e2ed0ecf98bbc55e9be">CAMERA_ROI_TOP</a> &lt;&lt; 16) / 100;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    roi.xWidth     = (<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a862deba4a0034a552002ca4162f6c676">CAMERA_ROI_WIDTH</a> &lt;&lt; 16) / 100;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    roi.xHeight    = (<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#adac374f3533dc8b2ab8fa4a4f42c4706">CAMERA_ROI_HEIGHT</a> &lt;&lt; 16) / 100;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigInputCropPercentages, &amp;roi))</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">//DRC</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    OMX_CONFIG_DYNAMICRANGEEXPANSIONTYPE drc;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(drc);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    drc.eMode = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a18aa65f8c3dd74eabdd406eefdfc03a0">CAMERA_DRC</a>;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigDynamicRangeExpansion, &amp;drc))</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;}</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="keywordtype">bool</span> TorcPiCamera::ConfigureCamera(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;{</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">if</span> (!m_cameraPreviewPort || !m_cameraVideoPort)</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">// configure camera video port</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    OMX_PARAM_PORTDEFINITIONTYPE videoport;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(videoport);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    videoport.nPortIndex = m_cameraVideoPort;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a52492cdf821968684ac1949fe3b5d2a8">GetParameter</a>(OMX_IndexParamPortDefinition, &amp;videoport))</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    videoport.format.video.nFrameWidth        = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a989a540d79780335dfd9daa44acffd40">m_width</a>;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    videoport.format.video.nFrameHeight       = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a148f3d8696129cbc40de0bd5b76027f3">m_height</a>;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    videoport.format.video.nStride            = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a3d2856c5a5ed0bb283bc02f834796bca">m_stride</a>;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    videoport.format.video.nSliceHeight       = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a8074dceec0e9059ea9ccbb9c9408d2be">m_sliceHeight</a>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    videoport.format.video.xFramerate         = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> &lt;&lt; 16;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    videoport.format.video.eCompressionFormat = OMX_VIDEO_CodingUnused;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    videoport.format.video.eColorFormat       = OMX_COLOR_FormatYUV420PackedPlanar;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamPortDefinition, &amp;videoport))</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="comment">// and the same for the preview port</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    videoport.nPortIndex = m_cameraPreviewPort;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamPortDefinition, &amp;videoport))</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="comment">// configure video frame rate</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    OMX_CONFIG_FRAMERATETYPE framerate;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(framerate);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    framerate.nPortIndex = m_cameraVideoPort;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    framerate.xEncodeFramerate = videoport.format.video.xFramerate;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigVideoFramerate, &amp;framerate))</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">// and same again for preview port</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    framerate.nPortIndex = m_cameraPreviewPort;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">if</span> (m_camera.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigVideoFramerate, &amp;framerate))</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">// camera settings</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">if</span> (!LoadCameraSettings())</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;}</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="keywordtype">bool</span> TorcPiCamera::ConfigureImageEncoder(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;{</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">if</span> (!m_imageEncoderOutputPort)</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    OMX_PARAM_PORTDEFINITIONTYPE encoderport;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(encoderport);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    encoderport.nPortIndex = m_imageEncoderOutputPort;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">if</span> (m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a52492cdf821968684ac1949fe3b5d2a8">GetParameter</a>(OMX_IndexParamPortDefinition, &amp;encoderport))</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    encoderport.format.image.nFrameWidth        = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a989a540d79780335dfd9daa44acffd40">m_width</a>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    encoderport.format.image.nFrameHeight       = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a148f3d8696129cbc40de0bd5b76027f3">m_height</a>;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    encoderport.format.image.nStride            = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a3d2856c5a5ed0bb283bc02f834796bca">m_stride</a>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    encoderport.format.image.nSliceHeight       = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a8074dceec0e9059ea9ccbb9c9408d2be">m_sliceHeight</a>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    encoderport.format.image.eCompressionFormat = OMX_IMAGE_CodingJPEG;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    encoderport.format.image.eColorFormat       = OMX_COLOR_FormatUnused;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordflow">if</span> (m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamPortDefinition, &amp;encoderport))</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set image encoder output parameters&quot;</span>);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(encoderport);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    encoderport.nPortIndex = m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ac99925fb031273d7df4e4a8b57915d92">GetPort</a>(OMX_DirInput, 0, OMX_IndexParamImageInit);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">if</span> (m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a52492cdf821968684ac1949fe3b5d2a8">GetParameter</a>(OMX_IndexParamPortDefinition, &amp;encoderport))</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    encoderport.format.image.nFrameWidth        = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a989a540d79780335dfd9daa44acffd40">m_width</a>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    encoderport.format.image.nFrameHeight       = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a148f3d8696129cbc40de0bd5b76027f3">m_height</a>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    encoderport.format.image.nStride            = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a3d2856c5a5ed0bb283bc02f834796bca">m_stride</a>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    encoderport.format.image.nSliceHeight       = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a8074dceec0e9059ea9ccbb9c9408d2be">m_sliceHeight</a>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    encoderport.format.image.eCompressionFormat = OMX_IMAGE_CodingUnused;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    encoderport.format.image.eColorFormat       = OMX_COLOR_FormatYUV420PackedPlanar;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordflow">if</span> (m_imageEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamPortDefinition, &amp;encoderport))</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set image encoder input parameters&quot;</span>);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;}</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="keywordtype">bool</span> TorcPiCamera::ConfigureVideoEncoder(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;{</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">if</span> (!m_videoEncoderOutputPort)</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="comment">// Encoder output</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    OMX_PARAM_PORTDEFINITIONTYPE encoderport;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(encoderport);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    encoderport.nPortIndex = m_videoEncoderOutputPort;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a52492cdf821968684ac1949fe3b5d2a8">GetParameter</a>(OMX_IndexParamPortDefinition, &amp;encoderport))</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    encoderport.format.video.nFrameWidth        = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a989a540d79780335dfd9daa44acffd40">m_width</a>;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    encoderport.format.video.nFrameHeight       = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a148f3d8696129cbc40de0bd5b76027f3">m_height</a>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    encoderport.format.video.nStride            = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a3d2856c5a5ed0bb283bc02f834796bca">m_stride</a>;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    encoderport.format.video.nSliceHeight       = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a8074dceec0e9059ea9ccbb9c9408d2be">m_sliceHeight</a>;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    encoderport.format.video.xFramerate         = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> &lt;&lt; 16;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    encoderport.format.video.nBitrate           = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a5a4b2e687194b467bc05931c77e9dd8a">ENCODER_QP</a> ? 0 : <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#aa0018394b4f4f34c007357173bf9f21c">m_bitrate</a>;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    encoderport.format.video.eCompressionFormat = OMX_VIDEO_CodingAVC;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamPortDefinition, &amp;encoderport))</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder output parameters&quot;</span>);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a5a4b2e687194b467bc05931c77e9dd8a">ENCODER_QP</a>)</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        OMX_VIDEO_PARAM_BITRATETYPE bitrate;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(bitrate);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        bitrate.eControlRate   = OMX_Video_ControlRateVariable;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        bitrate.nTargetBitrate = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#aa0018394b4f4f34c007357173bf9f21c">m_bitrate</a>;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        bitrate.nPortIndex     = m_videoEncoderOutputPort;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamVideoBitrate, &amp;bitrate))</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder output bitrate&quot;</span>);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="comment">// quantization</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        OMX_VIDEO_PARAM_QUANTIZATIONTYPE quantization;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(quantization);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        quantization.nPortIndex = m_videoEncoderOutputPort;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        quantization.nQpI       = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#abda579266812efec4ac60c130cbd54b5">ENCODER_QP_I</a>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        quantization.nQpP       = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#aac8461b95883385ccbd0b39303e746c6">ENCODER_QP_P</a>;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamVideoQuantization, &amp;quantization))</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder output quantization&quot;</span>);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="comment">// codec</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    OMX_VIDEO_PARAM_PORTFORMATTYPE format;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(format);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    format.nPortIndex         = m_videoEncoderOutputPort;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    format.eCompressionFormat = OMX_VIDEO_CodingAVC;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamVideoPortFormat, &amp;format))</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder output format&quot;</span>);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="comment">// IDR period</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    OMX_VIDEO_CONFIG_AVCINTRAPERIOD idr;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(idr);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    idr.nPortIndex = m_videoEncoderOutputPort;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#af0bf7f61acad562996191bf34e627b8e">GetConfig</a>(OMX_IndexConfigVideoAVCIntraPeriod, &amp;idr))</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    idr.nIDRPeriod = <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> * <a class="code" href="../../d3/d38/torccamera_8h.html#a3f542686e057eba94fa3f3f35f2ce2f3">VIDEO_GOPDURA_TARGET</a>;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">SetConfig</a>(OMX_IndexConfigVideoAVCIntraPeriod, &amp;idr))</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Set video encoder output IDR to %1&quot;</span>).arg(<a class="code" href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">m_params</a>.<a class="code" href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">m_frameRate</a> * <a class="code" href="../../d3/d38/torccamera_8h.html#a3f542686e057eba94fa3f3f35f2ce2f3">VIDEO_GOPDURA_TARGET</a>));</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// SEI</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    OMX_PARAM_BRCMVIDEOAVCSEIENABLETYPE sei;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(sei);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    sei.nPortIndex = m_videoEncoderOutputPort;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    sei.bEnable    = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a9594030c74b200cc53279ce37524fc91">ENCODER_SEI</a>;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamBrcmVideoAVCSEIEnable, &amp;sei))</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder output SEI&quot;</span>);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="comment">// EEDE</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    OMX_VIDEO_EEDE_ENABLE eede;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(eede);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    eede.nPortIndex = m_videoEncoderOutputPort;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    eede.enable     = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a66a6f9f928bdfe2a5c1abf6d268e9ce8">ENCODER_EEDE</a>;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamBrcmEEDEEnable, &amp;eede))</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video endcoder output EEDE&quot;</span>);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    OMX_VIDEO_EEDE_LOSSRATE eede_loss_rate;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(eede_loss_rate);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    eede_loss_rate.nPortIndex = m_videoEncoderOutputPort;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    eede_loss_rate.loss_rate  = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#ac3439ee3abb76c10961f60f007d10647">ENCODER_EEDE_LOSS_RATE</a>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamBrcmEEDELossRate, &amp;eede_loss_rate))</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder output EEDE loss rate&quot;</span>);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="comment">// profile</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    OMX_VIDEO_AVCPROFILETYPE profile = OMX_VIDEO_AVCProfileMain;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d38/torccamera_8h.html#a32ecc65c5c61e99b8ed8e0c8d131c42a">VIDEO_H264_PROFILE</a>)</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keywordflow">case</span> FF_PROFILE_H264_BASELINE: profile = OMX_VIDEO_AVCProfileBaseline; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="keywordflow">case</span> FF_PROFILE_H264_MAIN:     profile = OMX_VIDEO_AVCProfileMain;     <span class="keywordflow">break</span>;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="keywordflow">case</span> FF_PROFILE_H264_EXTENDED: profile = OMX_VIDEO_AVCProfileExtended; <span class="keywordflow">break</span>;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">case</span> FF_PROFILE_H264_HIGH:     profile = OMX_VIDEO_AVCProfileHigh;     <span class="keywordflow">break</span>;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="keywordflow">case</span> FF_PROFILE_H264_HIGH_10:  profile = OMX_VIDEO_AVCProfileHigh10;   <span class="keywordflow">break</span>;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordflow">case</span> FF_PROFILE_H264_HIGH_422: profile = OMX_VIDEO_AVCProfileHigh422;  <span class="keywordflow">break</span>;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="keywordflow">case</span> FF_PROFILE_H264_HIGH_444: profile = OMX_VIDEO_AVCProfileHigh444;  <span class="keywordflow">break</span>;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, <span class="stringliteral">&quot;Unknown H264 profile. Defaulting to main&quot;</span>);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    OMX_VIDEO_PARAM_AVCTYPE avc;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(avc);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    avc.nPortIndex = m_videoEncoderOutputPort;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#a52492cdf821968684ac1949fe3b5d2a8">GetParameter</a>(OMX_IndexParamVideoAvc, &amp;avc))</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    avc.eProfile = profile;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamVideoAvc, &amp;avc))</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder output profile&quot;</span>);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="comment">// Inline SPS/PPS</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    OMX_CONFIG_PORTBOOLEANTYPE headers;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(headers);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    headers.nPortIndex = m_videoEncoderOutputPort;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    headers.bEnabled   = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a037c02f4478d15850c451dda15bac9e8">ENCODER_INLINE_HEADERS</a>;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamBrcmVideoAVCInlineHeaderEnable, &amp;headers))</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder output SPS/PPS&quot;</span>);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="comment">// SPS timing</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    OMX_CONFIG_PORTBOOLEANTYPE timing;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(timing);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    timing.nPortIndex =  m_videoEncoderOutputPort;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    timing.bEnabled   = <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a853445f1aeec2ca3107cb20ff83d56e3">ENCODER_SPS_TIMING</a>;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">if</span> (m_videoEncoder.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexParamBrcmVideoAVCSPSTimingEnable, &amp;timing))</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Set video encoder SPS timings&quot;</span>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;}</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno"><a class="line" href="../../da/da1/class_torc_pi_camera.html#a5beab970495724e8fa8f7b78d7ba3720">  916</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#a5beab970495724e8fa8f7b78d7ba3720">TorcPiCamera::EnableStills</a>(uint Count)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;{</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    OMX_PARAM_U32TYPE single;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <a class="code" href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a>(single);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    single.nPortIndex = m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#ac99925fb031273d7df4e4a8b57915d92">GetPort</a>(OMX_DirOutput, 1, OMX_IndexParamVideoInit);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    single.nU32       = Count;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <span class="keywordflow">if</span> (m_splitter.<a class="code" href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">SetParameter</a>(OMX_IndexConfigSingleStep, &amp;single))</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d3/dfd/class_torc_camera_device.html#a83b20eb10509cd0deab162be970fb567">TorcCameraDevice::EnableStills</a>(Count);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;}</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno"><a class="line" href="../../d7/de1/torcpicamera_8cpp.html#ad85c86655794f26e3d65c77c92cf2ed1">  928</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> QString <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#ad85c86655794f26e3d65c77c92cf2ed1">piCameraType</a> =</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="stringliteral">&quot;    &lt;xs:element name=\&quot;pi\&quot; type=\&quot;cameraType\&quot;/&gt;\r\n&quot;</span>;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno"><a class="line" href="../../d1/d6b/class_torc_pi_camera_x_s_d_factory.html">  931</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d1/d6b/class_torc_pi_camera_x_s_d_factory.html">TorcPiCameraXSDFactory</a> : <span class="keyword">public</span> <a class="code" href="../../d5/d5d/class_torc_x_s_d_factory.html">TorcXSDFactory</a></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;{</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00934"></a><span class="lineno"><a class="line" href="../../d1/d6b/class_torc_pi_camera_x_s_d_factory.html#a93ed366b3e579c12fc1bb6cc8096ec34">  934</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/d6b/class_torc_pi_camera_x_s_d_factory.html#a93ed366b3e579c12fc1bb6cc8096ec34">GetXSD</a>(QMultiMap&lt;QString,QString&gt; &amp;XSD) { XSD.insert(<a class="code" href="../../d5/d41/torccentral_8h.html#a36f5b43196227a2af74ac97b1abd3e6a">XSD_CAMERATYPES</a>, <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#ad85c86655794f26e3d65c77c92cf2ed1">piCameraType</a>); }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;} <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#ace91232e0bcd7a314cedc2710d6dc0d3">TorcPiCameraXSDFactory</a>;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno"><a class="line" href="../../db/dd3/class_torc_pi_camera_factory.html">  937</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../db/dd3/class_torc_pi_camera_factory.html">TorcPiCameraFactory</a> final : <span class="keyword">public</span> <a class="code" href="../../d8/d67/class_torc_camera_factory.html">TorcCameraFactory</a></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;{</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00940"></a><span class="lineno"><a class="line" href="../../db/dd3/class_torc_pi_camera_factory.html#aaf27a1b3d288f3bb47bbf73a63db13a1">  940</a></span>&#160;    <a class="code" href="../../db/dd3/class_torc_pi_camera_factory.html#aaf27a1b3d288f3bb47bbf73a63db13a1">TorcPiCameraFactory</a>() : <a class="code" href="../../d8/d67/class_torc_camera_factory.html">TorcCameraFactory</a>()</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    {</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        bcm_host_init();</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    }</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno"><a class="line" href="../../db/dd3/class_torc_pi_camera_factory.html#a591de8c558c5d1d912eb84189cd43ced">  945</a></span>&#160;   <span class="keyword">virtual</span> <a class="code" href="../../db/dd3/class_torc_pi_camera_factory.html#a591de8c558c5d1d912eb84189cd43ced">~TorcPiCameraFactory</a>()</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        bcm_host_deinit();</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno"><a class="line" href="../../db/dd3/class_torc_pi_camera_factory.html#a7753d0a4e80b4133d3fd9a7d7cf0c1ff">  950</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../db/dd3/class_torc_pi_camera_factory.html#a7753d0a4e80b4133d3fd9a7d7cf0c1ff">CanHandle</a>(<span class="keyword">const</span> QString &amp;Type, <span class="keyword">const</span> <a class="code" href="../../da/dfa/class_torc_camera_params.html">TorcCameraParams</a> &amp;Params)<span class="keyword"> override</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        (void)Params;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">bool</span> checked = <span class="keyword">false</span>;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">if</span> (!checked)</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            checked = <span class="keyword">true</span>;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <span class="keywordtype">char</span> command[32];</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            <span class="keywordtype">int</span>  gpumem = 0;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="keywordflow">if</span> (!vc_gencmd(command, <span class="keyword">sizeof</span>(command), <span class="stringliteral">&quot;get_mem gpu&quot;</span>))</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                vc_gencmd_number_property(command, <span class="stringliteral">&quot;gpu&quot;</span>, &amp;gpumem);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            <span class="keywordflow">if</span> (gpumem &lt; 128)</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Insufficent GPU memory for Pi camera - need 128Mb - have %1Mb&quot;</span>).arg(gpumem));</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            }</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;%1Mb GPU memory&quot;</span>).arg(gpumem));</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                <span class="keywordtype">int</span> supported = 0;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                <span class="keywordtype">int</span> detected  = 0;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                <span class="keywordflow">if</span> (!vc_gencmd(command, <span class="keyword">sizeof</span>(command), <span class="stringliteral">&quot;get_camera&quot;</span>))</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                    vc_gencmd_number_property(command, <span class="stringliteral">&quot;supported&quot;</span>, &amp;supported);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                    vc_gencmd_number_property(command, <span class="stringliteral">&quot;detected&quot;</span>,  &amp;detected);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                <span class="keywordflow">if</span> (!supported)</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                {</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Firmware reports that Pi camera is NOT supported&quot;</span>);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                }</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!detected)</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                {</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Firmware reports that Pi camera NOT detected&quot;</span>);</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                }</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Pi camera supported and detected&quot;</span>);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                    <a class="code" href="../../da/da1/class_torc_pi_camera.html#ac3ec403f5d031aa8d9342e78208da03c">TorcPiCamera::gPiCameraDetected</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            }</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        }</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#ac3ec403f5d031aa8d9342e78208da03c">TorcPiCamera::gPiCameraDetected</a> ? <span class="stringliteral">&quot;pi&quot;</span> == Type : <span class="keyword">false</span>;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"><a class="line" href="../../db/dd3/class_torc_pi_camera_factory.html#a17a34ce858b3328be5059f8ec02327f3"> 1001</a></span>&#160;    <a class="code" href="../../d3/dfd/class_torc_camera_device.html">TorcCameraDevice</a>* <a class="code" href="../../db/dd3/class_torc_pi_camera_factory.html#a17a34ce858b3328be5059f8ec02327f3">Create</a>(<span class="keyword">const</span> QString &amp;Type, <span class="keyword">const</span> <a class="code" href="../../da/dfa/class_torc_camera_params.html">TorcCameraParams</a> &amp;Params)<span class="keyword"> override</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="keywordflow">if</span> ((<span class="stringliteral">&quot;pi&quot;</span> == Type) &amp;&amp; <a class="code" href="../../da/da1/class_torc_pi_camera.html#ac3ec403f5d031aa8d9342e78208da03c">TorcPiCamera::gPiCameraDetected</a>)</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../da/da1/class_torc_pi_camera.html#a9cc4ad4c7af561dc122b13f82896c99b">TorcPiCamera</a>(Params);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    }</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;} <a class="code" href="../../d7/de1/torcpicamera_8cpp.html#a8014243cc035b594f05ed7ef697872da">TorcPiCameraFactory</a>;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">/* vim: set expandtab tabstop=4 shiftwidth=4: */</span></div><div class="ttc" id="torcpicamera_8cpp_html_a0e41e09234d05e2ed0ecf98bbc55e9be"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a0e41e09234d05e2ed0ecf98bbc55e9be">CAMERA_ROI_TOP</a></div><div class="ttdeci">#define CAMERA_ROI_TOP</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00068">torcpicamera.cpp:68</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a5607850813f33abc4f6bb038456a7044"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a5607850813f33abc4f6bb038456a7044">BROADCOM_CAMERA</a></div><div class="ttdeci">#define BROADCOM_CAMERA</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00041">torcpicamera.cpp:41</a></div></div>
<div class="ttc" id="class_torc_camera_params_html_a8074dceec0e9059ea9ccbb9c9408d2be"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html#a8074dceec0e9059ea9ccbb9c9408d2be">TorcCameraParams::m_sliceHeight</a></div><div class="ttdeci">int m_sliceHeight</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00052">torccamera.h:52</a></div></div>
<div class="ttc" id="class_torc_camera_params_html_a989a540d79780335dfd9daa44acffd40"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html#a989a540d79780335dfd9daa44acffd40">TorcCameraParams::m_width</a></div><div class="ttdeci">int m_width</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00049">torccamera.h:49</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_af77461c271e05a7c9908cfc14148ec1e"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#af77461c271e05a7c9908cfc14148ec1e">TorcOMXComponent::GetInUseBuffers</a></div><div class="ttdeci">OMX_U32 GetInUseBuffers(OMX_DIRTYPE Direction, OMX_U32 Index, OMX_INDEXTYPE Domain)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00340">torcomxcomponent.cpp:340</a></div></div>
<div class="ttc" id="class_torc_camera_params_html_aafa40a9c9b260fccdf1fdb407ace74e7"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html#aafa40a9c9b260fccdf1fdb407ace74e7">TorcCameraParams::m_videoCodec</a></div><div class="ttdeci">QString m_videoCodec</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00058">torccamera.h:58</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_a75bf15dd0a81e8c10e59985afbea7763"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#a75bf15dd0a81e8c10e59985afbea7763">TorcOMXComponent::SetState</a></div><div class="ttdeci">OMX_ERRORTYPE SetState(OMX_STATETYPE State, bool Wait=true)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00222">torcomxcomponent.cpp:222</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_ac99925fb031273d7df4e4a8b57915d92"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#ac99925fb031273d7df4e4a8b57915d92">TorcOMXComponent::GetPort</a></div><div class="ttdeci">OMX_U32 GetPort(OMX_DIRTYPE Direction, OMX_U32 Index, OMX_INDEXTYPE Domain)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00309">torcomxcomponent.cpp:309</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_aac8461b95883385ccbd0b39303e746c6"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#aac8461b95883385ccbd0b39303e746c6">ENCODER_QP_P</a></div><div class="ttdeci">#define ENCODER_QP_P</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00076">torcpicamera.cpp:76</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_add5daa9b1390a2eec248d334d39303ff"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#add5daa9b1390a2eec248d334d39303ff">CAMERA_SHUTTER_SPEED</a></div><div class="ttdeci">#define CAMERA_SHUTTER_SPEED</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00054">torcpicamera.cpp:54</a></div></div>
<div class="ttc" id="class_torc_camera_params_html"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html">TorcCameraParams</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00033">torccamera.h:33</a></div></div>
<div class="ttc" id="torccamera_8h_html_a32ecc65c5c61e99b8ed8e0c8d131c42a"><div class="ttname"><a href="../../d3/d38/torccamera_8h.html#a32ecc65c5c61e99b8ed8e0c8d131c42a">VIDEO_H264_PROFILE</a></div><div class="ttdeci">#define VIDEO_H264_PROFILE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00031">torccamera.h:31</a></div></div>
<div class="ttc" id="class_torc_camera_factory_html"><div class="ttname"><a href="../../d8/d67/class_torc_camera_factory.html">TorcCameraFactory</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00126">torccamera.h:126</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_abb7c6eb5f47898443f12cfd79e67e91b"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#abb7c6eb5f47898443f12cfd79e67e91b">CAMERA_COLOR_V</a></div><div class="ttdeci">#define CAMERA_COLOR_V</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00066">torcpicamera.cpp:66</a></div></div>
<div class="ttc" id="class_torc_o_m_x_tunnel_html_a46d70f5d4eb102addc3d1a6eae5b8861"><div class="ttname"><a href="../../d3/db6/class_torc_o_m_x_tunnel.html#a46d70f5d4eb102addc3d1a6eae5b8861">TorcOMXTunnel::Create</a></div><div class="ttdeci">OMX_ERRORTYPE Create(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d47/torcomxtunnel_8cpp_source.html#l00069">torcomxtunnel.cpp:69</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_ad5eaa5ada5057556e2bf6ead530f8695"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#ad5eaa5ada5057556e2bf6ead530f8695">TorcOMXComponent::GetBuffer</a></div><div class="ttdeci">OMX_BUFFERHEADERTYPE * GetBuffer(OMX_DIRTYPE Direction, OMX_U32 Index, OMX_U32 Timeout, OMX_INDEXTYPE Domain)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00389">torcomxcomponent.cpp:389</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_af12a6688fd1fd42ed4e2a9285b028267"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#af12a6688fd1fd42ed4e2a9285b028267">CAMERA_COLOR_ENABLE</a></div><div class="ttdeci">#define CAMERA_COLOR_ENABLE</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00064">torcpicamera.cpp:64</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a11f160f904e70acfa116452ccc69da69"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a11f160f904e70acfa116452ccc69da69">TorcCameraDevice::m_params</a></div><div class="ttdeci">TorcCameraParams m_params</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00102">torccamera.h:102</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_af0270a47d4e04a0c6a88bed5aeee7b59"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#af0270a47d4e04a0c6a88bed5aeee7b59">CAMERA_WHITE_BALANCE_RED_GAIN</a></div><div class="ttdeci">#define CAMERA_WHITE_BALANCE_RED_GAIN</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00059">torcpicamera.cpp:59</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_a9cc4ad4c7af561dc122b13f82896c99b"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#a9cc4ad4c7af561dc122b13f82896c99b">TorcPiCamera::TorcPiCamera</a></div><div class="ttdeci">TorcPiCamera(const TorcCameraParams &amp;Params)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00085">torcpicamera.cpp:85</a></div></div>
<div class="ttc" id="torctimer_8h_html"><div class="ttname"><a href="../../d3/dd0/torctimer_8h.html">torctimer.h</a></div></div>
<div class="ttc" id="class_torc_timer_html"><div class="ttname"><a href="../../da/da4/class_torc_timer.html">TorcTimer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd0/torctimer_8h_source.html#l00007">torctimer.h:7</a></div></div>
<div class="ttc" id="class_torc_muxer_html_aecf0fd0c533cc4e6690982c4354c1839"><div class="ttname"><a href="../../d2/d10/class_torc_muxer.html#aecf0fd0c533cc4e6690982c4354c1839">TorcMuxer::GetAVCCodec</a></div><div class="ttdeci">static QString GetAVCCodec(const QByteArray &amp;Packet)</div><div class="ttdoc">Determine the 3 byte H.264 codec descriptor string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/torcmuxer_8cpp_source.html#l00245">torcmuxer.cpp:245</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_a047665c434af39f9597e3d95990431a5"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#a047665c434af39f9597e3d95990431a5">TorcOMXComponent::SetConfig</a></div><div class="ttdeci">OMX_ERRORTYPE SetConfig(OMX_INDEXTYPE Index, OMX_PTR Structure)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00287">torcomxcomponent.cpp:287</a></div></div>
<div class="ttc" id="torcloggingdefs_8h_html_a6bb428c1ccb88c717bfa26f1fcc7c33e"><div class="ttname"><a href="../../d1/d37/torcloggingdefs_8h.html#a6bb428c1ccb88c717bfa26f1fcc7c33e">true</a></div><div class="ttdeci">VERBOSE_PREAMBLE true</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/torcloggingdefs_8h_source.html#l00048">torcloggingdefs.h:48</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_a689491f534e30a23bcb3507da36c40eb"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#a689491f534e30a23bcb3507da36c40eb">TorcOMXComponent::DestroyBuffers</a></div><div class="ttdeci">OMX_ERRORTYPE DestroyBuffers(OMX_DIRTYPE Direction, OMX_U32 Index, OMX_INDEXTYPE Domain)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00378">torcomxcomponent.cpp:378</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_af378bb0691606be9f91323188b835ac9"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#af378bb0691606be9f91323188b835ac9">CAMERA_ROTATION</a></div><div class="ttdeci">#define CAMERA_ROTATION</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00063">torcpicamera.cpp:63</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a669b5852085719e297cff4945800f005"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a669b5852085719e297cff4945800f005">TorcCameraDevice::m_ringBufferLock</a></div><div class="ttdeci">QReadWriteLock m_ringBufferLock</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00111">torccamera.h:111</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_aa93dd7b7f0ad6dd542fb56c61b3b6f42"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#aa93dd7b7f0ad6dd542fb56c61b3b6f42">TorcOMXComponent::IsValid</a></div><div class="ttdeci">bool IsValid(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00180">torcomxcomponent.cpp:180</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_a9cf694bde813b04d910fe5f08c7badc1"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#a9cf694bde813b04d910fe5f08c7badc1">TorcPiCamera::Stop</a></div><div class="ttdeci">bool Stop(void) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00422">torcpicamera.cpp:422</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a5a4b2e687194b467bc05931c77e9dd8a"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a5a4b2e687194b467bc05931c77e9dd8a">ENCODER_QP</a></div><div class="ttdeci">#define ENCODER_QP</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00074">torcpicamera.cpp:74</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_abda579266812efec4ac60c130cbd54b5"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#abda579266812efec4ac60c130cbd54b5">ENCODER_QP_I</a></div><div class="ttdeci">#define ENCODER_QP_I</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00075">torcpicamera.cpp:75</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a0c124658db3959b851d7b4b59dca3d94"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a0c124658db3959b851d7b4b59dca3d94">TorcCameraDevice::WritingStarted</a></div><div class="ttdeci">void WritingStarted(void)</div></div>
<div class="ttc" id="class_torc_muxer_html_a14c2e7df6e41835fea3fdd9e3a823187"><div class="ttname"><a href="../../d2/d10/class_torc_muxer.html#a14c2e7df6e41835fea3fdd9e3a823187">TorcMuxer::AddPacket</a></div><div class="ttdeci">bool AddPacket(AVPacket *Packet, bool CodecConfig)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/torcmuxer_8cpp_source.html#l00436">torcmuxer.cpp:436</a></div></div>
<div class="ttc" id="torcpicamera_8h_html"><div class="ttname"><a href="../../d0/dd4/torcpicamera_8h.html">torcpicamera.h</a></div></div>
<div class="ttc" id="class_torc_camera_params_html_a86b0fffd61fc2be8e57253f5cf19668d"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html#a86b0fffd61fc2be8e57253f5cf19668d">TorcCameraParams::m_frameRate</a></div><div class="ttdeci">int m_frameRate</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00053">torccamera.h:53</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a9594030c74b200cc53279ce37524fc91"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a9594030c74b200cc53279ce37524fc91">ENCODER_SEI</a></div><div class="ttdeci">#define ENCODER_SEI</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00077">torcpicamera.cpp:77</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a0cc36f01104ed3b4e56ab1a429010b1b"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a0cc36f01104ed3b4e56ab1a429010b1b">CAMERA_ROI_LEFT</a></div><div class="ttdeci">#define CAMERA_ROI_LEFT</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00069">torcpicamera.cpp:69</a></div></div>
<div class="ttc" id="class_torc_timer_html_a6612b5aa2271a59e5cb85f8d8f19188f"><div class="ttname"><a href="../../da/da4/class_torc_timer.html#a6612b5aa2271a59e5cb85f8d8f19188f">TorcTimer::Start</a></div><div class="ttdeci">void Start(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dde/torctimer_8cpp_source.html#l00009">torctimer.cpp:9</a></div></div>
<div class="ttc" id="torclogging_8h_html"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html">torclogging.h</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a862deba4a0034a552002ca4162f6c676"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a862deba4a0034a552002ca4162f6c676">CAMERA_ROI_WIDTH</a></div><div class="ttdeci">#define CAMERA_ROI_WIDTH</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00070">torcpicamera.cpp:70</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a4ba947935dbf8483befe1ceb0daf7f25"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a4ba947935dbf8483befe1ceb0daf7f25">CAMERA_WHITE_BALANCE</a></div><div class="ttdeci">#define CAMERA_WHITE_BALANCE</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00057">torcpicamera.cpp:57</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a5f90851745e92ef6f519f439376a7412"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a5f90851745e92ef6f519f439376a7412">CAMERA_FRAME_STABILIZATION</a></div><div class="ttdeci">#define CAMERA_FRAME_STABILIZATION</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00058">torcpicamera.cpp:58</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a4f1bc79b124abc2a44f6a42c104a44c9"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a4f1bc79b124abc2a44f6a42c104a44c9">BROADCOM_VIDEOSPLITTER</a></div><div class="ttdeci">#define BROADCOM_VIDEOSPLITTER</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00044">torcpicamera.cpp:44</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a5e4d2343ff469c80e9a8920a2f9088a0"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a5e4d2343ff469c80e9a8920a2f9088a0">TorcCameraDevice::m_bufferedPacket</a></div><div class="ttdeci">AVPacket * m_bufferedPacket</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00109">torccamera.h:109</a></div></div>
<div class="ttc" id="class_torc_camera_params_html_a51b3b3b25ab465b6f385f48cdb19927c"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html#a51b3b3b25ab465b6f385f48cdb19927c">TorcCameraParams::m_timebase</a></div><div class="ttdeci">int m_timebase</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00055">torccamera.h:55</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_ace91232e0bcd7a314cedc2710d6dc0d3"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#ace91232e0bcd7a314cedc2710d6dc0d3">TorcPiCameraXSDFactory</a></div><div class="ttdeci">TorcPiCameraXSDFactory TorcPiCameraXSDFactory</div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_a232d37c7db138ef6362d83bc071bf041"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#a232d37c7db138ef6362d83bc071bf041">TorcOMXComponent::EnablePort</a></div><div class="ttdeci">OMX_ERRORTYPE EnablePort(OMX_DIRTYPE Direction, OMX_U32 Index, bool Enable, OMX_INDEXTYPE Domain, bool Wait=true)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00320">torcomxcomponent.cpp:320</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_a794fa0cd433afe68d86e2397723b7786a28cfe4dabda6cd6d86f83de70ffabc9d"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#a794fa0cd433afe68d86e2397723b7786a28cfe4dabda6cd6d86f83de70ffabc9d">TorcPiCamera::V1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd4/torcpicamera_8h_source.html#l00019">torcpicamera.h:19</a></div></div>
<div class="ttc" id="class_torc_muxer_html_a57ae0d84ebf94edb2484b06fd3a20db8"><div class="ttname"><a href="../../d2/d10/class_torc_muxer.html#a57ae0d84ebf94edb2484b06fd3a20db8">TorcMuxer::FinishSegment</a></div><div class="ttdeci">void FinishSegment(bool Init)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/torcmuxer_8cpp_source.html#l00469">torcmuxer.cpp:469</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_a794fa0cd433afe68d86e2397723b7786a641d820c0d6b0ec8ae9564ae9cb86fc9"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#a794fa0cd433afe68d86e2397723b7786a641d820c0d6b0ec8ae9564ae9cb86fc9">TorcPiCamera::V2</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd4/torcpicamera_8h_source.html#l00020">torcpicamera.h:20</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a66a6f9f928bdfe2a5c1abf6d268e9ce8"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a66a6f9f928bdfe2a5c1abf6d268e9ce8">ENCODER_EEDE</a></div><div class="ttdeci">#define ENCODER_EEDE</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00078">torcpicamera.cpp:78</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a83b20eb10509cd0deab162be970fb567"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a83b20eb10509cd0deab162be970fb567">TorcCameraDevice::EnableStills</a></div><div class="ttdeci">virtual bool EnableStills(uint Count)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d11/torccamera_8cpp_source.html#l00340">torccamera.cpp:340</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_aaf50db39b2168af3a1e4c948834ba7ea"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#aaf50db39b2168af3a1e4c948834ba7ea">CAMERA_COLOR_U</a></div><div class="ttdeci">#define CAMERA_COLOR_U</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00065">torcpicamera.cpp:65</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a364b5d59b11aa240054f67f899623ad8"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a364b5d59b11aa240054f67f899623ad8">TorcCameraDevice::m_frameCount</a></div><div class="ttdeci">quint64 m_frameCount</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00107">torccamera.h:107</a></div></div>
<div class="ttc" id="torccamera_8h_html_a763b1027721a78f930377580f17ca758"><div class="ttname"><a href="../../d3/d38/torccamera_8h.html#a763b1027721a78f930377580f17ca758">VIDEO_SEGMENT_TARGET</a></div><div class="ttdeci">#define VIDEO_SEGMENT_TARGET</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00024">torccamera.h:24</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_a5beab970495724e8fa8f7b78d7ba3720"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#a5beab970495724e8fa8f7b78d7ba3720">TorcPiCamera::EnableStills</a></div><div class="ttdeci">bool EnableStills(uint Count) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00916">torcpicamera.cpp:916</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_af380e1df9742759f4dc990701f322a99"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#af380e1df9742759f4dc990701f322a99">CAMERA_ISO</a></div><div class="ttdeci">#define CAMERA_ISO</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00056">torcpicamera.cpp:56</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_aa5556d4abb1cf5584c0a1894f996fe63"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#aa5556d4abb1cf5584c0a1894f996fe63">TorcPiCamera::BufferReady</a></div><div class="ttdeci">void BufferReady(OMX_BUFFERHEADERTYPE *Buffer, quint64 Type)</div><div class="ttdoc">An OpenMax buffer is ready (full) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00245">torcpicamera.cpp:245</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a0e23a8f888bc81dea4fd53634800fef7"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a0e23a8f888bc81dea4fd53634800fef7">BROADCOM_ENCODER</a></div><div class="ttdeci">#define BROADCOM_ENCODER</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00042">torcpicamera.cpp:42</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_aa275da893a8c7a58204e73370b35f8cd"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#aa275da893a8c7a58204e73370b35f8cd">CAMERA_METERING</a></div><div class="ttdeci">#define CAMERA_METERING</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00050">torcpicamera.cpp:50</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_a8bd396ed881d52cc76d57ca4748edbd4"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#a8bd396ed881d52cc76d57ca4748edbd4">TorcPiCamera::Start</a></div><div class="ttdeci">bool Start(void) override</div><div class="ttdoc">Start the camera. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00229">torcpicamera.cpp:229</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_adac374f3533dc8b2ab8fa4a4f42c4706"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#adac374f3533dc8b2ab8fa4a4f42c4706">CAMERA_ROI_HEIGHT</a></div><div class="ttdeci">#define CAMERA_ROI_HEIGHT</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00071">torcpicamera.cpp:71</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a2c762428455ae5a421cb1c2bdc355c1e"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a2c762428455ae5a421cb1c2bdc355c1e">TorcCameraDevice::m_haveInitSegment</a></div><div class="ttdeci">bool m_haveInitSegment</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00108">torccamera.h:108</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_a0e0694ead768dfe91f2e5d2dc09c3f2a"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#a0e0694ead768dfe91f2e5d2dc09c3f2a">TorcOMXComponent::CreateBuffers</a></div><div class="ttdeci">OMX_ERRORTYPE CreateBuffers(OMX_DIRTYPE Direction, OMX_U32 Index, OMX_INDEXTYPE Domain, QObject *Owner=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00367">torcomxcomponent.cpp:367</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a97ab08f8684b12e9d31a4b1c82fbd760"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a97ab08f8684b12e9d31a4b1c82fbd760">CAMERA_CONTRAST</a></div><div class="ttdeci">#define CAMERA_CONTRAST</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00047">torcpicamera.cpp:47</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a052cb741945a6d84a542685794448caa"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a052cb741945a6d84a542685794448caa">CAMERA_BRIGHTNESS</a></div><div class="ttdeci">#define CAMERA_BRIGHTNESS</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00048">torcpicamera.cpp:48</a></div></div>
<div class="ttc" id="class_torc_camera_params_html_a148f3d8696129cbc40de0bd5b76027f3"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html#a148f3d8696129cbc40de0bd5b76027f3">TorcCameraParams::m_height</a></div><div class="ttdeci">int m_height</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00050">torccamera.h:50</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_af9c832629487bda061b70df0c8f1447f"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#af9c832629487bda061b70df0c8f1447f">CAMERA_ISO_AUTO</a></div><div class="ttdeci">#define CAMERA_ISO_AUTO</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00055">torcpicamera.cpp:55</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a55b04c0f63acdac0d669f49c00efb279"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a55b04c0f63acdac0d669f49c00efb279">TorcCameraDevice::m_videoStream</a></div><div class="ttdeci">int m_videoStream</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00106">torccamera.h:106</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a853445f1aeec2ca3107cb20ff83d56e3"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a853445f1aeec2ca3107cb20ff83d56e3">ENCODER_SPS_TIMING</a></div><div class="ttdeci">#define ENCODER_SPS_TIMING</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00081">torcpicamera.cpp:81</a></div></div>
<div class="ttc" id="class_torc_pi_camera_factory_html_a7753d0a4e80b4133d3fd9a7d7cf0c1ff"><div class="ttname"><a href="../../db/dd3/class_torc_pi_camera_factory.html#a7753d0a4e80b4133d3fd9a7d7cf0c1ff">TorcPiCameraFactory::CanHandle</a></div><div class="ttdeci">bool CanHandle(const QString &amp;Type, const TorcCameraParams &amp;Params) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00950">torcpicamera.cpp:950</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a4290f8ebc7936700fe1b22ceb49efd58"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a4290f8ebc7936700fe1b22ceb49efd58">CAMERA_MIRROR</a></div><div class="ttdeci">#define CAMERA_MIRROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00062">torcpicamera.cpp:62</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a18aa65f8c3dd74eabdd406eefdfc03a0"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a18aa65f8c3dd74eabdd406eefdfc03a0">CAMERA_DRC</a></div><div class="ttdeci">#define CAMERA_DRC</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00072">torcpicamera.cpp:72</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a9433bfd324f3e45bcc9b055c6a3f1524"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a9433bfd324f3e45bcc9b055c6a3f1524">BROADCOM_NULLSINK</a></div><div class="ttdeci">#define BROADCOM_NULLSINK</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00043">torcpicamera.cpp:43</a></div></div>
<div class="ttc" id="torccentral_8h_html"><div class="ttname"><a href="../../d5/d41/torccentral_8h.html">torccentral.h</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a1baa4ea490967f823d9480f1e8fa4250"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a1baa4ea490967f823d9480f1e8fa4250">TorcCameraDevice::ParametersChanged</a></div><div class="ttdeci">void ParametersChanged(TorcCameraParams &amp;Params)</div></div>
<div class="ttc" id="torcpicamera_8cpp_html_ac3439ee3abb76c10961f60f007d10647"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#ac3439ee3abb76c10961f60f007d10647">ENCODER_EEDE_LOSS_RATE</a></div><div class="ttdeci">#define ENCODER_EEDE_LOSS_RATE</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00079">torcpicamera.cpp:79</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_ad85c86655794f26e3d65c77c92cf2ed1"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#ad85c86655794f26e3d65c77c92cf2ed1">piCameraType</a></div><div class="ttdeci">static const QString piCameraType</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00928">torcpicamera.cpp:928</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_a9a051570f47077ed79947acc55048056"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#a9a051570f47077ed79947acc55048056">TorcOMXComponent::GetAvailableBuffers</a></div><div class="ttdeci">OMX_U32 GetAvailableBuffers(OMX_DIRTYPE Direction, OMX_U32 Index, OMX_INDEXTYPE Domain)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00331">torcomxcomponent.cpp:331</a></div></div>
<div class="ttc" id="class_torc_pi_camera_x_s_d_factory_html_a93ed366b3e579c12fc1bb6cc8096ec34"><div class="ttname"><a href="../../d1/d6b/class_torc_pi_camera_x_s_d_factory.html#a93ed366b3e579c12fc1bb6cc8096ec34">TorcPiCameraXSDFactory::GetXSD</a></div><div class="ttdeci">void GetXSD(QMultiMap&lt; QString, QString &gt; &amp;XSD)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00934">torcpicamera.cpp:934</a></div></div>
<div class="ttc" id="class_torc_pi_camera_factory_html_aaf27a1b3d288f3bb47bbf73a63db13a1"><div class="ttname"><a href="../../db/dd3/class_torc_pi_camera_factory.html#aaf27a1b3d288f3bb47bbf73a63db13a1">TorcPiCameraFactory::TorcPiCameraFactory</a></div><div class="ttdeci">TorcPiCameraFactory()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00940">torcpicamera.cpp:940</a></div></div>
<div class="ttc" id="class_torc_pi_camera_factory_html"><div class="ttname"><a href="../../db/dd3/class_torc_pi_camera_factory.html">TorcPiCameraFactory</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00937">torcpicamera.cpp:937</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a553c6df06d2cf696ff202fa00962059e"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a553c6df06d2cf696ff202fa00962059e">CAMERA_IMAGE_FILTER</a></div><div class="ttdeci">#define CAMERA_IMAGE_FILTER</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00061">torcpicamera.cpp:61</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_af21b64e6a8d51587f9e113ea5afec9ae"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#af21b64e6a8d51587f9e113ea5afec9ae">TorcCameraDevice::Setup</a></div><div class="ttdeci">virtual bool Setup(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d11/torccamera_8cpp_source.html#l00285">torccamera.cpp:285</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_aa10b4831877c9c69e9ae8e83b08408b3"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#aa10b4831877c9c69e9ae8e83b08408b3">TorcPiCamera::Setup</a></div><div class="ttdeci">bool Setup(void) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00133">torcpicamera.cpp:133</a></div></div>
<div class="ttc" id="torcdirectories_8h_html"><div class="ttname"><a href="../../d1/d6c/torcdirectories_8h.html">torcdirectories.h</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_a52492cdf821968684ac1949fe3b5d2a8"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#a52492cdf821968684ac1949fe3b5d2a8">TorcOMXComponent::GetParameter</a></div><div class="ttdeci">OMX_ERRORTYPE GetParameter(OMX_INDEXTYPE Index, OMX_PTR Structure)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00276">torcomxcomponent.cpp:276</a></div></div>
<div class="ttc" id="class_torc_x_s_d_factory_html"><div class="ttname"><a href="../../d5/d5d/class_torc_x_s_d_factory.html">TorcXSDFactory</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d41/torccentral_8h_source.html#l00067">torccentral.h:67</a></div></div>
<div class="ttc" id="torccentral_8h_html_a36f5b43196227a2af74ac97b1abd3e6a"><div class="ttname"><a href="../../d5/d41/torccentral_8h.html#a36f5b43196227a2af74ac97b1abd3e6a">XSD_CAMERATYPES</a></div><div class="ttdeci">#define XSD_CAMERATYPES</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d41/torccentral_8h_source.html#l00065">torccentral.h:65</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a120561ba8b7e7bc0cad270c636bfd8c1"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a120561ba8b7e7bc0cad270c636bfd8c1">CAMERA_EXPOSURE</a></div><div class="ttdeci">#define CAMERA_EXPOSURE</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00051">torcpicamera.cpp:51</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a037c02f4478d15850c451dda15bac9e8"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a037c02f4478d15850c451dda15bac9e8">ENCODER_INLINE_HEADERS</a></div><div class="ttdeci">#define ENCODER_INLINE_HEADERS</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00080">torcpicamera.cpp:80</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_af0bf7f61acad562996191bf34e627b8e"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#af0bf7f61acad562996191bf34e627b8e">TorcOMXComponent::GetConfig</a></div><div class="ttdeci">OMX_ERRORTYPE GetConfig(OMX_INDEXTYPE Index, OMX_PTR Structure)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00298">torcomxcomponent.cpp:298</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a7032657a6f07cb58524050ff4e287c71"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a7032657a6f07cb58524050ff4e287c71">TorcCameraDevice::m_stillsRequired</a></div><div class="ttdeci">uint m_stillsRequired</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00118">torccamera.h:118</a></div></div>
<div class="ttc" id="class_torc_camera_params_html_a3d2856c5a5ed0bb283bc02f834796bca"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html#a3d2856c5a5ed0bb283bc02f834796bca">TorcCameraParams::m_stride</a></div><div class="ttdeci">int m_stride</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00051">torccamera.h:51</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_ae83bcf0a54d9a5badb22fd0c3045270b"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#ae83bcf0a54d9a5badb22fd0c3045270b">TorcCameraDevice::SaveStill</a></div><div class="ttdeci">void SaveStill(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d11/torccamera_8cpp_source.html#l00347">torccamera.cpp:347</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a75ab4292e3b5c80bff2fce9b1d6ee703"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a75ab4292e3b5c80bff2fce9b1d6ee703">TorcCameraDevice::m_stillsExpected</a></div><div class="ttdeci">uint m_stillsExpected</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00119">torccamera.h:119</a></div></div>
<div class="ttc" id="class_torc_camera_params_html_aa0018394b4f4f34c007357173bf9f21c"><div class="ttname"><a href="../../da/dfa/class_torc_camera_params.html#aa0018394b4f4f34c007357173bf9f21c">TorcCameraParams::m_bitrate</a></div><div class="ttdeci">int m_bitrate</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00054">torccamera.h:54</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a8014243cc035b594f05ed7ef697872da"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a8014243cc035b594f05ed7ef697872da">TorcPiCameraFactory</a></div><div class="ttdeci">TorcPiCameraFactory TorcPiCameraFactory</div></div>
<div class="ttc" id="class_torc_o_m_x_tunnel_html_aecf99a01042aa48505654a8c97962a31"><div class="ttname"><a href="../../d3/db6/class_torc_o_m_x_tunnel.html#aecf99a01042aa48505654a8c97962a31">TorcOMXTunnel::Destroy</a></div><div class="ttdeci">OMX_ERRORTYPE Destroy(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d47/torcomxtunnel_8cpp_source.html#l00091">torcomxtunnel.cpp:91</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_a42e54a5b8d6bdf092bdabfe86e039956"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#a42e54a5b8d6bdf092bdabfe86e039956">TorcPiCamera::StartStill</a></div><div class="ttdeci">void StartStill(void) override</div><div class="ttdoc">Start capturing a still image buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00273">torcpicamera.cpp:273</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a3ba6874e7221f8482559cae4759d0a7e"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a3ba6874e7221f8482559cae4759d0a7e">BROADCOM_IMAGEENCODER</a></div><div class="ttdeci">#define BROADCOM_IMAGEENCODER</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00045">torcpicamera.cpp:45</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a114fb4fb4915926ac2005392f6faa62c"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a114fb4fb4915926ac2005392f6faa62c">TorcCameraDevice::WritingStopped</a></div><div class="ttdeci">void WritingStopped(void)</div></div>
<div class="ttc" id="class_torc_camera_device_html_ac056fbe706cb6173807cfcd5c6b8df6e"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#ac056fbe706cb6173807cfcd5c6b8df6e">TorcCameraDevice::m_muxer</a></div><div class="ttdeci">TorcMuxer * m_muxer</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00105">torccamera.h:105</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_af419407f055801805856c57d9ef98593"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#af419407f055801805856c57d9ef98593">CAMERA_NOISE_REDUCTION</a></div><div class="ttdeci">#define CAMERA_NOISE_REDUCTION</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00067">torcpicamera.cpp:67</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_abf063264438c8ac42304dc3c1367464c"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#abf063264438c8ac42304dc3c1367464c">TorcOMXComponent::SetParameter</a></div><div class="ttdeci">OMX_ERRORTYPE SetParameter(OMX_INDEXTYPE Index, OMX_PTR Structure)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00265">torcomxcomponent.cpp:265</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a618416aa7755b2cd0a357ed2306e8d22"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a618416aa7755b2cd0a357ed2306e8d22">CAMERA_SATURATION</a></div><div class="ttdeci">#define CAMERA_SATURATION</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00049">torcpicamera.cpp:49</a></div></div>
<div class="ttc" id="class_torc_camera_device_html"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html">TorcCameraDevice</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00064">torccamera.h:64</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_a8d82f9db8f4d15db9c47f31a5addaff6"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#a8d82f9db8f4d15db9c47f31a5addaff6">TorcOMXComponent::WaitForResponse</a></div><div class="ttdeci">OMX_ERRORTYPE WaitForResponse(OMX_U32 Command, OMX_U32 Data2, OMX_S32 Timeout)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00464">torcomxcomponent.cpp:464</a></div></div>
<div class="ttc" id="torccamera_8h_html_a3f542686e057eba94fa3f3f35f2ce2f3"><div class="ttname"><a href="../../d3/d38/torccamera_8h.html#a3f542686e057eba94fa3f3f35f2ce2f3">VIDEO_GOPDURA_TARGET</a></div><div class="ttdeci">#define VIDEO_GOPDURA_TARGET</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d38/torccamera_8h_source.html#l00025">torccamera.h:25</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_ac3ec403f5d031aa8d9342e78208da03c"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#ac3ec403f5d031aa8d9342e78208da03c">TorcPiCamera::gPiCameraDetected</a></div><div class="ttdeci">static bool gPiCameraDetected</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd4/torcpicamera_8h_source.html#l00023">torcpicamera.h:23</a></div></div>
<div class="ttc" id="torclogging_8h_html_a73a147108bf0df6442820b82b022ef94"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a></div><div class="ttdeci">#define LOG(_MASK_, _LEVEL_, _FORMAT_,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df9/torclogging_8h_source.html#l00031">torclogging.h:31</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_aef16c41057880802b59a2f3b45da850e"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#aef16c41057880802b59a2f3b45da850e">TorcCameraDevice::SaveStillBuffer</a></div><div class="ttdeci">void SaveStillBuffer(quint32 Length, uint8_t *Data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d11/torccamera_8cpp_source.html#l00377">torccamera.cpp:377</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a86136ee5adbac1d39308d89bdf1ec051"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a86136ee5adbac1d39308d89bdf1ec051">CAMERA_SHUTTER_SPEED_AUTO</a></div><div class="ttdeci">#define CAMERA_SHUTTER_SPEED_AUTO</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00053">torcpicamera.cpp:53</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a15dd304042e8813e5ddb1d01cd17d894"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a15dd304042e8813e5ddb1d01cd17d894">CAMERA_EXPOSURE_COMPENSATION</a></div><div class="ttdeci">#define CAMERA_EXPOSURE_COMPENSATION</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00052">torcpicamera.cpp:52</a></div></div>
<div class="ttc" id="class_torc_pi_camera_x_s_d_factory_html"><div class="ttname"><a href="../../d1/d6b/class_torc_pi_camera_x_s_d_factory.html">TorcPiCameraXSDFactory</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00931">torcpicamera.cpp:931</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a6ab7dcbe8f8b98310bef8c23afab94a1"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a6ab7dcbe8f8b98310bef8c23afab94a1">CAMERA_SHARPNESS</a></div><div class="ttdeci">#define CAMERA_SHARPNESS</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00046">torcpicamera.cpp:46</a></div></div>
<div class="ttc" id="class_torc_pi_camera_factory_html_a591de8c558c5d1d912eb84189cd43ced"><div class="ttname"><a href="../../db/dd3/class_torc_pi_camera_factory.html#a591de8c558c5d1d912eb84189cd43ced">TorcPiCameraFactory::~TorcPiCameraFactory</a></div><div class="ttdeci">virtual ~TorcPiCameraFactory()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00945">torcpicamera.cpp:945</a></div></div>
<div class="ttc" id="torcpicamera_8cpp_html_a547b331ceb80a6a72367643adfab62ed"><div class="ttname"><a href="../../d7/de1/torcpicamera_8cpp.html#a547b331ceb80a6a72367643adfab62ed">CAMERA_WHITE_BALANCE_BLUE_GAIN</a></div><div class="ttdeci">#define CAMERA_WHITE_BALANCE_BLUE_GAIN</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00060">torcpicamera.cpp:60</a></div></div>
<div class="ttc" id="class_torc_pi_camera_html_a023c86ca3d03436346554fb0621dc9f0"><div class="ttname"><a href="../../da/da1/class_torc_pi_camera.html#a023c86ca3d03436346554fb0621dc9f0">TorcPiCamera::StreamVideo</a></div><div class="ttdeci">void StreamVideo(bool Video) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l00128">torcpicamera.cpp:128</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_aadca0a2e0d591a065f98fdc0db669b75"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#aadca0a2e0d591a065f98fdc0db669b75">TorcOMXComponent::FillThisBuffer</a></div><div class="ttdeci">OMX_ERRORTYPE FillThisBuffer(OMX_BUFFERHEADERTYPE *Buffer)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00358">torcomxcomponent.cpp:358</a></div></div>
<div class="ttc" id="class_torc_camera_device_html_a992e4b35f2699695d4bc59cc96ff1083"><div class="ttname"><a href="../../d3/dfd/class_torc_camera_device.html#a992e4b35f2699695d4bc59cc96ff1083">TorcCameraDevice::TrackDrift</a></div><div class="ttdeci">void TrackDrift(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d11/torccamera_8cpp_source.html#l00393">torccamera.cpp:393</a></div></div>
<div class="ttc" id="class_torc_timer_html_ac75eda8ade73ae5d5ac0b3989f202c90"><div class="ttname"><a href="../../da/da4/class_torc_timer.html#ac75eda8ade73ae5d5ac0b3989f202c90">TorcTimer::Elapsed</a></div><div class="ttdeci">int Elapsed(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dde/torctimer_8cpp_source.html#l00022">torctimer.cpp:22</a></div></div>
<div class="ttc" id="class_torc_pi_camera_factory_html_a17a34ce858b3328be5059f8ec02327f3"><div class="ttname"><a href="../../db/dd3/class_torc_pi_camera_factory.html#a17a34ce858b3328be5059f8ec02327f3">TorcPiCameraFactory::Create</a></div><div class="ttdeci">TorcCameraDevice * Create(const QString &amp;Type, const TorcCameraParams &amp;Params) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de1/torcpicamera_8cpp_source.html#l01001">torcpicamera.cpp:1001</a></div></div>
<div class="ttc" id="class_torc_o_m_x_component_html_ad55d3d1a2ec01c2696478c7ad3df03e9"><div class="ttname"><a href="../../de/d1d/class_torc_o_m_x_component.html#ad55d3d1a2ec01c2696478c7ad3df03e9">TorcOMXComponent::DisablePorts</a></div><div class="ttdeci">OMX_ERRORTYPE DisablePorts(OMX_INDEXTYPE Domain)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc0/torcomxcomponent_8cpp_source.html#l00521">torcomxcomponent.cpp:521</a></div></div>
<div class="ttc" id="torcomxcore_8h_html_a40673723bd05b7de217749e909cc5370"><div class="ttname"><a href="../../d7/df9/torcomxcore_8h.html#a40673723bd05b7de217749e909cc5370">OMX_INITSTRUCTURE</a></div><div class="ttdeci">#define OMX_INITSTRUCTURE(Struct)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/torcomxcore_8h_source.html#l00028">torcomxcore.h:28</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Dec 2 2018 11:05:39 for Torc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
