<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Torc: torchttpservice.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Torc
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_19e1fafdf157c27762559b97f5d6a2d3.html">torc</a></li><li class="navelem"><a class="el" href="../../dir_5dec6d08b23834b4bbcf2e66f6498dfa.html">http</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">torchttpservice.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d1/d77/torchttpservice_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Class TorcHTTPService</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">* This file is part of the Torc project.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">* Copyright (C) Mark Kendall 2012-18</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">* This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">* it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">* the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">* (at your option) any later version.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">* This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">* but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">* GNU General Public License for more details.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">* You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">* along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">* Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">* USA.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// Qt</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;QObject&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;QMetaType&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;QMetaMethod&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;QTime&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;QDate&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;QDateTime&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// Torc</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/torclocaldefs_8h.html">torclocaldefs.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/df9/torclogging_8h.html">torclogging.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/da5/torcnetwork_8h.html">torcnetwork.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d1b/torchttpserver_8h.html">torchttpserver.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dd5/torcjsonrpc_8h.html">torcjsonrpc.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/def/torcserialiser_8h.html">torcserialiser.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dee/torchttpservice_8h.html">torchttpservice.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/dbd/torcexitcodes_8h.html">torcexitcodes.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html">   41</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../de/db3/class_method_parameters.html">MethodParameters</a></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;{</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keyword">public</span>:</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a5897d0656cab3970e52886eb57ddc69e">   44</a></span>&#160;    <a class="code" href="../../de/db3/class_method_parameters.html#a5897d0656cab3970e52886eb57ddc69e">MethodParameters</a>(<span class="keywordtype">int</span> Index, <span class="keyword">const</span> QMetaMethod &amp;Method, <span class="keywordtype">int</span> AllowedRequestTypes, <span class="keyword">const</span> QString &amp;ReturnType)</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      : <a class="code" href="../../de/db3/class_method_parameters.html#a7448b98a6e687dc463cd174b3315f698">m_valid</a>(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#acbf022eef03a92222783b8c7f5adf712">m_index</a>(Index),</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>(),</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>(),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#a8333d02478e357f17236fce0c925e0f8">m_allowedRequestTypes</a>(AllowedRequestTypes),</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#a33939b36b57e1a817425eadb9371ccf2">m_returnType</a>(ReturnType),</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#ab9d556343c0bed3667a686a691a816fd">m_method</a>(Method)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="comment">// statically initialise the list of unsupported types (either non-serialisable (QHash)</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="comment">// or nonsensical (pointer types)</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keyword">static</span> QList&lt;int&gt; unsupportedtypes;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="keyword">static</span> QList&lt;int&gt; unsupportedparameters;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">bool</span> initialised = <span class="keyword">false</span>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">if</span> (!initialised)</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="comment">// this list is probably incomplete</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            initialised = <span class="keyword">true</span>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            unsupportedtypes &lt;&lt; QMetaType::UnknownType;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            unsupportedtypes &lt;&lt; QMetaType::VoidStar &lt;&lt; QMetaType::QObjectStar &lt;&lt; QMetaType::QVariantHash;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            unsupportedtypes &lt;&lt; QMetaType::QRect &lt;&lt; QMetaType::QRectF &lt;&lt; QMetaType::QSize &lt;&lt; QMetaType::QSizeF &lt;&lt; QMetaType::QLine &lt;&lt; QMetaType::QLineF &lt;&lt; QMetaType::QPoint &lt;&lt; QMetaType::QPointF;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            unsupportedparameters &lt;&lt; unsupportedtypes;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            unsupportedparameters &lt;&lt; QMetaType::QVariantMap &lt;&lt; QMetaType::QStringList &lt;&lt; QMetaType::QVariantList;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="comment">// the return type/value is first</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordtype">int</span> returntype = QMetaType::type(Method.typeName());</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="comment">// discard slots with an unsupported return type</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">if</span> (unsupportedtypes.contains(returntype))</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Method &#39;%1&#39; has unsupported return type &#39;%2&#39;&quot;</span>).arg(Method.name().data()).arg(Method.typeName()));</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="comment">// discard overly complicated slots not supported by QMetaMethod</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> (Method.parameterCount() &gt; 10)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Method &#39;%1&#39; takes more than 10 parameters - ignoring&quot;</span>).arg(Method.name().data()));</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>.append(returntype &gt; 0 ? returntype : 0);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>.append(Method.name());</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        QList&lt;QByteArray&gt; names = Method.parameterNames();</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        QList&lt;QByteArray&gt; types = Method.parameterTypes();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">// add type/value for each method parameter</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; names.size(); ++i)</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keywordtype">int</span> type = QMetaType::type(types[i]);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <span class="comment">// discard slots that use unsupported parameter types</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="keywordflow">if</span> (unsupportedparameters.contains(type))</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Method &#39;%1&#39; has unsupported parameter type &#39;%2&#39;&quot;</span>)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    .arg(Method.name().data()).arg(types[i].data()));</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>.append(names[i]);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>.append(type);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#a7448b98a6e687dc463cd174b3315f698">m_valid</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a4f5fbd20d623d12d06c69953279eba54">  114</a></span>&#160;    <a class="code" href="../../de/db3/class_method_parameters.html#a4f5fbd20d623d12d06c69953279eba54">~MethodParameters</a>()</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#af4b498dd485b5ba32706c9aa9b03e230">  122</a></span>&#160;    QVariant <a class="code" href="../../de/db3/class_method_parameters.html#af4b498dd485b5ba32706c9aa9b03e230">Invoke</a>(QObject *Object, <span class="keyword">const</span> QMap&lt;QString,QString&gt; &amp;Queries, QString &amp;ReturnType, <span class="keywordtype">bool</span> &amp;VoidResult)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="comment">// this may be called by multiple threads simultaneously, so we need to create our own paramaters instance.</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="comment">// N.B. QMetaObject::invokeMethod only supports up to 10 arguments (plus a return value)</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordtype">void</span>* parameters[11];</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        memset(parameters, 0, 11 * <span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*));</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordtype">int</span> size = qMin(11, <a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>.size());</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="comment">// check parameter count</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (Queries.size() != size - 1)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Method &#39;%1&#39; expects %2 parameters, sent %3&quot;</span>)</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                .arg(<a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>[0].data()).arg(size - 1).arg(Queries.size()));</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="keywordflow">return</span> QVariant();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment">// populate parameters from query and ensure each parameter is listed</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        QMap&lt;QString,QString&gt;::const_iterator it;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; ++i)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            parameters[i] = QMetaType::create(<a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>[i]);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">if</span> (i)</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                it = Queries.constFind(<a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>[i]);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keywordflow">if</span> (it == Queries.end())</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Parameter &#39;%1&#39; for method &#39;%2&#39; is missing&quot;</span>)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                        .arg(<a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>[i].data()).arg(<a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>[0].data()));</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                    <span class="keywordflow">return</span> QVariant();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <a class="code" href="../../de/db3/class_method_parameters.html#a0f2c2cb7593e510e9169a5a28b9546e2">SetValue</a>(parameters[i], it.value(), <a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>[i]);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">if</span> (Object-&gt;qt_metacall(QMetaObject::InvokeMetaMethod, <a class="code" href="../../de/db3/class_method_parameters.html#acbf022eef03a92222783b8c7f5adf712">m_index</a>, parameters) &gt; -1)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;qt_metacall error&quot;</span>);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// handle QVariant return type where we don&#39;t want to lose visibility of the underlying type</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordtype">int</span> type = <a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>[0];</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">if</span> (type == QMetaType::QVariant)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordtype">int</span> newtype = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<span class="keyword">reinterpret_cast&lt;</span>QVariant*<span class="keyword">&gt;</span>(parameters[0])-&gt;type());</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">if</span> (newtype != type)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                type = newtype;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">// we cannot create a QVariant that is void and an invalid QVariant signals an error state,</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">// so flag directly</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        VoidResult      = type == QMetaType::Void;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        QVariant result = type == QMetaType::Void ? QVariant() : QVariant(type, parameters[0]);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment">// free allocated parameters</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; ++i)</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keywordflow">if</span> (parameters[i])</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                QMetaType::destroy(<a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>.data()[i], parameters[i]);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        ReturnType = <a class="code" href="../../de/db3/class_method_parameters.html#a33939b36b57e1a817425eadb9371ccf2">m_returnType</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a0f2c2cb7593e510e9169a5a28b9546e2">  182</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/db3/class_method_parameters.html#a0f2c2cb7593e510e9169a5a28b9546e2">SetValue</a>(<span class="keywordtype">void</span>* Pointer, <span class="keyword">const</span> QString &amp;Value, <span class="keywordtype">int</span> Type)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">if</span> (!Pointer)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">switch</span> (Type)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keywordflow">case</span> QMetaType::QVariant:   *((QVariant*)Pointer)      = QVariant(Value); <span class="keywordflow">return</span>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <span class="keywordflow">case</span> QMetaType::Char:       *((<span class="keywordtype">char</span>*)Pointer)          = Value.isEmpty() ? 0 : Value.at(0).toLatin1(); <span class="keywordflow">return</span>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">case</span> QMetaType::UChar:      *((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)Pointer) = Value.isEmpty() ? 0 :Value.at(0).toLatin1();  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">case</span> QMetaType::QChar:      *((QChar*)Pointer)         = Value.isEmpty() ? 0 : Value.at(0);            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="keywordflow">case</span> QMetaType::Bool:       *((<span class="keywordtype">bool</span>*)Pointer)          = <a class="code" href="../../de/db3/class_method_parameters.html#afe1f66c90941360705cf5023d2897f96">ToBool</a>(Value);       <span class="keywordflow">return</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">case</span> QMetaType::Short:      *((<span class="keywordtype">short</span>*)Pointer)         = Value.toShort();     <span class="keywordflow">return</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keywordflow">case</span> QMetaType::UShort:     *((ushort*)Pointer)        = Value.toUShort();    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">case</span> QMetaType::Int:        *((<span class="keywordtype">int</span>*)Pointer)           = Value.toInt();       <span class="keywordflow">return</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">case</span> QMetaType::UInt:       *((uint*)Pointer)          = Value.toUInt();      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="keywordflow">case</span> QMetaType::Long:       *((<span class="keywordtype">long</span>*)Pointer)          = Value.toLong();      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">case</span> QMetaType::ULong:      *((ulong*)Pointer)         = Value.toULong();     <span class="keywordflow">return</span>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordflow">case</span> QMetaType::LongLong:   *((qlonglong*)Pointer)     = Value.toLongLong();  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">case</span> QMetaType::ULongLong:  *((qulonglong*)Pointer)    = Value.toULongLong(); <span class="keywordflow">return</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">case</span> QMetaType::Double:     *((<span class="keywordtype">double</span>*)Pointer)        = Value.toDouble();    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="keywordflow">case</span> QMetaType::Float:      *((<span class="keywordtype">float</span>*)Pointer)         = Value.toFloat();     <span class="keywordflow">return</span>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="keywordflow">case</span> QMetaType::QString:    *((QString*)Pointer)       = Value;               <span class="keywordflow">return</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">case</span> QMetaType::QByteArray: *((QByteArray*)Pointer)    = Value.toUtf8();      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">case</span> QMetaType::QTime:      *((QTime*)Pointer)         = QTime::fromString(Value, Qt::ISODate); <span class="keywordflow">return</span>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="keywordflow">case</span> QMetaType::QDate:      *((QDate*)Pointer)         = QDate::fromString(Value, Qt::ISODate); <span class="keywordflow">return</span>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">case</span> QMetaType::QDateTime:</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                QDateTime dt = QDateTime::fromString(Value, Qt::ISODate);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                dt.setTimeSpec(Qt::UTC);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                *((QDateTime*)Pointer) = dt;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#afe1f66c90941360705cf5023d2897f96">  219</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../de/db3/class_method_parameters.html#afe1f66c90941360705cf5023d2897f96">ToBool</a>(<span class="keyword">const</span> QString &amp;Value)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">if</span> (Value.compare(<span class="stringliteral">&quot;1&quot;</span>, Qt::CaseInsensitive) == 0)</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">if</span> (Value.compare(<span class="stringliteral">&quot;true&quot;</span>, Qt::CaseInsensitive) == 0)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">if</span> (Value.compare(<span class="stringliteral">&quot;y&quot;</span>, Qt::CaseInsensitive) == 0)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">if</span> (Value.compare(<span class="stringliteral">&quot;yes&quot;</span>, Qt::CaseInsensitive) == 0)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#aeac021817bc96ec1b5c1d2024fea4c3b">  234</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../de/db3/class_method_parameters.html#aeac021817bc96ec1b5c1d2024fea4c3b">Disable</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html#a8333d02478e357f17236fce0c925e0f8">m_allowedRequestTypes</a> |= <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8414b2ef47b99859c869617874e6e647">HTTPDisabled</a>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a1be08f25dbbfc259d5f5a04694752a0d">  241</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../de/db3/class_method_parameters.html#a1be08f25dbbfc259d5f5a04694752a0d">Enable</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../de/db3/class_method_parameters.html#a8333d02478e357f17236fce0c925e0f8">m_allowedRequestTypes</a> &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8414b2ef47b99859c869617874e6e647">HTTPDisabled</a>)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <a class="code" href="../../de/db3/class_method_parameters.html#a8333d02478e357f17236fce0c925e0f8">m_allowedRequestTypes</a> -= <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8414b2ef47b99859c869617874e6e647">HTTPDisabled</a>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a7448b98a6e687dc463cd174b3315f698">  247</a></span>&#160;    <span class="keywordtype">bool</span>                <a class="code" href="../../de/db3/class_method_parameters.html#a7448b98a6e687dc463cd174b3315f698">m_valid</a>;</div><div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#acbf022eef03a92222783b8c7f5adf712">  248</a></span>&#160;    <span class="keywordtype">int</span>                 <a class="code" href="../../de/db3/class_method_parameters.html#acbf022eef03a92222783b8c7f5adf712">m_index</a>;</div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">  249</a></span>&#160;    QVector&lt;QByteArray&gt; <a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>;</div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">  250</a></span>&#160;    QVector&lt;int&gt;        <a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>;</div><div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a8333d02478e357f17236fce0c925e0f8">  251</a></span>&#160;    <span class="keywordtype">int</span>                 <a class="code" href="../../de/db3/class_method_parameters.html#a8333d02478e357f17236fce0c925e0f8">m_allowedRequestTypes</a>;</div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#a33939b36b57e1a817425eadb9371ccf2">  252</a></span>&#160;    QString             <a class="code" href="../../de/db3/class_method_parameters.html#a33939b36b57e1a817425eadb9371ccf2">m_returnType</a>;</div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="../../de/db3/class_method_parameters.html#ab9d556343c0bed3667a686a691a816fd">  253</a></span>&#160;    QMetaMethod         <a class="code" href="../../de/db3/class_method_parameters.html#ab9d556343c0bed3667a686a691a816fd">m_method</a>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;};</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#a55153cb0d62acbf9071621fa53577c83">  261</a></span>&#160;<a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#a55153cb0d62acbf9071621fa53577c83">TorcHTTPService::TorcHTTPService</a>(QObject *Parent, <span class="keyword">const</span> QString &amp;Signature, <span class="keyword">const</span> QString &amp;Name,</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                 <span class="keyword">const</span> QMetaObject &amp;MetaObject, <span class="keyword">const</span> QString &amp;Blacklist)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  : <a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html">TorcHTTPHandler</a>(<a class="code" href="../../db/db2/torclocaldefs_8h.html#af610adff33b187f7493ed93a70bc5c95">TORC_SERVICES_DIR</a> + Signature, Name),</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    m_parent(Parent),</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    m_version(<span class="stringliteral">&quot;Unknown&quot;</span>),</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    m_metaObject(MetaObject),</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    m_methods(),</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    m_properties(),</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    m_subscribers(),</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    m_subscriberLock(QMutex::Recursive)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;{</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    QStringList blacklist = Blacklist.split(<span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    m_parent-&gt;setObjectName(Name);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">// the parent MUST implement SubscriberDeleted.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">if</span> (m_metaObject.indexOfSlot(QMetaObject::normalizedSignature(<span class="stringliteral">&quot;SubscriberDeleted(QObject*)&quot;</span>)) &lt; 0)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Service &#39;%1&#39; has no SubscriberDeleted slot. This is a programmer error - exiting&quot;</span>).arg(Name));</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        QCoreApplication::exit(<a class="code" href="../../d4/dbd/torcexitcodes_8h.html#a8a13aa75c12b7fdaf954d16d582c9fa8">TORC_EXIT_UNKOWN_ERROR</a>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// determine version</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordtype">int</span> index = m_metaObject.indexOfClassInfo(<span class="stringliteral">&quot;Version&quot;</span>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> (index &gt; -1)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        m_version = m_metaObject.classInfo(index).value();</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;Service &#39;%1&#39; is missing version information&quot;</span>).arg(Name));</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// is this a secure service (all methods require authentication)</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordtype">bool</span> secure = m_metaObject.indexOfClassInfo(<span class="stringliteral">&quot;Secure&quot;</span>) &gt; -1;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// build a list of metaobjects from all superclasses as well.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    QList&lt;const QMetaObject*&gt; metas;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    metas.append(&amp;m_metaObject);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keyword">const</span> QMetaObject* super = m_metaObject.superClass();</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">while</span> (super)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        metas.append(super);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        super = super-&gt;superClass();</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// analyse available methods. Build the list from the top superclass &#39;down&#39; to ensure we pick up</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">// overriden slots and discard duplicates</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    QListIterator&lt;const QMetaObject*&gt; it(metas);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    it.toBack();</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">while</span> (it.hasPrevious())</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keyword">const</span> QMetaObject *meta = it.previous();</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; meta-&gt;methodCount(); ++i)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            QMetaMethod method = meta-&gt;method(i);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="keywordflow">if</span> ((method.methodType() == QMetaMethod::Slot) &amp;&amp;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                (method.access()     == QMetaMethod::Public))</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                QString name(method.methodSignature());</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                name = name.section(<span class="charliteral">&#39;(&#39;</span>, 0, 0);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="comment">// discard unwanted slots</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;deleteLater&quot;</span> || name == <span class="stringliteral">&quot;SubscriberDeleted&quot;</span> || blacklist.contains(name))</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="comment">// any Q_CLASSINFO for this method?</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="comment">// current &#39;schema&#39; allows specification of allowed HTTP methods (PUT, GET etc),</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="comment">// custom return types, which are used to improve the usability of maps and</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                <span class="comment">// lists when returned via XML, JSON, PLIST etc and requiring authentication (add AUTH to methods)</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                QString returntype;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <span class="keywordtype">int</span> customallowed = <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a16a0f1f6deaff5847ccde797207432c3">HTTPUnknownType</a>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="comment">// use the actual class metaObject - not the superclass</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                <span class="keywordtype">int</span> index = m_metaObject.indexOfClassInfo(name.toLatin1());</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <span class="keywordflow">if</span> (index &gt; -1)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    QStringList infos = QString(m_metaObject.classInfo(index).value()).split(<span class="stringliteral">&quot;,&quot;</span>, QString::SkipEmptyParts);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    <span class="keywordflow">foreach</span> (QString info, infos)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                        <span class="keywordflow">if</span> (info.startsWith(<span class="stringliteral">&quot;methods=&quot;</span>))</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                            customallowed = <a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a21d32c9d1185514906bd91dc6e034280">TorcHTTPRequest::StringToAllowed</a>(info.mid(8));</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.startsWith(<span class="stringliteral">&quot;type=&quot;</span>))</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                            returntype = info.mid(5);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="comment">// determine allowed request types</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <span class="keywordtype">int</span> allowed = <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8ffe3427494f7da4905154725c378f19">HTTPOptions</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <span class="keywordflow">if</span> (secure)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    allowed |= <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a6062ab6ff4c8153b6134b033236ed6fd">HTTPAuth</a>;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="keywordflow">if</span> (customallowed != <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a16a0f1f6deaff5847ccde797207432c3">HTTPUnknownType</a>)</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                    allowed |= customallowed;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name.startsWith(<span class="stringliteral">&quot;Get&quot;</span>, Qt::CaseInsensitive))</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                    allowed |= <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a0fa0de831c702f7d65dde3ee573f5ef8">HTTPGet</a> | <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a3857a393215d35c074fd3e4a7c858da5">HTTPHead</a>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name.startsWith(<span class="stringliteral">&quot;Set&quot;</span>, Qt::CaseInsensitive))</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                    <span class="comment">// TODO Put or Post?? How to handle head requests for setters...</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    allowed |= <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a72b823cfa3249d5139b887b046eb1612">HTTPPut</a>;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                }</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Unable to determine request types of method &#39;%1&#39; for &#39;%2&#39; - ignoring&quot;</span>).arg(name).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#aef14b1e7af0dfadf9ddb05a1f7ad70da">m_name</a>));</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <span class="keywordflow">if</span> (allowed &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a6062ab6ff4c8153b6134b033236ed6fd">HTTPAuth</a>)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;%1 requires authentication&quot;</span>).arg(Signature + name));</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                <a class="code" href="../../de/db3/class_method_parameters.html">MethodParameters</a> *parameters = <span class="keyword">new</span> <a class="code" href="../../de/db3/class_method_parameters.html">MethodParameters</a>(i, method, allowed, returntype);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                <span class="keywordflow">if</span> (parameters-&gt;<a class="code" href="../../de/db3/class_method_parameters.html#a7448b98a6e687dc463cd174b3315f698">m_valid</a>)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    <span class="comment">// check whether method has already been identified from superclass - need to match whole &#39;signature&#39;</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    <span class="comment">// not just name</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    <span class="keywordflow">if</span> (m_methods.contains(name))</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                        <a class="code" href="../../de/db3/class_method_parameters.html">MethodParameters</a> *existing = m_methods.value(name);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        <span class="keywordflow">if</span> (existing-&gt;<a class="code" href="../../de/db3/class_method_parameters.html#ab9d556343c0bed3667a686a691a816fd">m_method</a>.methodSignature() == method.methodSignature() &amp;&amp;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                            existing-&gt;<a class="code" href="../../de/db3/class_method_parameters.html#ab9d556343c0bed3667a686a691a816fd">m_method</a>.returnType()      == method.returnType())</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                        {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;Method &#39;%1&#39; in class &#39;%2&#39; already found in superclass - overriding&quot;</span>)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                .arg(method.methodSignature().constData()).arg(meta-&gt;className()));</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                            existing = m_methods.take(name);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                            <span class="keyword">delete</span> existing;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                        }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                    m_methods.insert(name, parameters);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                    <span class="keyword">delete</span> parameters;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">// analyse properties from the full list of metaobjects</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordtype">int</span> invalidindex = -1;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">foreach</span> (<span class="keyword">const</span> QMetaObject* meta, metas)</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = meta-&gt;propertyOffset(); i &lt; meta-&gt;propertyCount(); ++i)</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            QMetaProperty <span class="keyword">property</span> = meta-&gt;property(i);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            QString   propertyname(property.name());</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <span class="keywordflow">if</span> (propertyname != <span class="stringliteral">&quot;objectName&quot;</span> &amp;&amp; property.isReadable() &amp;&amp; ((<span class="keyword">property</span>.hasNotifySignal() &amp;&amp; <span class="keyword">property</span>.notifySignalIndex() &gt; -1) || property.isConstant()))</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                <span class="comment">// constant properties are given a signal index &lt; 0</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="keywordflow">if</span> (property.notifySignalIndex() &gt; -1)</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                    m_properties.insert(property.notifySignalIndex(), <span class="keyword">property</span>.propertyIndex());</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;Adding property &#39;%1&#39; with signal index %2&quot;</span>).arg(property.name()).arg(property.notifySignalIndex()));</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                    m_properties.insert(invalidindex--, property.propertyIndex());</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;Adding constant property &#39;%1&#39;&quot;</span>).arg(property.name()));</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#ab5af267f4a697f58eaba5d6b04528f29">  429</a></span>&#160;<a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#ab5af267f4a697f58eaba5d6b04528f29">TorcHTTPService::~TorcHTTPService</a>()</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;{</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    qDeleteAll(m_methods);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#ac1ad2d6a8450afa4314dc9a35b67426d">  434</a></span>&#160;QString <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#ac1ad2d6a8450afa4314dc9a35b67426d">TorcHTTPService::GetUIName</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;{</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#ab800fd3cb042a325d9ddd2e5c80899ee">Name</a>();</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#a9dd43e81d3e39d13d34d829ac3fd68c8">  439</a></span>&#160;QString <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#a9dd43e81d3e39d13d34d829ac3fd68c8">TorcHTTPService::GetPresentationURL</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;{</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">return</span> QString();</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#a6f7bb8865122783c5aac6ff25e706d39">  444</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#a6f7bb8865122783c5aac6ff25e706d39">TorcHTTPService::ProcessHTTPRequest</a>(<span class="keyword">const</span> QString &amp;PeerAddress, <span class="keywordtype">int</span> PeerPort, <span class="keyword">const</span> QString &amp;LocalAddress, <span class="keywordtype">int</span> LocalPort, <a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html">TorcHTTPRequest</a> &amp;Request)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    (void)PeerAddress;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    (void)PeerPort;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    (void)LocalAddress;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    (void)LocalPort;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    QString method = Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a28fe4579b3cd4ba23153b6fa4ec007c5">GetMethod</a>();</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7">HTTPRequestType</a> type = Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#afa4abe22b1dbea3aec70283af2336809">GetHTTPRequestType</a>();</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">if</span> (method.compare(<span class="stringliteral">&quot;GetServiceVersion&quot;</span>) == 0)</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">if</span> (type == <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8ffe3427494f7da4905154725c378f19">HTTPOptions</a>)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">SetStatus</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fca43f8027764325bbcad2f773511156d0a">HTTP_OK</a>);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a07e0d4900c71f8c8ab1d6748773d91a1">SetResponseType</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49a0e4c9ede53c253828f41fef5558a5831">HTTPResponseDefault</a>);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#afc484e6f5d8af21f931b43d8b4658864">SetAllowed</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a3857a393215d35c074fd3e4a7c858da5">HTTPHead</a> | <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a0fa0de831c702f7d65dde3ee573f5ef8">HTTPGet</a> | <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8ffe3427494f7da4905154725c378f19">HTTPOptions</a>);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="keywordflow">if</span> (type != <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a0fa0de831c702f7d65dde3ee573f5ef8">HTTPGet</a> &amp;&amp; type != <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a3857a393215d35c074fd3e4a7c858da5">HTTPHead</a>)</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        {</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">SetStatus</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fcae6ec39e387f642513e62edf9b5af7f93">HTTP_BadRequest</a>);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a07e0d4900c71f8c8ab1d6748773d91a1">SetResponseType</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49a0e4c9ede53c253828f41fef5558a5831">HTTPResponseDefault</a>);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">SetStatus</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fca43f8027764325bbcad2f773511156d0a">HTTP_OK</a>);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aa0b15a12391f846b92b20547a1b07d0f">Serialise</a>(m_version, <span class="stringliteral">&quot;version&quot;</span>);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    QMap&lt;QString,MethodParameters*&gt;::iterator it = m_methods.find(method);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (it != m_methods.end())</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="comment">// filter out invalid request types</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">if</span> ((!(type &amp; (*it)-&gt;m_allowedRequestTypes)) ||</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            (*it)-&gt;m_allowedRequestTypes &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8414b2ef47b99859c869617874e6e647">HTTPDisabled</a>)</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">SetStatus</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fcae6ec39e387f642513e62edf9b5af7f93">HTTP_BadRequest</a>);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a07e0d4900c71f8c8ab1d6748773d91a1">SetResponseType</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49a0e4c9ede53c253828f41fef5558a5831">HTTPResponseDefault</a>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="comment">// handle OPTIONS</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">if</span> (type == <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8ffe3427494f7da4905154725c378f19">HTTPOptions</a>)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a16cd050a931518913eed8357d94b7364">HandleOptions</a>(Request, (*it)-&gt;m_allowedRequestTypes);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="comment">// reject requests that have a particular need for authorisation. We can only</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment">// check at this late stage but these should be in the minority</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a1c097265c2fecdab79725e73bbfedeab">MethodIsAuthorised</a>(Request, (*it)-&gt;m_allowedRequestTypes))</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        QString type;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordtype">bool</span>    voidresult;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        QVariant result = (*it)-&gt;Invoke(m_parent, Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9157522c82987335c1dea612bc3777f9">Queries</a>(), type, voidresult);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">// is there a result</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">if</span> (!voidresult)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="comment">// check for invocation errors</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <span class="keywordflow">if</span> (result.type() == QVariant::Invalid)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">SetStatus</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fcae6ec39e387f642513e62edf9b5af7f93">HTTP_BadRequest</a>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a07e0d4900c71f8c8ab1d6748773d91a1">SetResponseType</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49a0e4c9ede53c253828f41fef5558a5831">HTTPResponseDefault</a>);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aa0b15a12391f846b92b20547a1b07d0f">Serialise</a>(result, type);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a4ca53162a0293fc06e9cbdbce271be85">SetAllowGZip</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a07e0d4900c71f8c8ab1d6748773d91a1">SetResponseType</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49ae58e121513274f5874ade749d85ac0e4">HTTPResponseNone</a>);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        }</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">SetStatus</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fca43f8027764325bbcad2f773511156d0a">HTTP_OK</a>);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;}</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#aba33abce11b5a783a2735b5a971aadf7">  527</a></span>&#160;QVariantMap <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#aba33abce11b5a783a2735b5a971aadf7">TorcHTTPService::ProcessRequest</a>(<span class="keyword">const</span> QString &amp;Method, <span class="keyword">const</span> QVariant &amp;Parameters, QObject *Connection, <span class="keywordtype">bool</span> Authenticated)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;{</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    QString method;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordtype">int</span> index = Method.lastIndexOf(<span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> (index &gt; -1)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        method = Method.mid(index + 1).trimmed();</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span> (Connection &amp;&amp; !method.isEmpty())</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="comment">// find the correct method to invoke</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        QMap&lt;QString,MethodParameters*&gt;::iterator it = m_methods.find(method);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">if</span> (it != m_methods.end())</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="comment">// disallow methods based on state and authentication</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordtype">int</span> types         = it.value()-&gt;m_allowedRequestTypes;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            <span class="keywordtype">bool</span> disabled     = types &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8414b2ef47b99859c869617874e6e647">HTTPDisabled</a>;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="keywordtype">bool</span> unauthorised = !Authenticated &amp;&amp; (types &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a6062ab6ff4c8153b6134b033236ed6fd">HTTPAuth</a> || types &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a88805874923d64eeebe520f59379077b">HTTPPost</a> || types &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a72b823cfa3249d5139b887b046eb1612">HTTPPut</a> || types &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7aa1212f1ece579f3f6bdbf56d570c4032">HTTPDelete</a> || types &amp; <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a16a0f1f6deaff5847ccde797207432c3">HTTPUnknownType</a>);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="keywordflow">if</span> (disabled || unauthorised)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                <span class="keywordflow">if</span> (disabled)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;&#39;%1&#39; method &#39;%2&#39; is disabled&quot;</span>).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>).arg(method));</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;&#39;%1&#39; method &#39;%2&#39; unauthorised&quot;</span>).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>).arg(method));</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                QVariantMap result;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                QVariantMap error;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                error.insert(<span class="stringliteral">&quot;code&quot;</span>, -401); <span class="comment">// HTTP 401!</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                error.insert(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Method not authorised&quot;</span>);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                result.insert(<span class="stringliteral">&quot;error&quot;</span>, error);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                <span class="comment">// invoke it</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <span class="comment">// convert the parameters</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                QMap&lt;QString,QString&gt; params;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                <span class="keywordflow">if</span> (Parameters.type() == QVariant::Map)</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                    QVariantMap map = Parameters.toMap();</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                    QVariantMap::iterator it = map.begin();</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                    <span class="keywordflow">for</span> ( ; it != map.end(); ++it)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                        params.insert(it.key(), it.value().toString());</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Parameters.type() == QVariant::List)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                    QVariantList list = Parameters.toList();</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                    <span class="keywordflow">if</span> (list.size() &lt;= (*it)-&gt;m_names.size())</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; list.size(); ++i)</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                            params.insert((*it)-&gt;m_names[i], list[i].toString());</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                    }</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                    {</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Too many parameters&quot;</span>);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!Parameters.isNull())</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Unknown parameter variant&quot;</span>);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                QString type;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <span class="keywordtype">bool</span>    voidresult = <span class="keyword">false</span>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                QVariant results = (*it)-&gt;Invoke(m_parent, params, type, voidresult);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                <span class="comment">// check result</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                <span class="keywordflow">if</span> (!voidresult)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                    <span class="comment">// check for invocation errors</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                    <span class="keywordflow">if</span> (results.type() != QVariant::Invalid)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                    {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                        QVariantMap result;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                        result.insert(<span class="stringliteral">&quot;result&quot;</span>, results);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                        <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                    }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                    QVariantMap result;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                    QVariantMap error;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                    error.insert(<span class="stringliteral">&quot;code&quot;</span>, -32602);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                    error.insert(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Invalid params&quot;</span>);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    result.insert(<span class="stringliteral">&quot;error&quot;</span>, error);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                <span class="comment">// JSON-RPC 2.0 specification makes no mention of void/null return types</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                QVariantMap result;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                result.insert(<span class="stringliteral">&quot;result&quot;</span>, <span class="stringliteral">&quot;null&quot;</span>);</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            }</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        }</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="comment">// implicit &#39;GetServiceVersion&#39; method</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">if</span> (method.compare(<span class="stringliteral">&quot;GetServiceVersion&quot;</span>) == 0)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            QVariantMap result;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            QVariantMap version;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            version.insert(<span class="stringliteral">&quot;version&quot;</span>, m_version);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            result.insert(<span class="stringliteral">&quot;result&quot;</span>, version);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="comment">// implicit &#39;Subscribe&#39; method</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (method.compare(<span class="stringliteral">&quot;Subscribe&quot;</span>) == 0)</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="comment">// ensure the &#39;receiver&#39; has all of the right slots</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordtype">int</span> change = Connection-&gt;metaObject()-&gt;indexOfSlot(QMetaObject::normalizedSignature(<span class="stringliteral">&quot;PropertyChanged()&quot;</span>));</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">if</span> (change &gt; -1)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="comment">// this method is not thread-safe and is called from multiple threads so lock the subscribers</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                QMutexLocker locker(&amp;m_subscriberLock);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <span class="keywordflow">if</span> (!m_subscribers.contains(Connection))</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                {</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;New subscription for &#39;%1&#39;&quot;</span>).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>));</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                    m_subscribers.append(Connection);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                    <span class="comment">// notify success and provide appropriate details about properties, notifications, get&#39;ers etc</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                    QMap&lt;int,int&gt;::const_iterator it = m_properties.begin();</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                    <span class="keywordflow">for</span> ( ; it != m_properties.end(); ++it)</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                    {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                        <span class="comment">// and connect property change notifications to the one slot</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        <span class="comment">// NB we use the parent&#39;s metaObject here - not the staticMetaObject (or m_metaObject)</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                        <span class="keywordflow">if</span> (it.key() &gt; -1)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                            QObject::connect(m_parent, m_parent-&gt;metaObject()-&gt;method(it.key()), Connection, Connection-&gt;metaObject()-&gt;method(change));</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                        <span class="comment">// clean up subscriptions if the subscriber is deleted</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                        QObject::connect(Connection, SIGNAL(destroyed(QObject*)), m_parent, SLOT(SubscriberDeleted(QObject*)));</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                    }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                    QVariantMap result;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                    result.insert(<span class="stringliteral">&quot;result&quot;</span>, <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#a82f54f38aacd812f0ce4ba935f337a93">GetServiceDetails</a>());</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Connection is already subscribed to &#39;%1&#39;&quot;</span>).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>));</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Subscription request for connection without correct methods&quot;</span>);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            }</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            QVariantMap result;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            QVariantMap error;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            error.insert(<span class="stringliteral">&quot;code&quot;</span>, -32603);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            error.insert(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Internal error&quot;</span>);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            result.insert(<span class="stringliteral">&quot;error&quot;</span>, error);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        }</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="comment">// implicit &#39;Unsubscribe&#39; method</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (method.compare(<span class="stringliteral">&quot;Unsubscribe&quot;</span>) == 0)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            QMutexLocker locker(&amp;m_subscriberLock);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="keywordflow">if</span> (m_subscribers.contains(Connection))</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Removed subscription for &#39;%1&#39;&quot;</span>).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>));</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                <span class="comment">// disconnect all change signals</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                m_parent-&gt;disconnect(Connection);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                <span class="comment">// remove the subscriber</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                m_subscribers.removeAll(Connection);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                <span class="comment">// return success</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                QVariantMap result;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                result.insert(<span class="stringliteral">&quot;result&quot;</span>, 1);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Connection is not subscribed to &#39;%1&#39;&quot;</span>).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>));</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            QVariantMap result;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            QVariantMap error;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            error.insert(<span class="stringliteral">&quot;code&quot;</span>, -32603);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            error.insert(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Internal error&quot;</span>);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            result.insert(<span class="stringliteral">&quot;error&quot;</span>, error);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;&#39;%1&#39; service has no &#39;%2&#39; method&quot;</span>).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>).arg(method));</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    QVariantMap result;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    QVariantMap error;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    error.insert(<span class="stringliteral">&quot;code&quot;</span>, -32601);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    error.insert(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Method not found&quot;</span>);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    result.insert(<span class="stringliteral">&quot;error&quot;</span>, error);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;}</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#a82f54f38aacd812f0ce4ba935f337a93">  727</a></span>&#160;QVariantMap <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#a82f54f38aacd812f0ce4ba935f337a93">TorcHTTPService::GetServiceDetails</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;{</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// no need for locking here</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    QVariantMap details;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    QVariantMap properties;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    QVariantMap methods;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    QMap&lt;int,int&gt;::const_iterator it = m_properties.begin();</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">for</span> ( ; it != m_properties.end(); ++it)</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="comment">// NB for some reason, QMetaProperty doesn&#39;t provide the QMetaMethod for the read and write</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="comment">// slots, so try to infer them (and check the result)</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        QMetaProperty <span class="keyword">property</span> = m_parent-&gt;metaObject()-&gt;property(it.value());</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        QVariantMap description;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        QString name = QString::fromLatin1(property.name());</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        description.insert(<span class="stringliteral">&quot;notification&quot;</span>, QString::fromLatin1(m_parent-&gt;metaObject()-&gt;method(it.key()).name()));</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="comment">// a property is always readable</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        QString read = QString(<span class="stringliteral">&quot;Get&quot;</span>) + name.left(1).toUpper() + name.mid(1);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span> (m_parent-&gt;metaObject()-&gt;indexOfSlot(QMetaObject::normalizedSignature(QString(read + <span class="stringliteral">&quot;()&quot;</span>).toLatin1())) &gt; -1)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            description.insert(<span class="stringliteral">&quot;read&quot;</span>, read);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Failed to deduce &#39;read&#39; slot for property &#39;%1&#39; in service &#39;%2&#39;&quot;</span>).arg(name).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>));</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="comment">// for writable properties, we need to infer the signature including the type</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <span class="keywordflow">if</span> (property.isWritable())</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        {</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            QString write = QString(<span class="stringliteral">&quot;Set%1%2&quot;</span>).arg(name.left(1).toUpper()).arg(name.mid(1));</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordflow">if</span> (m_parent-&gt;metaObject()-&gt;indexOfSlot(QMetaObject::normalizedSignature(QString(<span class="stringliteral">&quot;%1(%2)&quot;</span>).arg(write).arg(property.typeName()).toLatin1())) &gt; -1)</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                description.insert(<span class="stringliteral">&quot;write&quot;</span>, write);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Failed to deduce &#39;write&#39; slot for property &#39;%1&#39; in service &#39;%2&#39;&quot;</span>).arg(name).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">m_signature</a>));</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        }</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="comment">// and add the initial value</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        description.insert(<span class="stringliteral">&quot;value&quot;</span>, property.read(m_parent));</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        properties.insert(name, description);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    QMap&lt;QString,MethodParameters*&gt;::const_iterator it2 = m_methods.begin();</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="keywordflow">for</span> ( ; it2 != m_methods.end(); ++it2)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        QVariantMap map;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        QVariantList params;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <a class="code" href="../../de/db3/class_method_parameters.html">MethodParameters</a> *parameters = it2.value();</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; parameters-&gt;<a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>.size(); ++i)</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            params.append(parameters-&gt;<a class="code" href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">m_names</a>[i].data());</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        map.insert(<span class="stringliteral">&quot;params&quot;</span>, params);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        map.insert(<span class="stringliteral">&quot;returns&quot;</span>, <a class="code" href="../../d3/dd1/class_torc_j_s_o_n_r_p_c.html#afd0ac8d71c1d29ca17196a269f66d934">TorcJSONRPC::QMetaTypetoJavascriptType</a>(parameters-&gt;<a class="code" href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">m_types</a>[0]));</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        methods.insert(it2.key(), map);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">// and implicit Subscribe/Unsubscribe/GetServiceVersion</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// NB these aren&#39;t implemented as public slots and property (for serviceVersion)</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">// as TorcHTTPService is not a QObject. Not ideal as the full API is not</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">// visible in the code.</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    QVariantList params;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    QVariant returns(<span class="stringliteral">&quot;object&quot;</span>);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    QVariantMap subscribe;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    subscribe.insert(<span class="stringliteral">&quot;params&quot;</span>, params);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    subscribe.insert(<span class="stringliteral">&quot;returns&quot;</span>, returns);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    methods.insert(<span class="stringliteral">&quot;Subscribe&quot;</span>, subscribe);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    QVariantMap unsubscribe;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    unsubscribe.insert(<span class="stringliteral">&quot;params&quot;</span>, params);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    unsubscribe.insert(<span class="stringliteral">&quot;returns&quot;</span>, returns);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    methods.insert(<span class="stringliteral">&quot;Unsubscribe&quot;</span>, unsubscribe);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    QVariantMap serviceversion;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    serviceversion.insert(<span class="stringliteral">&quot;params&quot;</span>, params);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    serviceversion.insert(<span class="stringliteral">&quot;returns&quot;</span>, <a class="code" href="../../d3/dd1/class_torc_j_s_o_n_r_p_c.html#afd0ac8d71c1d29ca17196a269f66d934">TorcJSONRPC::QMetaTypetoJavascriptType</a>(QMetaType::QString));</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    methods.insert(<span class="stringliteral">&quot;GetServiceVersion&quot;</span>, serviceversion);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="comment">// and the implicit version property</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    QVariantMap description;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    description.insert(<span class="stringliteral">&quot;read&quot;</span>, <span class="stringliteral">&quot;GetServiceVersion&quot;</span>);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    description.insert(<span class="stringliteral">&quot;value&quot;</span>, m_version);</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    properties.insert(<span class="stringliteral">&quot;serviceVersion&quot;</span>, description);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    details.insert(<span class="stringliteral">&quot;properties&quot;</span>, properties);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    details.insert(<span class="stringliteral">&quot;methods&quot;</span>, methods);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordflow">return</span> details;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;}</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#a193024836d5518d050445c68bb559f37">  818</a></span>&#160;QString <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#a193024836d5518d050445c68bb559f37">TorcHTTPService::GetMethod</a>(<span class="keywordtype">int</span> Index)</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;{</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span> (Index &gt; -1 &amp;&amp; Index &lt; m_parent-&gt;metaObject()-&gt;methodCount())</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">return</span> QString::fromLatin1(m_parent-&gt;metaObject()-&gt;method(Index).name());</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">return</span> QString();</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;}</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#aa5a4b1c823eb77de82ea44c3912f931f">  830</a></span>&#160;QVariant <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#aa5a4b1c823eb77de82ea44c3912f931f">TorcHTTPService::GetProperty</a>(<span class="keywordtype">int</span> Index)</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;{</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    QVariant result;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> (Index &gt; -1 &amp;&amp; m_properties.contains(Index))</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        result = m_parent-&gt;metaObject()-&gt;property(m_properties.value(Index)).read(m_parent);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Failed to retrieve property&quot;</span>);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;}</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#a63735bbaa0886adc834d275b6d4e416b">  846</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#a63735bbaa0886adc834d275b6d4e416b">TorcHTTPService::EnableMethod</a>(<span class="keyword">const</span> QString &amp;Method)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;{</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    QMap&lt;QString,MethodParameters*&gt;::const_iterator it = m_methods.constFind(Method);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">if</span> (it != m_methods.constEnd())</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        it.value()-&gt;Enable();</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;Enabled method &#39;%1&#39; for service &#39;%2&#39;&quot;</span>).arg(Method).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#aef14b1e7af0dfadf9ddb05a1f7ad70da">m_name</a>));</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    {</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Unable to enable unknown method &#39;%1&#39; for service &#39;%2&#39;&quot;</span>).arg(Method).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#aef14b1e7af0dfadf9ddb05a1f7ad70da">m_name</a>));</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    }</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#aacf2b99a7317bdc9d961efc64057931a">  868</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#aacf2b99a7317bdc9d961efc64057931a">TorcHTTPService::DisableMethod</a>(<span class="keyword">const</span> QString &amp;Method)</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;{</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    QMap&lt;QString,MethodParameters*&gt;::const_iterator it = m_methods.constFind(Method);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">if</span> (it != m_methods.constEnd())</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        it.value()-&gt;Disable();</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;Disabled method &#39;%1&#39; for service &#39;%2&#39;&quot;</span>).arg(Method).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#aef14b1e7af0dfadf9ddb05a1f7ad70da">m_name</a>));</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    }</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    {</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Unable to disable unknown method &#39;%1&#39; for service &#39;%2&#39;&quot;</span>).arg(Method).arg(<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#aef14b1e7af0dfadf9ddb05a1f7ad70da">m_name</a>));</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;}</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno"><a class="line" href="../../d6/d70/class_torc_h_t_t_p_service.html#acd54087b95fabdfb71fb7e7e7ffa90c9">  882</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#acd54087b95fabdfb71fb7e7e7ffa90c9">TorcHTTPService::HandleSubscriberDeleted</a>(QObject *Subscriber)</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;{</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    QMutexLocker locker(&amp;m_subscriberLock);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (Subscriber &amp;&amp; m_subscribers.contains(Subscriber))</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, <span class="stringliteral">&quot;Subscriber deleted - cancelling subscription&quot;</span>);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        m_subscribers.removeAll(Subscriber);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;}</div><div class="ttc" id="class_torc_h_t_t_p_request_html_afc484e6f5d8af21f931b43d8b4658864"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#afc484e6f5d8af21f931b43d8b4658864">TorcHTTPRequest::SetAllowed</a></div><div class="ttdeci">void SetAllowed(int Allowed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00219">torchttprequest.cpp:219</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_handler_html_aef14b1e7af0dfadf9ddb05a1f7ad70da"><div class="ttname"><a href="../../d5/d15/class_torc_h_t_t_p_handler.html#aef14b1e7af0dfadf9ddb05a1f7ad70da">TorcHTTPHandler::m_name</a></div><div class="ttdeci">QString m_name</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/torchttphandler_8h_source.html#l00036">torchttphandler.h:36</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_a55153cb0d62acbf9071621fa53577c83"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#a55153cb0d62acbf9071621fa53577c83">TorcHTTPService::TorcHTTPService</a></div><div class="ttdeci">TorcHTTPService(QObject *Parent, const QString &amp;Signature, const QString &amp;Name, const QMetaObject &amp;MetaObject, const QString &amp;Blacklist=QString(&quot;&quot;))</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00261">torchttpservice.cpp:261</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html">TorcHTTPRequest</a></div><div class="ttdoc">A class to encapsulate an incoming HTTP request. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00112">torchttprequest.h:112</a></div></div>
<div class="ttc" id="class_method_parameters_html_a83b77b4c145e19c1448bc93e5d855242"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a83b77b4c145e19c1448bc93e5d855242">MethodParameters::m_types</a></div><div class="ttdeci">QVector&lt; int &gt; m_types</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00250">torchttpservice.cpp:250</a></div></div>
<div class="ttc" id="class_method_parameters_html_a4f5fbd20d623d12d06c69953279eba54"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a4f5fbd20d623d12d06c69953279eba54">MethodParameters::~MethodParameters</a></div><div class="ttdeci">~MethodParameters()</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00114">torchttpservice.cpp:114</a></div></div>
<div class="ttc" id="class_method_parameters_html_a0f2c2cb7593e510e9169a5a28b9546e2"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a0f2c2cb7593e510e9169a5a28b9546e2">MethodParameters::SetValue</a></div><div class="ttdeci">static void SetValue(void *Pointer, const QString &amp;Value, int Type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00182">torchttpservice.cpp:182</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_afa4abe22b1dbea3aec70283af2336809"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#afa4abe22b1dbea3aec70283af2336809">TorcHTTPRequest::GetHTTPRequestType</a></div><div class="ttdeci">HTTPRequestType GetHTTPRequestType(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00275">torchttprequest.cpp:275</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_handler_html"><div class="ttname"><a href="../../d5/d15/class_torc_h_t_t_p_handler.html">TorcHTTPHandler</a></div><div class="ttdoc">Base HTTP response handler class. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/torchttphandler_8h_source.html#l00016">torchttphandler.h:16</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a16a0f1f6deaff5847ccde797207432c3"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a16a0f1f6deaff5847ccde797207432c3">HTTPUnknownType</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00025">torchttprequest.h:25</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a3857a393215d35c074fd3e4a7c858da5"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a3857a393215d35c074fd3e4a7c858da5">HTTPHead</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00026">torchttprequest.h:26</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a88805874923d64eeebe520f59379077b"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a88805874923d64eeebe520f59379077b">HTTPPost</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00028">torchttprequest.h:28</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_ab5af267f4a697f58eaba5d6b04528f29"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#ab5af267f4a697f58eaba5d6b04528f29">TorcHTTPService::~TorcHTTPService</a></div><div class="ttdeci">virtual ~TorcHTTPService()</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00429">torchttpservice.cpp:429</a></div></div>
<div class="ttc" id="class_method_parameters_html_a0797078082f23bb26bcb8cc0ded827fa"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a0797078082f23bb26bcb8cc0ded827fa">MethodParameters::m_names</a></div><div class="ttdeci">QVector&lt; QByteArray &gt; m_names</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00249">torchttpservice.cpp:249</a></div></div>
<div class="ttc" id="torclocaldefs_8h_html_af610adff33b187f7493ed93a70bc5c95"><div class="ttname"><a href="../../db/db2/torclocaldefs_8h.html#af610adff33b187f7493ed93a70bc5c95">TORC_SERVICES_DIR</a></div><div class="ttdeci">#define TORC_SERVICES_DIR</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db2/torclocaldefs_8h_source.html#l00012">torclocaldefs.h:12</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a01340bcc9cce6aa1d156bd0468c708fca43f8027764325bbcad2f773511156d0a"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fca43f8027764325bbcad2f773511156d0a">HTTP_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00068">torchttprequest.h:68</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_a63735bbaa0886adc834d275b6d4e416b"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#a63735bbaa0886adc834d275b6d4e416b">TorcHTTPService::EnableMethod</a></div><div class="ttdeci">void EnableMethod(const QString &amp;Method)</div><div class="ttdoc">Enable the given method. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00846">torchttpservice.cpp:846</a></div></div>
<div class="ttc" id="class_method_parameters_html_a1be08f25dbbfc259d5f5a04694752a0d"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a1be08f25dbbfc259d5f5a04694752a0d">MethodParameters::Enable</a></div><div class="ttdeci">void Enable(void)</div><div class="ttdoc">Enable this method. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00241">torchttpservice.cpp:241</a></div></div>
<div class="ttc" id="class_method_parameters_html_a7448b98a6e687dc463cd174b3315f698"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a7448b98a6e687dc463cd174b3315f698">MethodParameters::m_valid</a></div><div class="ttdeci">bool m_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00247">torchttpservice.cpp:247</a></div></div>
<div class="ttc" id="torclogging_8h_html"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html">torclogging.h</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_a6f7bb8865122783c5aac6ff25e706d39"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#a6f7bb8865122783c5aac6ff25e706d39">TorcHTTPService::ProcessHTTPRequest</a></div><div class="ttdeci">void ProcessHTTPRequest(const QString &amp;PeerAddress, int PeerPort, const QString &amp;LocalAddress, int LocalPort, TorcHTTPRequest &amp;Request) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00444">torchttpservice.cpp:444</a></div></div>
<div class="ttc" id="torcexitcodes_8h_html_a8a13aa75c12b7fdaf954d16d582c9fa8"><div class="ttname"><a href="../../d4/dbd/torcexitcodes_8h.html#a8a13aa75c12b7fdaf954d16d582c9fa8">TORC_EXIT_UNKOWN_ERROR</a></div><div class="ttdeci">#define TORC_EXIT_UNKOWN_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dbd/torcexitcodes_8h_source.html#l00006">torcexitcodes.h:6</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_ac1ad2d6a8450afa4314dc9a35b67426d"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#ac1ad2d6a8450afa4314dc9a35b67426d">TorcHTTPService::GetUIName</a></div><div class="ttdeci">virtual QString GetUIName(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00434">torchttpservice.cpp:434</a></div></div>
<div class="ttc" id="torclocaldefs_8h_html"><div class="ttname"><a href="../../db/db2/torclocaldefs_8h.html">torclocaldefs.h</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_aa0b15a12391f846b92b20547a1b07d0f"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#aa0b15a12391f846b92b20547a1b07d0f">TorcHTTPRequest::Serialise</a></div><div class="ttdeci">void Serialise(const QVariant &amp;Data, const QString &amp;Type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l01046">torchttprequest.cpp:1046</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_aacf2b99a7317bdc9d961efc64057931a"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#aacf2b99a7317bdc9d961efc64057931a">TorcHTTPService::DisableMethod</a></div><div class="ttdeci">void DisableMethod(const QString &amp;Method)</div><div class="ttdoc">Disable the given method. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00868">torchttpservice.cpp:868</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_handler_html_a16cd050a931518913eed8357d94b7364"><div class="ttname"><a href="../../d5/d15/class_torc_h_t_t_p_handler.html#a16cd050a931518913eed8357d94b7364">TorcHTTPHandler::HandleOptions</a></div><div class="ttdeci">static void HandleOptions(TorcHTTPRequest &amp;Request, int Allowed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d87/torchttphandler_8cpp_source.html#l00102">torchttphandler.cpp:102</a></div></div>
<div class="ttc" id="class_method_parameters_html_ab9d556343c0bed3667a686a691a816fd"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#ab9d556343c0bed3667a686a691a816fd">MethodParameters::m_method</a></div><div class="ttdeci">QMetaMethod m_method</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00253">torchttpservice.cpp:253</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a28fe4579b3cd4ba23153b6fa4ec007c5"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a28fe4579b3cd4ba23153b6fa4ec007c5">TorcHTTPRequest::GetMethod</a></div><div class="ttdeci">QString GetMethod(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00295">torchttprequest.cpp:295</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_a9dd43e81d3e39d13d34d829ac3fd68c8"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#a9dd43e81d3e39d13d34d829ac3fd68c8">TorcHTTPService::GetPresentationURL</a></div><div class="ttdeci">virtual QString GetPresentationURL(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00439">torchttpservice.cpp:439</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_handler_html_ab800fd3cb042a325d9ddd2e5c80899ee"><div class="ttname"><a href="../../d5/d15/class_torc_h_t_t_p_handler.html#ab800fd3cb042a325d9ddd2e5c80899ee">TorcHTTPHandler::Name</a></div><div class="ttdeci">QString Name(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d87/torchttphandler_8cpp_source.html#l00075">torchttphandler.cpp:75</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a4ca53162a0293fc06e9cbdbce271be85"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a4ca53162a0293fc06e9cbdbce271be85">TorcHTTPRequest::SetAllowGZip</a></div><div class="ttdeci">void SetAllowGZip(bool Allowed)</div><div class="ttdoc">Allow gzip compression for the contents of this request. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00225">torchttprequest.cpp:225</a></div></div>
<div class="ttc" id="class_method_parameters_html_aeac021817bc96ec1b5c1d2024fea4c3b"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#aeac021817bc96ec1b5c1d2024fea4c3b">MethodParameters::Disable</a></div><div class="ttdeci">void Disable(void)</div><div class="ttdoc">Disable this method. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00234">torchttpservice.cpp:234</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7aa1212f1ece579f3f6bdbf56d570c4032"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7aa1212f1ece579f3f6bdbf56d570c4032">HTTPDelete</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00030">torchttprequest.h:30</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a8ffe3427494f7da4905154725c378f19"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8ffe3427494f7da4905154725c378f19">HTTPOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00031">torchttprequest.h:31</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_acd54087b95fabdfb71fb7e7e7ffa90c9"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#acd54087b95fabdfb71fb7e7e7ffa90c9">TorcHTTPService::HandleSubscriberDeleted</a></div><div class="ttdeci">void HandleSubscriberDeleted(QObject *Subscriber)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00882">torchttpservice.cpp:882</a></div></div>
<div class="ttc" id="class_method_parameters_html_acbf022eef03a92222783b8c7f5adf712"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#acbf022eef03a92222783b8c7f5adf712">MethodParameters::m_index</a></div><div class="ttdeci">int m_index</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00248">torchttpservice.cpp:248</a></div></div>
<div class="ttc" id="torcloggingdefs_8h_html_a93519f65dd0ef21fc5be0c286a833ae4"><div class="ttname"><a href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a></div><div class="ttdeci">VERBOSE_PREAMBLE General info Playback related messages File and AutoExpire related messages Network protocol related messages Audio related messages JobQueue related messages EIT related messages DSMCC carousel related messages UPnP debugging messages xmltv output and related messages Media Manager debugging messages External executable related messages false</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/torcloggingdefs_8h_source.html#l00110">torcloggingdefs.h:110</a></div></div>
<div class="ttc" id="class_method_parameters_html_afe1f66c90941360705cf5023d2897f96"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#afe1f66c90941360705cf5023d2897f96">MethodParameters::ToBool</a></div><div class="ttdeci">static bool ToBool(const QString &amp;Value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00219">torchttpservice.cpp:219</a></div></div>
<div class="ttc" id="torcnetwork_8h_html"><div class="ttname"><a href="../../da/da5/torcnetwork_8h.html">torcnetwork.h</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_aba33abce11b5a783a2735b5a971aadf7"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#aba33abce11b5a783a2735b5a971aadf7">TorcHTTPService::ProcessRequest</a></div><div class="ttdeci">QVariantMap ProcessRequest(const QString &amp;Method, const QVariant &amp;Parameters, QObject *Connection, bool Authenticated) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00527">torchttpservice.cpp:527</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a72b823cfa3249d5139b887b046eb1612"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a72b823cfa3249d5139b887b046eb1612">HTTPPut</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00029">torchttprequest.h:29</a></div></div>
<div class="ttc" id="class_method_parameters_html"><div class="ttname"><a href="../../de/db3/class_method_parameters.html">MethodParameters</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00041">torchttpservice.cpp:41</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_ad0f1d98da3f74ea990bd91362a200e49a0e4c9ede53c253828f41fef5558a5831"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49a0e4c9ede53c253828f41fef5558a5831">HTTPResponseDefault</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00040">torchttprequest.h:40</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a21d32c9d1185514906bd91dc6e034280"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a21d32c9d1185514906bd91dc6e034280">TorcHTTPRequest::StringToAllowed</a></div><div class="ttdeci">static int StringToAllowed(const QString &amp;Allowed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00904">torchttprequest.cpp:904</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a6062ab6ff4c8153b6134b033236ed6fd"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a6062ab6ff4c8153b6134b033236ed6fd">HTTPAuth</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00033">torchttprequest.h:33</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a8414b2ef47b99859c869617874e6e647"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a8414b2ef47b99859c869617874e6e647">HTTPDisabled</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00032">torchttprequest.h:32</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_aad9c4665e4bf1e7a32ca7955a879da11"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">TorcHTTPRequest::SetStatus</a></div><div class="ttdeci">void SetStatus(HTTPStatus Status)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00192">torchttprequest.cpp:192</a></div></div>
<div class="ttc" id="class_method_parameters_html_a5897d0656cab3970e52886eb57ddc69e"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a5897d0656cab3970e52886eb57ddc69e">MethodParameters::MethodParameters</a></div><div class="ttdeci">MethodParameters(int Index, const QMetaMethod &amp;Method, int AllowedRequestTypes, const QString &amp;ReturnType)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00044">torchttpservice.cpp:44</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_aa5a4b1c823eb77de82ea44c3912f931f"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#aa5a4b1c823eb77de82ea44c3912f931f">TorcHTTPService::GetProperty</a></div><div class="ttdeci">QVariant GetProperty(int Index)</div><div class="ttdoc">Get the value of a given property. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00830">torchttpservice.cpp:830</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_handler_html_a1c097265c2fecdab79725e73bbfedeab"><div class="ttname"><a href="../../d5/d15/class_torc_h_t_t_p_handler.html#a1c097265c2fecdab79725e73bbfedeab">TorcHTTPHandler::MethodIsAuthorised</a></div><div class="ttdeci">static bool MethodIsAuthorised(TorcHTTPRequest &amp;Request, int Allowed)</div><div class="ttdoc">Check the current request is authorised and set the authentication header if not. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d87/torchttphandler_8cpp_source.html#l00092">torchttphandler.cpp:92</a></div></div>
<div class="ttc" id="torcserialiser_8h_html"><div class="ttname"><a href="../../d1/def/torcserialiser_8h.html">torcserialiser.h</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_a193024836d5518d050445c68bb559f37"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#a193024836d5518d050445c68bb559f37">TorcHTTPService::GetMethod</a></div><div class="ttdeci">QString GetMethod(int Index)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00818">torchttpservice.cpp:818</a></div></div>
<div class="ttc" id="class_method_parameters_html_a33939b36b57e1a817425eadb9371ccf2"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a33939b36b57e1a817425eadb9371ccf2">MethodParameters::m_returnType</a></div><div class="ttdeci">QString m_returnType</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00252">torchttpservice.cpp:252</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7">HTTPRequestType</a></div><div class="ttdeci">HTTPRequestType</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00023">torchttprequest.h:23</a></div></div>
<div class="ttc" id="torchttpserver_8h_html"><div class="ttname"><a href="../../df/d1b/torchttpserver_8h.html">torchttpserver.h</a></div></div>
<div class="ttc" id="class_method_parameters_html_a8333d02478e357f17236fce0c925e0f8"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#a8333d02478e357f17236fce0c925e0f8">MethodParameters::m_allowedRequestTypes</a></div><div class="ttdeci">int m_allowedRequestTypes</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00251">torchttpservice.cpp:251</a></div></div>
<div class="ttc" id="torcjsonrpc_8h_html"><div class="ttname"><a href="../../d3/dd5/torcjsonrpc_8h.html">torcjsonrpc.h</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a07e0d4900c71f8c8ab1d6748773d91a1"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a07e0d4900c71f8c8ab1d6748773d91a1">TorcHTTPRequest::SetResponseType</a></div><div class="ttdeci">void SetResponseType(HTTPResponseType Type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00197">torchttprequest.cpp:197</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_a82f54f38aacd812f0ce4ba935f337a93"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#a82f54f38aacd812f0ce4ba935f337a93">TorcHTTPService::GetServiceDetails</a></div><div class="ttdeci">QVariantMap GetServiceDetails(void)</div><div class="ttdoc">Return a QVariantMap describing the services methods and properties. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00727">torchttpservice.cpp:727</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a01340bcc9cce6aa1d156bd0468c708fcae6ec39e387f642513e62edf9b5af7f93"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fcae6ec39e387f642513e62edf9b5af7f93">HTTP_BadRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00072">torchttprequest.h:72</a></div></div>
<div class="ttc" id="class_torc_j_s_o_n_r_p_c_html_afd0ac8d71c1d29ca17196a269f66d934"><div class="ttname"><a href="../../d3/dd1/class_torc_j_s_o_n_r_p_c.html#afd0ac8d71c1d29ca17196a269f66d934">TorcJSONRPC::QMetaTypetoJavascriptType</a></div><div class="ttdeci">static QString QMetaTypetoJavascriptType(int MetaType)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db0/torcjsonrpc_8cpp_source.html#l00029">torcjsonrpc.cpp:29</a></div></div>
<div class="ttc" id="class_method_parameters_html_af4b498dd485b5ba32706c9aa9b03e230"><div class="ttname"><a href="../../de/db3/class_method_parameters.html#af4b498dd485b5ba32706c9aa9b03e230">MethodParameters::Invoke</a></div><div class="ttdeci">QVariant Invoke(QObject *Object, const QMap&lt; QString, QString &gt; &amp;Queries, QString &amp;ReturnType, bool &amp;VoidResult)</div><div class="ttdoc">Call the stored method with the arguments passed in via Queries. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00122">torchttpservice.cpp:122</a></div></div>
<div class="ttc" id="torcexitcodes_8h_html"><div class="ttname"><a href="../../d4/dbd/torcexitcodes_8h.html">torcexitcodes.h</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a0fa0de831c702f7d65dde3ee573f5ef8"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a0fa0de831c702f7d65dde3ee573f5ef8">HTTPGet</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00027">torchttprequest.h:27</a></div></div>
<div class="ttc" id="torchttpservice_8h_html"><div class="ttname"><a href="../../d3/dee/torchttpservice_8h.html">torchttpservice.h</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a9157522c82987335c1dea612bc3777f9"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a9157522c82987335c1dea612bc3777f9">TorcHTTPRequest::Queries</a></div><div class="ttdeci">const QMap&lt; QString, QString &gt; &amp; Queries(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00310">torchttprequest.cpp:310</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_ad0f1d98da3f74ea990bd91362a200e49ae58e121513274f5874ade749d85ac0e4"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49ae58e121513274f5874ade749d85ac0e4">HTTPResponseNone</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00039">torchttprequest.h:39</a></div></div>
<div class="ttc" id="torclogging_8h_html_a73a147108bf0df6442820b82b022ef94"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a></div><div class="ttdeci">#define LOG(_MASK_, _LEVEL_, _FORMAT_,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df9/torclogging_8h_source.html#l00031">torclogging.h:31</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_handler_html_a43e46ff19cfd0d7880a5992c980a92ea"><div class="ttname"><a href="../../d5/d15/class_torc_h_t_t_p_handler.html#a43e46ff19cfd0d7880a5992c980a92ea">TorcHTTPHandler::m_signature</a></div><div class="ttdeci">QString m_signature</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d11/torchttphandler_8h_source.html#l00034">torchttphandler.h:34</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Nov 18 2018 23:28:51 for Torc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
