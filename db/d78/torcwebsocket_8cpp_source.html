<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Torc: torcwebsocket.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Torc
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_19e1fafdf157c27762559b97f5d6a2d3.html">torc</a></li><li class="navelem"><a class="el" href="../../dir_5dec6d08b23834b4bbcf2e66f6498dfa.html">http</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">torcwebsocket.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../db/d78/torcwebsocket_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Class TorcWebSocket</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">* This file is part of the Torc project.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">* Copyright (C) Mark Kendall 2013-18</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">* This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">* it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">* the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">* (at your option) any later version.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">* This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">* but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">* GNU General Public License for more details.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">* You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">* along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">* Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">* USA.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// Qt</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;QUrl&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;QTimer&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;QTextStream&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;QJsonDocument&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;QCryptographicHash&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// Torc</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/df9/torclogging_8h.html">torclogging.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/da5/torcnetwork_8h.html">torcnetwork.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d9a/torcnetworkedcontext_8h.html">torcnetworkedcontext.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/dd7/torchttprequest_8h.html">torchttprequest.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d52/torcrpcrequest_8h.html">torcrpcrequest.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d1b/torchttpserver_8h.html">torchttpserver.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/dbe/torcwebsocket_8h.html">torcwebsocket.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a1b376ce4e70dc4cc8fdc7ceb337b08ed">   61</a></span>&#160;<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a1b376ce4e70dc4cc8fdc7ceb337b08ed">TorcWebSocket::TorcWebSocket</a>(<a class="code" href="../../d3/d5b/class_torc_web_socket_thread.html">TorcWebSocketThread</a>* Parent, qintptr SocketDescriptor, <span class="keywordtype">bool</span> Secure)</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  : QSslSocket(),</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    m_parent(Parent),</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    m_debug(),</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    m_secure(Secure),</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    m_socketState(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a37ac21f43b408a8e0bb5178633a61c1f">SocketState</a>::DisconnectedSt),</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    m_socketDescriptor(SocketDescriptor),</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    m_watchdogTimer(),</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    m_reader(),</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    m_wsReader(*this, <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html">TorcWebSocketReader</a>::SubProtocolNone, <a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a6bb428c1ccb88c717bfa26f1fcc7c33e">true</a>),</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    m_authenticated(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    m_challengeResponse(),</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    m_address(QHostAddress()),</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    m_port(0),</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    m_serverSide(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a6bb428c1ccb88c717bfa26f1fcc7c33e">true</a>),</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    m_subProtocol(<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html">TorcWebSocketReader</a>::SubProtocolNone),</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    m_subProtocolFrameFormat(<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html">TorcWebSocketReader</a>::OpText),</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    m_currentRequestID(1),</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    m_currentRequests(),</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    m_requestTimers(),</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    m_subscribers()</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;{</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    connect(&amp;m_watchdogTimer, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a902950a3ad3401e3c7cadcc7dc58d66f">TimedOut</a>()));</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    m_watchdogTimer.start(<a class="code" href="../../da/dbe/torcwebsocket_8h.html#a416115c7e746dd442e496d354bf73e8d">HTTP_SOCKET_TIMEOUT</a>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a5806c00d19a6f60fccfa3ee2da28fd96">   87</a></span>&#160;<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a1b376ce4e70dc4cc8fdc7ceb337b08ed">TorcWebSocket::TorcWebSocket</a>(<a class="code" href="../../d3/d5b/class_torc_web_socket_thread.html">TorcWebSocketThread</a>* Parent, <span class="keyword">const</span> QHostAddress &amp;Address, quint16 Port, <span class="keywordtype">bool</span> Secure, <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8">TorcWebSocketReader::WSSubProtocol</a> Protocol)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  : QSslSocket(),</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    m_parent(Parent),</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    m_debug(),</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    m_secure(Secure),</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    m_socketState(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a37ac21f43b408a8e0bb5178633a61c1f">SocketState</a>::<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a37ac21f43b408a8e0bb5178633a61c1faae50100da949fe6f7da6444a39e85499">DisconnectedSt</a>),</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    m_socketDescriptor(0),</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    m_watchdogTimer(),</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    m_reader(),</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    m_wsReader(*this, Protocol, <a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    m_authenticated(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    m_challengeResponse(),</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    m_address(Address),</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    m_port(Port),</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    m_serverSide(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    m_subProtocol(Protocol),</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    m_subProtocolFrameFormat(<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html">TorcWebSocketReader</a>::FormatForSubProtocol(Protocol)),</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    m_currentRequestID(1),</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    m_currentRequests(),</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    m_requestTimers(),</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    m_subscribers()</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;{</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// NB outgoing connection - do not start watchdog timer</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a47efc5e08385a02a885b1b1673b71307">  112</a></span>&#160;<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a47efc5e08385a02a885b1b1673b71307">TorcWebSocket::~TorcWebSocket</a>()</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;{</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// cancel any outstanding requests</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span> (!m_currentRequests.isEmpty())</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="comment">// clients should be cancelling requests before closing the connection, so this</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// may represent a leak</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;%1 outstanding RPC requests&quot;</span>).arg(m_currentRequests.size()));</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">while</span> (!m_currentRequests.isEmpty())</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <a class="code" href="../../d9/d0a/class_torc_web_socket.html#af4a3a0beba0fd40c47a0b558ff9c3ef9">CancelRequest</a>(m_currentRequests.begin().value());</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">if</span> (m_socketState == SocketState::Upgraded)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a771d8450a6fc08a5697c6eba32c20962">InitiateClose</a>(<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a26ae58518a15222c8461207ab5514270ad69ba1f0035fc53b0d304ec5cd5d4baf">TorcWebSocketReader::CloseGoingAway</a>, QString(<span class="stringliteral">&quot;WebSocket exiting normally&quot;</span>));</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a19c10456d6a95b46f776d9b91e069ce6">CloseSocket</a>();</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keywordtype">void</span> TorcWebSocket::HandleUpgradeRequest(<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html">TorcHTTPRequest</a> &amp;Request)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;{</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">if</span> (!m_serverSide)</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Trying to send response to upgrade request but not server side&quot;</span>);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordflow">if</span> (m_socketState != SocketState::ConnectedTo)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Trying to send response to upgrade request but not in connected state (HTTP)&quot;</span>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">bool</span> versionerror = <span class="keyword">false</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    QString error;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8">TorcWebSocketReader::WSSubProtocol</a> protocol = <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8a6825bca3fd6cd84ba3394c74b851c2f2">TorcWebSocketReader::SubProtocolNone</a>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">/* Excerpt from RFC 6455</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">    The requirements for this handshake are as follows.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">       1.   The handshake MUST be a valid HTTP request as specified by</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">            [RFC2616].</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">       2.   The method of the request MUST be GET, and the HTTP version MUST</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">            be at least 1.1.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">            For example, if the WebSocket URI is &quot;ws://example.com/chat&quot;,</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">            the first line sent should be &quot;GET /chat HTTP/1.1&quot;.</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; (Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#afa4abe22b1dbea3aec70283af2336809">GetHTTPRequestType</a>() != <a class="code" href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a0fa0de831c702f7d65dde3ee573f5ef8">HTTPGet</a> || Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#af654fd3766309d8cb444f3bdf97e02d0">GetHTTPProtocol</a>() != <a class="code" href="../../df/dd7/torchttprequest_8h.html#a0f1a039e4d02ced0cb598f5750cb9241a692fdb0e446acc1e78dee86657ae2e00">HTTPOneDotOne</a>))</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        error = <span class="stringliteral">&quot;Must be GET and HTTP/1.1&quot;</span>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">       3.   The &quot;Request-URI&quot; part of the request MUST match the /resource</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">            name/ defined in Section 3 (a relative URI) or be an absolute</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">            http/https URI that, when parsed, has a /resource name/, /host/,</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">            and /port/ that match the corresponding ws/wss URI.</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#af96b3ff07d66b9de039e5c14d7a9e8fc">GetPath</a>().isEmpty())</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        error = <span class="stringliteral">&quot;invalid Request-URI&quot;</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">       4.   The request MUST contain a |Host| header field whose value</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">            contains /host/ plus optionally &quot;:&quot; followed by /port/ (when not</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">            using the default port).</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; !Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Host&quot;</span>))</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        error = <span class="stringliteral">&quot;No Host header&quot;</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// default ports (e.g. 80) are not listed in host, so don&#39;t check in this case</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    QUrl host(<span class="stringliteral">&quot;http://&quot;</span> + Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Host&quot;</span>));</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">int</span> localport = localPort();</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; localport != 80 &amp;&amp; localport != 443 &amp;&amp; host.port() != localport)</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        error = <span class="stringliteral">&quot;Invalid Host port&quot;</span>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// disable host check. It offers us no additional security and may be a raw</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// ip address, domain name or or other host name.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; host.host() != localAddress().toString())</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        error = <span class="stringliteral">&quot;Invalid Host&quot;</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">       5.   The request MUST contain an |Upgrade| header field whose value</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">            MUST include the &quot;websocket&quot; keyword.</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; !Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Upgrade&quot;</span>))</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        error = <span class="stringliteral">&quot;No Upgrade header&quot;</span>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; !Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Upgrade&quot;</span>).contains(<span class="stringliteral">&quot;websocket&quot;</span>, Qt::CaseInsensitive))</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        error = <span class="stringliteral">&quot;No &#39;websocket request&quot;</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">       6.   The request MUST contain a |Connection| header field whose value</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">            MUST include the &quot;Upgrade&quot; token.</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; !Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Connection&quot;</span>))</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        error = <span class="stringliteral">&quot;No Connection header&quot;</span>;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; !Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Connection&quot;</span>).contains(<span class="stringliteral">&quot;Upgrade&quot;</span>, Qt::CaseInsensitive))</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        error = <span class="stringliteral">&quot;No Upgrade request&quot;</span>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">       7.   The request MUST include a header field with the name</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">            |Sec-WebSocket-Key|.  The value of this header field MUST be a</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">            nonce consisting of a randomly selected 16-byte value that has</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">            been base64-encoded (see Section 4 of [RFC4648]).  The nonce</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">            MUST be selected randomly for each connection.</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">            NOTE: As an example, if the randomly selected value was the</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">            sequence of bytes 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">            0x0a 0x0b 0x0c 0x0d 0x0e 0x0f 0x10, the value of the header</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">            field would be &quot;AQIDBAUGBwgJCgsMDQ4PEC==&quot;</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; !Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Sec-WebSocket-Key&quot;</span>))</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        error = <span class="stringliteral">&quot;No Sec-WebSocket-Key header&quot;</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Sec-WebSocket-Key&quot;</span>).isEmpty())</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        error = <span class="stringliteral">&quot;Invalid Sec-WebSocket-Key&quot;</span>;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">       8.   The request MUST include a header field with the name |Origin|</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">            [RFC6454] if the request is coming from a browser client.  If</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">            the connection is from a non-browser client, the request MAY</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">            include this header field if the semantics of that client match</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">            the use-case described here for browser clients.  The value of</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">            this header field is the ASCII serialization of origin of the</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">            context in which the code establishing the connection is</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">            running.  See [RFC6454] for the details of how this header field</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">            value is constructed.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">            As an example, if code downloaded from www.example.com attempts</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">            to establish a connection to ww2.example.com, the value of the</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">            header field would be &quot;http://www.example.com&quot;.</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">       9.   The request MUST include a header field with the name</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">            |Sec-WebSocket-Version|.  The value of this header field MUST be</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">            13.</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; !Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Sec-WebSocket-Version&quot;</span>))</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        error = <span class="stringliteral">&quot;No Sec-WebSocket-Version header&quot;</span>;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">int</span> version = Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Sec-WebSocket-Version&quot;</span>).toInt();</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; version != <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a440af48a5b5c5152fa6ec32a801b8a5fa8470ec20af21ae003bc4d57fde3388d0">TorcWebSocketReader::Version13</a> &amp;&amp; version != <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a440af48a5b5c5152fa6ec32a801b8a5fa9bad93d81a8b6eee3e3c36773f3feaa9">TorcWebSocketReader::Version8</a>)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        error = <span class="stringliteral">&quot;Unsupported WebSocket version&quot;</span>;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        versionerror = <span class="keyword">true</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">        10.  The request MAY include a header field with the name</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">        |Sec-WebSocket-Protocol|.  If present, this value indicates one</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">        or more comma-separated subprotocol the client wishes to speak,</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">        ordered by preference.  The elements that comprise this value</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">        MUST be non-empty strings with characters in the range U+0021 to</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">        U+007E not including separator characters as defined in</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">        [RFC2616] and MUST all be unique strings.  The ABNF for the</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">        value of this header field is 1#token, where the definitions of</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">        constructs and rules are as given in [RFC2616].</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Sec-WebSocket-Protocol&quot;</span>))</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        QList&lt;TorcWebSocketReader::WSSubProtocol&gt; protocols = <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#abcbceefdad1e6575f426bd216c950530">TorcWebSocketReader::SubProtocolsFromPrioritisedString</a>(Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Sec-WebSocket-Protocol&quot;</span>));</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span> (!protocols.isEmpty())</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            protocol = protocols.first();</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (!valid)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, error);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">SetStatus</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fcae6ec39e387f642513e62edf9b5af7f93">HTTP_BadRequest</a>);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> (versionerror)</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#ad74b355acfe235b1e2e025a1665521a1">SetResponseHeader</a>(<span class="stringliteral">&quot;Sec-WebSocket-Version&quot;</span>, <span class="stringliteral">&quot;8,13&quot;</span>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// valid handshake so set response headers and transfer socket</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, <span class="stringliteral">&quot;Received valid websocket Upgrade request&quot;</span>);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    QString key = Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Sec-WebSocket-Key&quot;</span>) + QLatin1String(<span class="stringliteral">&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;</span>);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    QString nonce = QCryptographicHash::hash(key.toUtf8(), QCryptographicHash::Sha1).toBase64();</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a07e0d4900c71f8c8ab1d6748773d91a1">SetResponseType</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49ae58e121513274f5874ade749d85ac0e4">HTTPResponseNone</a>);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">SetStatus</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fca4b7bc98bd06886fb880d680c5a4cf813">HTTP_SwitchingProtocols</a>);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a77eb83175f0e3855273d2458420db823">SetConnection</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a31e443b1967b3fd821d92e7d65de593daefb75807ee00696bfa83d0003fd9ec45">HTTPConnectionUpgrade</a>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#ad74b355acfe235b1e2e025a1665521a1">SetResponseHeader</a>(<span class="stringliteral">&quot;Upgrade&quot;</span>, <span class="stringliteral">&quot;websocket&quot;</span>);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#ad74b355acfe235b1e2e025a1665521a1">SetResponseHeader</a>(<span class="stringliteral">&quot;Sec-WebSocket-Accept&quot;</span>, nonce);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (protocol != <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8a6825bca3fd6cd84ba3394c74b851c2f2">TorcWebSocketReader::SubProtocolNone</a>)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#ad74b355acfe235b1e2e025a1665521a1">SetResponseHeader</a>(<span class="stringliteral">&quot;Sec-WebSocket-Protocol&quot;</span>, <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#afaa4f56bb539c6cf2a5c6c25e39ee99f">TorcWebSocketReader::SubProtocolsToString</a>(protocol));</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        m_subProtocol = protocol;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        m_subProtocolFrameFormat = <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a91bec1aa6e99dbc88741d0f8f8881343">TorcWebSocketReader::FormatForSubProtocol</a>(protocol);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a0ed03731fcbc0f68ef93625875f5ce3e">SetSubProtocol</a>(protocol);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    SetState(SocketState::Upgraded);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    m_authenticated = Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a7bfe2f62f752f6747c781f98a415a159">IsAuthorised</a>();</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;%1 socket upgraded  (%2)&quot;</span>).arg(m_debug).arg(m_authenticated ? <span class="stringliteral">&quot;Authenticated&quot;</span> : <span class="stringliteral">&quot;Unauthenticated&quot;</span>));</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">if</span> (Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Torc-UUID&quot;</span>))</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">// stop the watchdog timer for peers</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        m_watchdogTimer.stop();</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        QVariantMap data;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        data.insert(<span class="stringliteral">&quot;uuid&quot;</span>,       Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Torc-UUID&quot;</span>));</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        data.insert(<span class="stringliteral">&quot;name&quot;</span>,       Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Torc-Name&quot;</span>));</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        data.insert(<span class="stringliteral">&quot;port&quot;</span>,       Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Torc-Port&quot;</span>));</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        data.insert(<span class="stringliteral">&quot;priority&quot;</span>,   Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Torc-Priority&quot;</span>));</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        data.insert(<span class="stringliteral">&quot;starttime&quot;</span>,  Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Torc-Starttime&quot;</span>));</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        data.insert(<span class="stringliteral">&quot;apiversion&quot;</span>, Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Torc-APIVersion&quot;</span>));</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        data.insert(<span class="stringliteral">&quot;address&quot;</span>,    peerAddress().toString());</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordflow">if</span> (Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Torc-Secure&quot;</span>))</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            data.insert(<span class="stringliteral">&quot;secure&quot;</span>, <span class="stringliteral">&quot;yes&quot;</span>);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="../../d8/d93/class_torc_networked_context.html#a7f8eee3766155c3d0f63a255ddf5c447">TorcNetworkedContext::PeerConnected</a>(m_parent, data);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="comment">// increase the timeout for upgraded sockets</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        m_watchdogTimer.start(<a class="code" href="../../da/dbe/torcwebsocket_8h.html#a6af462a8f47f9705c7fa40fd87af71a2">FULL_SOCKET_TIMEOUT</a>);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (Request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a28fe4579b3cd4ba23153b6fa4ec007c5">GetMethod</a>().startsWith(QStringLiteral(<span class="stringliteral">&quot;echo&quot;</span>), Qt::CaseInsensitive))</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a48d38e5741bccd86270051f5ea7f4027">EnableEcho</a>();</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Enabling WebSocket echo for testing&quot;</span>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a88c14ab01d28126e755d4253a325cace">  392</a></span>&#160;QVariantList <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a88c14ab01d28126e755d4253a325cace">TorcWebSocket::GetSupportedSubProtocols</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;{</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    QVariantList result;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    QVariantMap proto;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    proto.insert(<span class="stringliteral">&quot;name&quot;</span>,<a class="code" href="../../d7/d28/torcwebsocketreader_8h.html#ac3f30770c63b354f160d10355141b646">TORC_JSON_RPC</a>);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    proto.insert(<span class="stringliteral">&quot;description&quot;</span>, <span class="stringliteral">&quot;I can&#39;t remember how this differs from straight JSON-RPC:) The overall mechanism is very similar to WAMP.&quot;</span>);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    result.append(proto);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#aaf5f723c14c08549a972954cb0df0a29">  402</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#aaf5f723c14c08549a972954cb0df0a29">TorcWebSocket::Encrypted</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;{</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">if</span> (m_debug.isEmpty())</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        m_debug = QString(<span class="stringliteral">&quot;&gt;&gt; %1 %2 -&quot;</span>).arg(<a class="code" href="../../d8/d73/class_torc_network.html#a97321aa2f3ccde2ae513cca94b277a85">TorcNetwork::IPAddressToLiteral</a>(peerAddress(), peerPort())).arg(m_secure ? <span class="stringliteral">&quot;secure&quot;</span> : <span class="stringliteral">&quot;insecure&quot;</span>);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(readyRead()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#ae22e5823f7a45393d5d008d298935f19">ReadyRead</a>()));</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    emit <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a915fa325ab6cbed6f8f368df66af4b59">ConnectionEstablished</a>();</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;%1 encrypted&quot;</span>).arg(m_debug));</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (!m_serverSide)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a387c32f90d8e7ddfe83af23bbc20abaf">Connected</a>();</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;}</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a1f106722f0fd7466e04df42c60204968">  414</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a1f106722f0fd7466e04df42c60204968">TorcWebSocket::SSLErrors</a>(<span class="keyword">const</span> QList&lt;QSslError&gt; &amp;Errors)</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;{</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    QList&lt;QSslError&gt; allowed = <a class="code" href="../../d8/d73/class_torc_network.html#afea981874003c3efb564e34964de77fe">TorcNetwork::AllowableSslErrors</a>(Errors);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">if</span> (!allowed.isEmpty())</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        ignoreSslErrors(allowed);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;}</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#ae80345e9ff3afd418759e958b0e0b2b9">  421</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#ae80345e9ff3afd418759e958b0e0b2b9">TorcWebSocket::IsSecure</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;{</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">return</span> m_secure;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;}</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a18f310f62f3108bdf1b243420918657b">  427</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a18f310f62f3108bdf1b243420918657b">TorcWebSocket::Start</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;{</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a6ead4fc6218b912c0ede245c1557ac8c">Disconnect</a>()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a19c10456d6a95b46f776d9b91e069ce6">CloseSocket</a>()));</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(bytesWritten(qint64)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a0a704407554b058ff903fc8047397963">BytesWritten</a>(qint64)));</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">// common setup</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    m_reader.<a class="code" href="../../d2/d37/class_torc_h_t_t_p_reader.html#a6f4f66a41347776b55a368459b179521">Reset</a>();</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#aa179cd3af30b547f9777573fc9121069">Reset</a>();</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(error(QAbstractSocket::SocketError)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a29634dbeaf7d935ad4d596be7d47886c">Error</a>(QAbstractSocket::SocketError)));</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(disconnected()),                      <span class="keyword">this</span>, SIGNAL(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a3dec9534407db137400e3f4b394d5c3f">Disconnected</a>()));</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(encrypted()),                         <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#aaf5f723c14c08549a972954cb0df0a29">Encrypted</a>()));</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    connect(<span class="keyword">this</span>, SIGNAL(sslErrors(QList&lt;QSslError&gt;)),         <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a1f106722f0fd7466e04df42c60204968">SSLErrors</a>(QList&lt;QSslError&gt;)));</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// Ignore errors for Self signed certificates</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    QList&lt;QSslError&gt; ignore;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    ignore &lt;&lt; QSslError::SelfSignedCertificate;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    ignoreSslErrors(ignore);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">// server side:)</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span> (m_serverSide &amp;&amp; m_socketDescriptor)</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">if</span> (setSocketDescriptor(m_socketDescriptor))</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            m_debug = QString(<span class="stringliteral">&quot;&lt;&lt; %1 %2 -&quot;</span>).arg(<a class="code" href="../../d8/d73/class_torc_network.html#a97321aa2f3ccde2ae513cca94b277a85">TorcNetwork::IPAddressToLiteral</a>(peerAddress(), peerPort())).arg(m_secure ? <span class="stringliteral">&quot;secure&quot;</span> : <span class="stringliteral">&quot;insecure&quot;</span>);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;%1 socket connected (%2)&quot;</span>).arg(m_debug).arg(m_authenticated ? <span class="stringliteral">&quot;Authenticated&quot;</span> : <span class="stringliteral">&quot;Unauthenticated&quot;</span>));</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            SetState(SocketState::ConnectedTo);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="keywordflow">if</span> (m_secure)</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                startServerEncryption();</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                connect(<span class="keyword">this</span>, SIGNAL(readyRead()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#ae22e5823f7a45393d5d008d298935f19">ReadyRead</a>()));</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                emit <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a915fa325ab6cbed6f8f368df66af4b59">ConnectionEstablished</a>();</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Failed to set socket descriptor&quot;</span>);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!m_serverSide)</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        SetState(SocketState::ConnectingTo);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">if</span> (m_secure)</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        {</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            connectToHostEncrypted(m_address.toString(), m_port);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            connect(<span class="keyword">this</span>, SIGNAL(connected()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a387c32f90d8e7ddfe83af23bbc20abaf">Connected</a>()));</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            connect(<span class="keyword">this</span>, SIGNAL(readyRead()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#ae22e5823f7a45393d5d008d298935f19">ReadyRead</a>()));</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            connectToHost(m_address, m_port);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">// failed</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Failed to start Websocket&quot;</span>);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a214b329b02c694f61045e92761daba9b">  494</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a214b329b02c694f61045e92761daba9b">TorcWebSocket::PropertyChanged</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;{</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html">TorcHTTPService</a> *service = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html">TorcHTTPService</a>*<span class="keyword">&gt;</span>(sender());</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">if</span> (service &amp;&amp; senderSignalIndex() &gt; -1)</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <a class="code" href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a> *request = <span class="keyword">new</span> <a class="code" href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a>(service-&gt;<a class="code" href="../../d5/d15/class_torc_h_t_t_p_handler.html#ac64379341026ef6b5ec3e42b997f248b">Signature</a>() + service-&gt;<a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#a193024836d5518d050445c68bb559f37">GetMethod</a>(senderSignalIndex()));</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa6d7eb36c3c225a55510ef7b52c468ab">AddParameter</a>(<span class="stringliteral">&quot;value&quot;</span>, service-&gt;<a class="code" href="../../d6/d70/class_torc_h_t_t_p_service.html#aa5a4b1c823eb77de82ea44c3912f931f">GetProperty</a>(senderSignalIndex()));</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a1ddb19a4d3cde2f9200fb5f9dd108c8f">SendFrame</a>(m_subProtocolFrameFormat, request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aee839f1d92eb29217727a7a13ded7e24">SerialiseRequest</a>(m_subProtocol));</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        request-&gt;<a class="code" href="../../d6/dad/class_torc_reference_counter.html#ae166de84902f0bd7b195ac2729cf50ac">DownRef</a>();</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;}</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a5c5b0d099be9af01eee59245e27c0264">  506</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a5c5b0d099be9af01eee59245e27c0264">TorcWebSocket::HandleNotification</a>(<span class="keyword">const</span> QString &amp;Method)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;{</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span> (m_subscribers.contains(Method))</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        QMap&lt;QString,QObject*&gt;::const_iterator it = m_subscribers.find(Method);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">while</span> (it != m_subscribers.end() &amp;&amp; it.key() == Method)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            QMetaObject::invokeMethod(it.value(), <span class="stringliteral">&quot;ServiceNotification&quot;</span>, Q_ARG(QString, Method));</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            ++it;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;}</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a274e621fc583fc9170fafae0de1a9f97">  527</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a274e621fc583fc9170fafae0de1a9f97">TorcWebSocket::RemoteRequest</a>(<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a> *Request)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;{</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">if</span> (!Request)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordtype">bool</span> notification = Request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a3ddfd420e63d0f742b92456c00f1fca9">IsNotification</a>();</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">// NB notitications cannot be cancelled - they are fire and forget.</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// NB other requests cannot be cancelled before this call is processed (they will not be present in m_currentRequests)</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">if</span> (!notification)</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        Request-&gt;<a class="code" href="../../d6/dad/class_torc_reference_counter.html#ac3b2e586cfe82404dfae25731ce24bbe">UpRef</a>();</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordtype">int</span> <span class="keywordtype">id</span> = m_currentRequestID++;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">while</span> (m_currentRequests.contains(<span class="keywordtype">id</span>))</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordtype">id</span> = m_currentRequestID++;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        Request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a865ef10756f640e86e9984a76904e307">SetID</a>(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        m_currentRequests.insert(<span class="keywordtype">id</span>, Request);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment">// start a timer for this request</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        m_requestTimers.insert(startTimer(10000, Qt::CoarseTimer), <span class="keywordtype">id</span>);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">// keep id&#39;s at sane values</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordflow">if</span> (m_currentRequestID &gt; 100000)</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            m_currentRequestID = 1;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    }</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    Request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa0a87f4b77ef3e4942e972fbea7ca143">AddState</a>(<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202adf839f3be385f7a4eaac996223ed9ed4">TorcRPCRequest::RequestSent</a>);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">if</span> (m_subProtocol != <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8a6825bca3fd6cd84ba3394c74b851c2f2">TorcWebSocketReader::SubProtocolNone</a>)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a1ddb19a4d3cde2f9200fb5f9dd108c8f">SendFrame</a>(m_subProtocolFrameFormat, Request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aee839f1d92eb29217727a7a13ded7e24">SerialiseRequest</a>(m_subProtocol));</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;No protocol specified for remote procedure call&quot;</span>);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">// notifications are fire and forget, so downref immediately</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">if</span> (notification)</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        Request-&gt;<a class="code" href="../../d6/dad/class_torc_reference_counter.html#ae166de84902f0bd7b195ac2729cf50ac">DownRef</a>();</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;}</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#af4a3a0beba0fd40c47a0b558ff9c3ef9">  570</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#af4a3a0beba0fd40c47a0b558ff9c3ef9">TorcWebSocket::CancelRequest</a>(<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a> *Request)</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;{</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">if</span> (Request &amp;&amp; !Request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a3ddfd420e63d0f742b92456c00f1fca9">IsNotification</a>() &amp;&amp; Request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa8b2f12e92f6a387ac0e30b02c2f5678">GetID</a>() &gt; -1)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        Request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa0a87f4b77ef3e4942e972fbea7ca143">AddState</a>(<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202a1929f68c1017438cba7bdde26f09d5a4">TorcRPCRequest::Cancelled</a>);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordtype">int</span> <span class="keywordtype">id</span> = Request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa8b2f12e92f6a387ac0e30b02c2f5678">GetID</a>();</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">if</span> (m_currentRequests.contains(<span class="keywordtype">id</span>))</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="comment">// cancel the timer</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="keywordtype">int</span> timer = m_requestTimers.key(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            killTimer(timer);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            m_requestTimers.remove(timer);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="comment">// cancel the request</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            m_currentRequests.remove(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            Request-&gt;<a class="code" href="../../d6/dad/class_torc_reference_counter.html#ae166de84902f0bd7b195ac2729cf50ac">DownRef</a>();</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Cannot cancel unknown RPC request&quot;</span>);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">if</span> (Request-&gt;<a class="code" href="../../d6/dad/class_torc_reference_counter.html#a6f81bd851c3accb637ff9d11f4a861d9">IsShared</a>())</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;RPC request is still referenced after cancellation - potential leak&quot;</span>);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;}</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="keywordtype">void</span> TorcWebSocket::ReadHTTP(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;{</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span> (!m_serverSide)</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Trying to read HTTP but not server side&quot;</span>);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span> (m_socketState != SocketState::ConnectedTo)</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Trying to read HTTP but not in connected state (raw HTTP)&quot;</span>);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">while</span> (canReadLine())</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="comment">// read data</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="keywordflow">if</span> (!m_reader.<a class="code" href="../../d2/d37/class_torc_h_t_t_p_reader.html#adfb6ba6f08ad97603bcd0dddabdc36b6">Read</a>(<span class="keyword">this</span>))</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">if</span> (!m_reader.<a class="code" href="../../d2/d37/class_torc_h_t_t_p_reader.html#ac226509ed3fc1ec31953b76cd6d7adb1">IsReady</a>())</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="comment">// sanity check</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">if</span> (bytesAvailable() &gt; 0)</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;%1 unread bytes from %2&quot;</span>).arg(bytesAvailable()).arg(peerAddress().toString()));</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">// have headers and content - process request</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html">TorcHTTPRequest</a> request(&amp;m_reader);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#aa83d3c746b0ea4ee16b037daee4828fe">SetSecure</a>(m_secure);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="keywordflow">if</span> (request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a5c57ac25075e4c4de2e4435e3dc97a79">GetHTTPType</a>() == <a class="code" href="../../df/dd7/torchttprequest_8h.html#abfdd8c288ba8bfed32669bd1853eb0abaa1b719f2a2692decd287e79c7581d390">HTTPResponse</a>)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Received unexpected HTTP response&quot;</span>);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="keywordtype">bool</span> upgrade = request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Upgrade&quot;</span>);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <a class="code" href="../../db/dc7/class_torc_h_t_t_p_server.html#a137ad2328a7bece60939bd7616e334d9">TorcHTTPServer::Authorise</a>(peerAddress().toString(), request, upgrade);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">if</span> (upgrade)</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            HandleUpgradeRequest(request);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="keywordflow">if</span> (request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a7bfe2f62f752f6747c781f98a415a159">IsAuthorised</a>() == <a class="code" href="../../df/dd7/torchttprequest_8h.html#a754e7c9b48b64232a694ebe1e35e320fa7fd0bbb3ae8c5081bad5ebac9529a294">HTTPAuthorised</a> || request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a7bfe2f62f752f6747c781f98a415a159">IsAuthorised</a>() == <a class="code" href="../../df/dd7/torchttprequest_8h.html#a754e7c9b48b64232a694ebe1e35e320fa456a5f79d83f5ea69e304355e4071c96">HTTPPreAuthorised</a>)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                <a class="code" href="../../db/dc7/class_torc_h_t_t_p_server.html#adbbc7a6ee089b03b2871d0ad156cacbd">TorcHTTPServer::HandleRequest</a>(peerAddress().toString(), peerPort(),</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                                              localAddress().toString(), localPort(), request);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a0592d4ecd8e75f34bc2b0eeb2c29d077">Respond</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="comment">// reset</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        m_reader.<a class="code" href="../../d2/d37/class_torc_h_t_t_p_reader.html#a6f4f66a41347776b55a368459b179521">Reset</a>();</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;}</div><div class="line"><a name="l00666"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#ae22e5823f7a45393d5d008d298935f19">  666</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#ae22e5823f7a45393d5d008d298935f19">TorcWebSocket::ReadyRead</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;{</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">// restart the watchdog timer</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">if</span> (m_watchdogTimer.isActive())</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        m_watchdogTimer.start();</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">// Guard against spurious socket activity/connections e.g. a client trying to connect using SSL when</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="comment">// the server is not expecting secure sockets. TorcHTTPReader will be expecting a complete line but no additional</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">// data is received so we loop continuously. So count retries while the available bytes remains unchanged and introduce</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">// a micro sleep when available bytes does not change during the loop.</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> maxUnchanged   = 5000;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> unchangedSleep = 1000; <span class="comment">// microseconds (1ms) - for a total timeout of 5 seconds</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordtype">int</span> unchangedCount = 0;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">while</span> ((m_socketState == SocketState::ConnectedTo || m_socketState == SocketState::Upgrading || m_socketState == SocketState::Upgraded) &amp;&amp;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            bytesAvailable())</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        qint64 available = bytesAvailable();</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">if</span> (m_socketState == SocketState::ConnectedTo)</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            ReadHTTP();</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="comment">// we may now be upgrading</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">if</span> (m_socketState == SocketState::Upgrading)</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordflow">if</span> (m_serverSide)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                <span class="comment">// the upgrade request is handled in ReadHTTP and if successfully processed we</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="comment">// move directly into the Upgraded state</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Upgrading state on server side&quot;</span>);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                ReadHandshake();</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="comment">// we may now be upgraded</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">if</span> (m_socketState == SocketState::Upgraded)</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        {</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <span class="keywordflow">if</span> (!m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a10bdb4115d9564dab2b3108e1839ea8c">Read</a>())</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                <span class="keywordflow">if</span> (m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a4d9f6b63801e378c8b377503339405b7">CloseSent</a>())</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                    SetState(SocketState::Disconnecting);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                <span class="comment">// have a payload</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                ProcessPayload(m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#ac674f9a21142ee3a2c0f02546585df57">GetPayload</a>());</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#aa179cd3af30b547f9777573fc9121069">Reset</a>();</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            }</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        }</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="comment">// pause if necessary</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">if</span> (bytesAvailable() == available)</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            unchangedCount++;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <span class="keywordflow">if</span> (unchangedCount &gt; maxUnchanged)</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;Socket time out waiting for valid data - closing&quot;</span>));</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                SetState(SocketState::Disconnecting);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            TorcQThread::usleep(unchangedSleep);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;}</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#ad9297ae797b71ffca318acbd1cfac50a">  743</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#ad9297ae797b71ffca318acbd1cfac50a">TorcWebSocket::SubscriberDeleted</a>(QObject *Object)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;{</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    QList&lt;QString&gt; <span class="keyword">remove</span>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    QMap&lt;QString,QObject*&gt;::const_iterator it = m_subscribers.begin();</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">for</span> ( ; it != m_subscribers.end(); ++it)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span> (it.value() == Object)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            <span class="keyword">remove</span>.append(it.key());</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keywordflow">foreach</span> (QString service, <span class="keyword">remove</span>)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        m_subscribers.remove(service, Object);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;Removed stale subscription to &#39;%1&#39;&quot;</span>).arg(service));</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;}</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a19c10456d6a95b46f776d9b91e069ce6">  759</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a19c10456d6a95b46f776d9b91e069ce6">TorcWebSocket::CloseSocket</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;{</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">if</span>(state() == QAbstractSocket::ConnectedState)</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;%1 disconnecting&quot;</span>).arg(m_debug));</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    disconnectFromHost();</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">// we only check for connected state - we don&#39;t care if it is any in any prior or subsequent state (hostlookup, connecting) and</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">// the wait is only a &#39;courtesy&#39; anyway.</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">if</span> (state() == QAbstractSocket::ConnectedState &amp;&amp; !waitForDisconnected(1000))</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, <span class="stringliteral">&quot;WebSocket not successfully disconnected before closing&quot;</span>);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    close();</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a387c32f90d8e7ddfe83af23bbc20abaf">  772</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a387c32f90d8e7ddfe83af23bbc20abaf">TorcWebSocket::Connected</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;{</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    m_debug = QString(<span class="stringliteral">&quot;&gt;&gt; %1 %2 -&quot;</span>).arg(<a class="code" href="../../d8/d73/class_torc_network.html#a97321aa2f3ccde2ae513cca94b277a85">TorcNetwork::IPAddressToLiteral</a>(peerAddress(), peerPort())).arg(m_secure ? <span class="stringliteral">&quot;secure&quot;</span> : <span class="stringliteral">&quot;insecure&quot;</span>);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;%1 connection to remote host&quot;</span>).arg(m_debug));</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    SetState(SocketState::Upgrading);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    SendHandshake();</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;}</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="keywordtype">void</span> TorcWebSocket::SendHandshake(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;{</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">if</span> (m_serverSide)</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    {</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Trying to send handshake from server side&quot;</span>);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordflow">if</span> (m_socketState != SocketState::Upgrading)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Trying to upgrade from incorrect state (client side)&quot;</span>);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    QScopedPointer&lt;QByteArray&gt; upgrade(<span class="keyword">new</span> QByteArray());</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    QTextStream stream(upgrade.data());</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    QByteArray nonce;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 16; ++i)</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        nonce.append(qrand() % 0x100);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    nonce = nonce.toBase64();</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="comment">// store the expected response for later comparison</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    QString key = QString(nonce.data()) + QLatin1String(<span class="stringliteral">&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;</span>);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    m_challengeResponse = QCryptographicHash::hash(key.toUtf8(), QCryptographicHash::Sha1).toBase64();</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    QHostAddress host(m_address);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a> server = <a class="code" href="../../db/dc7/class_torc_h_t_t_p_server.html#a31cdb1ef6354d2a3de8266715b4c08d0">TorcHTTPServer::GetStatus</a>();</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;GET / HTTP/1.1\r\n&quot;</span>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;User-Agent: &quot;</span> &lt;&lt; <a class="code" href="../../db/dc7/class_torc_h_t_t_p_server.html#ac96d6052c5e361d6cfa04406ac64f7b2">TorcHTTPServer::PlatformName</a>() &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Host: &quot;</span> &lt;&lt; <a class="code" href="../../d8/d73/class_torc_network.html#a97321aa2f3ccde2ae513cca94b277a85">TorcNetwork::IPAddressToLiteral</a>(host, m_port) &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Upgrade: WebSocket\r\n&quot;</span>;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Connection: Upgrade\r\n&quot;</span>;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Sec-WebSocket-Version: 13\r\n&quot;</span>;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Sec-WebSocket-Key: &quot;</span> &lt;&lt; nonce.data() &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">if</span> (m_subProtocol != <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8a6825bca3fd6cd84ba3394c74b851c2f2">TorcWebSocketReader::SubProtocolNone</a>)</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        stream &lt;&lt; <span class="stringliteral">&quot;Sec-WebSocket-Protocol: &quot;</span> &lt;&lt; <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#afaa4f56bb539c6cf2a5c6c25e39ee99f">TorcWebSocketReader::SubProtocolsToString</a>(m_subProtocol) &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Torc-UUID: &quot;</span> &lt;&lt; <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#aa09db82a2aaa43aa08cef5f30d32e271">GetUuid</a>() &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Torc-Port: &quot;</span> &lt;&lt; QString::number(server.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>) &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Torc-Name: &quot;</span> &lt;&lt; <a class="code" href="../../db/dc7/class_torc_h_t_t_p_server.html#acd8ffa7ed1862bfdba35af63855a2a8d">TorcHTTPServer::ServerDescription</a>() &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Torc-Priority:&quot;</span> &lt;&lt; <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#a6585544b1dd0f8ebb815ed3ad150a2cd">GetPriority</a>() &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Torc-Starttime:&quot;</span> &lt;&lt; <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#a6b6b5cc4732fee612a1a5e3ebe2cfcf1">GetStartTime</a>() &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;Torc-APIVersion:&quot;</span> &lt;&lt; <a class="code" href="../../d1/d54/class_torc_h_t_t_p_services.html#ae8444ae326f123a375ff798be6a121b3">TorcHTTPServices::GetVersion</a>() &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">if</span> (server.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a72c26ba82b22a758e5612f82d794d6ac">secure</a>)</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        stream &lt;&lt; <span class="stringliteral">&quot;Torc-Secure: yes\r\n&quot;</span>;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    stream &lt;&lt; <span class="stringliteral">&quot;\r\n&quot;</span>;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    stream.flush();</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">if</span> (write(upgrade-&gt;data(), upgrade-&gt;size()) != upgrade-&gt;size())</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    {</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Unexpected write error&quot;</span>);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    }</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;%1 client WebSocket connected (SubProtocol: %2)&quot;</span>)</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        .arg(m_debug).arg(<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#afaa4f56bb539c6cf2a5c6c25e39ee99f">TorcWebSocketReader::SubProtocolsToString</a>(m_subProtocol)));</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_DEBUG, QString(<span class="stringliteral">&quot;Data...\r\n%1&quot;</span>).arg(upgrade-&gt;data()));</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;}</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keywordtype">void</span> TorcWebSocket::ReadHandshake(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;{</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">if</span> (m_serverSide)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Trying to read handshake server side&quot;</span>);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    }</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">if</span> (m_socketState != SocketState::Upgrading)</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Trying to read handshake but not upgrading&quot;</span>);</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    }</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">// read response (which is the only raw HTTP we should see)</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">if</span> (!m_reader.<a class="code" href="../../d2/d37/class_torc_h_t_t_p_reader.html#adfb6ba6f08ad97603bcd0dddabdc36b6">Read</a>(<span class="keyword">this</span>))</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    {</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Error reading upgrade response&quot;</span>);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="comment">// response complete</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span> (!m_reader.<a class="code" href="../../d2/d37/class_torc_h_t_t_p_reader.html#ac226509ed3fc1ec31953b76cd6d7adb1">IsReady</a>())</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// parse the response</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html">TorcHTTPRequest</a> request(&amp;m_reader);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    QString error;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="comment">// is it a response</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a5c57ac25075e4c4de2e4435e3dc97a79">GetHTTPType</a>() != <a class="code" href="../../df/dd7/torchttprequest_8h.html#abfdd8c288ba8bfed32669bd1853eb0abaa1b719f2a2692decd287e79c7581d390">HTTPResponse</a>)</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        error = QString(<span class="stringliteral">&quot;Response is not an HTTP response&quot;</span>);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    }</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="comment">// is it switching protocols</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a498d3260cc7afff8d581fe0756c0283b">GetHTTPStatus</a>() != <a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fca4b7bc98bd06886fb880d680c5a4cf813">HTTP_SwitchingProtocols</a>)</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        error = QString(<span class="stringliteral">&quot;Expected &#39;%1&#39; - got &#39;%2&#39;&quot;</span>).arg(<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#ac406e3d9c27182cf19c09293e222b813">TorcHTTPRequest::StatusToString</a>(<a class="code" href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fca4b7bc98bd06886fb880d680c5a4cf813">HTTP_SwitchingProtocols</a>))</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                .arg(<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#ac406e3d9c27182cf19c09293e222b813">TorcHTTPRequest::StatusToString</a>(request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a498d3260cc7afff8d581fe0756c0283b">GetHTTPStatus</a>()));</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    }</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="comment">// does it contain the correct headers</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">if</span> (valid &amp;&amp; !(request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Upgrade&quot;</span>) &amp;&amp; request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Connection&quot;</span>) &amp;&amp;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                   request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().contains(<span class="stringliteral">&quot;Sec-WebSocket-Accept&quot;</span>)))</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        error = QString(<span class="stringliteral">&quot;Response is missing required headers&quot;</span>);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="comment">// correct header contents</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">if</span> (valid)</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        QString upgrade    = request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Upgrade&quot;</span>).trimmed();</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        QString connection = request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Connection&quot;</span>).trimmed();</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        QString accept     = request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Sec-WebSocket-Accept&quot;</span>).trimmed();</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        QString protocols  = request.<a class="code" href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">Headers</a>().value(<span class="stringliteral">&quot;Sec-WebSocket-Protocol&quot;</span>).trimmed();</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">if</span> (!upgrade.contains(<span class="stringliteral">&quot;websocket&quot;</span>, Qt::CaseInsensitive) || !connection.contains(<span class="stringliteral">&quot;upgrade&quot;</span>, Qt::CaseInsensitive))</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            error = QString(<span class="stringliteral">&quot;Unexpected header content&quot;</span>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        }</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="keywordflow">if</span> (!accept.contains(m_challengeResponse, Qt::CaseSensitive))</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                error = QString(<span class="stringliteral">&quot;Incorrect Sec-WebSocket-Accept response&quot;</span>);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="comment">// ensure the correct subprotocol (if any) has been agreed</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <span class="keywordflow">if</span> (valid)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="keywordflow">if</span> (m_subProtocol == <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8a6825bca3fd6cd84ba3394c74b851c2f2">TorcWebSocketReader::SubProtocolNone</a>)</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                <span class="keywordflow">if</span> (!protocols.isEmpty())</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                {</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                    valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                    error = QString(<span class="stringliteral">&quot;Unexpected subprotocol&quot;</span>);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                TorcWebSocketReader::WSSubProtocols subprotocols = <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a914891256c98eeefa90011b7fc36adab">TorcWebSocketReader::SubProtocolsFromString</a>(protocols);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                <span class="keywordflow">if</span> ((subprotocols | m_subProtocol) != m_subProtocol)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                    valid = <span class="keyword">false</span>;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                    error = QString(<span class="stringliteral">&quot;Unexpected subprotocol&quot;</span>);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                }</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            }</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        }</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span> (!valid)</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    {</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, error);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    }</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, <span class="stringliteral">&quot;Received valid upgrade response - switching to frame protocol&quot;</span>);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    SetState(SocketState::Upgraded);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;}</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a29634dbeaf7d935ad4d596be7d47886c">  957</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a29634dbeaf7d935ad4d596be7d47886c">TorcWebSocket::Error</a>(QAbstractSocket::SocketError SocketError)</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;{</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">if</span> (QAbstractSocket::RemoteHostClosedError == SocketError)</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;%1 remote host disconnected socket&quot;</span>).arg(m_debug));</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;%1 socket error %2 &#39;%3&#39;&quot;</span>).arg(m_debug).arg(SocketError).arg(errorString()));</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    SetState(SocketState::ErroredSt);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;}</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a902950a3ad3401e3c7cadcc7dc58d66f">  966</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a902950a3ad3401e3c7cadcc7dc58d66f">TorcWebSocket::TimedOut</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;{</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">if</span>(m_socketState == SocketState::Upgraded)</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;%1 no websocket traffic for %2seconds&quot;</span>).arg(m_debug).arg(m_watchdogTimer.interval() / 1000));</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;%1 no HTTP traffic for %2seconds&quot;</span>).arg(m_debug).arg(m_watchdogTimer.interval() / 1000));</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    SetState(SocketState::DisconnectedSt);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;}</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a0a704407554b058ff903fc8047397963">  975</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a0a704407554b058ff903fc8047397963">TorcWebSocket::BytesWritten</a>(qint64)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;{</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">if</span> (m_watchdogTimer.isActive())</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        m_watchdogTimer.start();</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;}</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno"><a class="line" href="../../d9/d0a/class_torc_web_socket.html#a5d0dec072db7d0b0e82637d878dc28f5">  981</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a5d0dec072db7d0b0e82637d878dc28f5">TorcWebSocket::event</a>(QEvent *Event)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;{</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">if</span> (Event-&gt;type() == QEvent::Timer)</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    {</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        QTimerEvent *<span class="keyword">event</span> = <span class="keyword">static_cast&lt;</span>QTimerEvent*<span class="keyword">&gt;</span>(Event);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a5d0dec072db7d0b0e82637d878dc28f5">event</a>)</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        {</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            <span class="keywordtype">int</span> timerid = <span class="keyword">event</span>-&gt;timerId();</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            <span class="keywordflow">if</span> (m_requestTimers.contains(timerid))</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                <span class="comment">// remove the timer</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                <span class="keywordtype">int</span> requestid = m_requestTimers.value(timerid);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                killTimer(timerid);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                m_requestTimers.remove(timerid);</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                <span class="comment">// handle the timeout</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                <a class="code" href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a> *request = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                <span class="keywordflow">if</span> (m_currentRequests.contains(requestid) &amp;&amp; (request = m_currentRequests.value(requestid)))</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                    request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa0a87f4b77ef3e4942e972fbea7ca143">AddState</a>(<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202ab8772ec6531d6b7226bffeaf255fff44">TorcRPCRequest::TimedOut</a>);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;&#39;%1&#39; request timed out&quot;</span>).arg(request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a7e895894a445761424d38c26366f2b51">GetMethod</a>()));</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                    request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a773028b98957c57fbd235948e7e7685b">NotifyParent</a>();</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                    m_currentRequests.remove(requestid);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                    request-&gt;<a class="code" href="../../d6/dad/class_torc_reference_counter.html#ae166de84902f0bd7b195ac2729cf50ac">DownRef</a>();</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                }</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            }</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        }</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    }</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">return</span> QSslSocket::event(Event);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;}</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="keywordtype">void</span> TorcWebSocket::SetState(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#a37ac21f43b408a8e0bb5178633a61c1f">SocketState</a> State)</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;{</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordflow">if</span> (State == m_socketState)</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    m_socketState = State;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">if</span> (m_socketState == SocketState::Disconnecting || m_socketState == SocketState::DisconnectedSt ||</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        m_socketState == SocketState::ErroredSt)</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        emit <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a3dec9534407db137400e3f4b394d5c3f">Disconnected</a>();</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keywordflow">if</span> (m_socketState == SocketState::Upgraded)</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        emit <a class="code" href="../../d9/d0a/class_torc_web_socket.html#a89ef1ed7e16ec1772e47b105162cde12">ConnectionUpgraded</a>();</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;}</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="keywordtype">void</span> TorcWebSocket::ProcessPayload(<span class="keyword">const</span> QByteArray &amp;Payload)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;{</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordflow">if</span> (m_subProtocol == <a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8ac807614f4ebee06e2c4982dc1c96168f">TorcWebSocketReader::SubProtocolJSONRPC</a>)</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="comment">// NB there is no method to support SENDING batched requests (hence</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="comment">// we should only receive batched requests from 3rd parties) and hence there</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="comment">// is no support for handling batched responses.</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        <a class="code" href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a> *request = <span class="keyword">new</span> <a class="code" href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a>(m_subProtocol, Payload, <span class="keyword">this</span>, m_authenticated);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="comment">// if the request has data, we need to send it (it was a request!)</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="keywordflow">if</span> (!request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#ab616c0fcb76ff53cb85b471078fbdebe">GetData</a>().isEmpty())</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            m_wsReader.<a class="code" href="../../d3/d9a/class_torc_web_socket_reader.html#a1ddb19a4d3cde2f9200fb5f9dd108c8f">SendFrame</a>(m_subProtocolFrameFormat, request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#ab616c0fcb76ff53cb85b471078fbdebe">GetData</a>());</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="comment">// if the request has an id, we need to process it</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa8b2f12e92f6a387ac0e30b02c2f5678">GetID</a>() &gt; -1)</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        {</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;            <span class="keywordtype">int</span> <span class="keywordtype">id</span> = request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa8b2f12e92f6a387ac0e30b02c2f5678">GetID</a>();</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <a class="code" href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a> *requestor = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <span class="keywordflow">if</span> (m_currentRequests.contains(<span class="keywordtype">id</span>) &amp;&amp; (requestor = m_currentRequests.value(<span class="keywordtype">id</span>)))</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                requestor-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa0a87f4b77ef3e4942e972fbea7ca143">AddState</a>(<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202a1a9c8600564e7cf6603486fdf936f8c2">TorcRPCRequest::ReplyReceived</a>);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                <span class="keywordflow">if</span> (request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a9ae1b2648525d982113035df1bc54f4b">GetState</a>() &amp; <a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202a8826cb17c25b80325860cbb0fbc4df47">TorcRPCRequest::Errored</a>)</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                {</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                    requestor-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#aa0a87f4b77ef3e4942e972fbea7ca143">AddState</a>(<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202a8826cb17c25b80325860cbb0fbc4df47">TorcRPCRequest::Errored</a>);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                }</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                {</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                    QString method = requestor-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a7e895894a445761424d38c26366f2b51">GetMethod</a>();</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                    <span class="comment">// is this a successful response to a subscription request?</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                    <span class="keywordflow">if</span> (method.endsWith(<span class="stringliteral">&quot;/Subscribe&quot;</span>))</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                    {</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                        method.chop(9);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                        QObject *parent = requestor-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a1c19367a0f47c85d3f3445cc885c0609">GetParent</a>();</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                        <span class="keywordflow">if</span> (parent-&gt;metaObject()-&gt;indexOfSlot(QMetaObject::normalizedSignature(<span class="stringliteral">&quot;ServiceNotification(QString)&quot;</span>)) &lt; 0)</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                        {</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Cannot monitor subscription to &#39;%1&#39; for object &#39;%2&#39; - no notification slot&quot;</span>).arg(method).arg(parent-&gt;objectName()));</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                        }</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a2900e3c051379c8086f9d23b1bae3450">GetReply</a>().type() == QVariant::Map)</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                        {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                            <span class="comment">// listen for destroyed signals to ensure the subscriptions are cleaned up</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                            connect(parent, SIGNAL(destroyed(QObject*)), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d9/d0a/class_torc_web_socket.html#ad9297ae797b71ffca318acbd1cfac50a">SubscriberDeleted</a>(QObject*)));</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                            QVariantMap map = request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a2900e3c051379c8086f9d23b1bae3450">GetReply</a>().toMap();</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                            <span class="keywordflow">if</span> (map.contains(<span class="stringliteral">&quot;properties&quot;</span>) &amp;&amp; map.value(<span class="stringliteral">&quot;properties&quot;</span>).type() == QVariant::List)</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                            {</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                                QVariantList properties = map.value(<span class="stringliteral">&quot;properties&quot;</span>).toList();</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                                <span class="comment">// add each notification/parent pair to the subscriber list</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                                QVariantList::const_iterator it = properties.begin();</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                                <span class="keywordflow">for</span> ( ; it != properties.end(); ++it)</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                                {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                                    <span class="keywordflow">if</span> (it-&gt;type() == QVariant::Map)</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                                    {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                                        QVariantMap <span class="keyword">property</span> = it-&gt;toMap();</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                                        <span class="keywordflow">if</span> (property.contains(<span class="stringliteral">&quot;notification&quot;</span>))</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                                        {</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                                            QString service = method + <span class="keyword">property</span>.value(<span class="stringliteral">&quot;notification&quot;</span>).toString();</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                                            <span class="keywordflow">if</span> (m_subscribers.contains(service, parent))</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                                            {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                                                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;Object &#39;%1&#39; already has subscription to &#39;%2&#39;&quot;</span>).arg(parent-&gt;objectName()).arg(service));</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                                            }</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                                            <span class="keywordflow">else</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                                            {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                                                m_subscribers.insertMulti(service, parent);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                                                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Object &#39;%1&#39; subscribed to &#39;%2&#39;&quot;</span>).arg(parent-&gt;objectName()).arg(service));</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                                            }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                                        }</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                                    }</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                                }</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                            }</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                        }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                    }</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                    <span class="comment">// or a successful unsubscribe?</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (method.endsWith(<span class="stringliteral">&quot;/Unsubscribe&quot;</span>))</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                    {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                        method.chop(11);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                        QObject *parent = requestor-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a1c19367a0f47c85d3f3445cc885c0609">GetParent</a>();</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                        <span class="comment">// iterate over our subscriber list and remove anything that starts with method and points to parent</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                        QStringList <span class="keyword">remove</span>;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                        QMap&lt;QString,QObject*&gt;::const_iterator it = m_subscribers.begin();</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                        <span class="keywordflow">for</span> ( ; it != m_subscribers.end(); ++it)</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                            <span class="keywordflow">if</span> (it.value() == parent &amp;&amp; it.key().startsWith(method))</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                                <span class="keyword">remove</span>.append(it.key());</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                        <span class="keywordflow">foreach</span> (QString signature, <span class="keyword">remove</span>)</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                        {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Object &#39;%1&#39; unsubscribed from &#39;%2&#39;&quot;</span>).arg(parent-&gt;objectName()).arg(signature));</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                            m_subscribers.remove(signature, parent);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                        }</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                        <span class="comment">// and disconnect the destroyed signal if we have no more subscriptions for this object</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                        <span class="keywordflow">if</span> (!m_subscribers.values().contains(parent))</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                            (<span class="keywordtype">void</span>)disconnect(parent, <span class="keyword">nullptr</span>, <span class="keyword">this</span>, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                    }</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                    requestor-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a4311922f02204d218df8293b28210ff5">SetReply</a>(request-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a2900e3c051379c8086f9d23b1bae3450">GetReply</a>());</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                }</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                requestor-&gt;<a class="code" href="../../db/dc6/class_torc_r_p_c_request.html#a773028b98957c57fbd235948e7e7685b">NotifyParent</a>();</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                m_currentRequests.remove(<span class="keywordtype">id</span>);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                requestor-&gt;<a class="code" href="../../d6/dad/class_torc_reference_counter.html#ae166de84902f0bd7b195ac2729cf50ac">DownRef</a>();</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            }</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        }</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        request-&gt;<a class="code" href="../../d6/dad/class_torc_reference_counter.html#ae166de84902f0bd7b195ac2729cf50ac">DownRef</a>();</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;}</div><div class="ttc" id="torchttprequest_8h_html_a0f1a039e4d02ced0cb598f5750cb9241a692fdb0e446acc1e78dee86657ae2e00"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a0f1a039e4d02ced0cb598f5750cb9241a692fdb0e446acc1e78dee86657ae2e00">HTTPOneDotOne</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00062">torchttprequest.h:62</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a0a704407554b058ff903fc8047397963"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a0a704407554b058ff903fc8047397963">TorcWebSocket::BytesWritten</a></div><div class="ttdeci">void BytesWritten(qint64)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00975">torcwebsocket.cpp:975</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a0ed03731fcbc0f68ef93625875f5ce3e"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a0ed03731fcbc0f68ef93625875f5ce3e">TorcWebSocketReader::SetSubProtocol</a></div><div class="ttdeci">void SetSubProtocol(WSSubProtocol Protocol)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00172">torcwebsocketreader.cpp:172</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_ad9dfd7a6372a7be05888a5472ab03202a8826cb17c25b80325860cbb0fbc4df47"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202a8826cb17c25b80325860cbb0fbc4df47">TorcRPCRequest::Errored</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d52/torcrpcrequest_8h_source.html#l00024">torcrpcrequest.h:24</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_abcbceefdad1e6575f426bd216c950530"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#abcbceefdad1e6575f426bd216c950530">TorcWebSocketReader::SubProtocolsFromPrioritisedString</a></div><div class="ttdeci">static QList&lt; WSSubProtocol &gt; SubProtocolsFromPrioritisedString(const QString &amp;Protocols)</div><div class="ttdoc">Parse a prioritised list of supported WebSocket sub-protocols. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00111">torcwebsocketreader.cpp:111</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a6c998b57e09ce050435169ced7f2dcd8"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8">TorcWebSocketReader::WSSubProtocol</a></div><div class="ttdeci">WSSubProtocol</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/torcwebsocketreader_8h_source.html#l00064">torcwebsocketreader.h:64</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html">TorcHTTPRequest</a></div><div class="ttdoc">A class to encapsulate an incoming HTTP request. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00112">torchttprequest.h:112</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a48d38e5741bccd86270051f5ea7f4027"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a48d38e5741bccd86270051f5ea7f4027">TorcWebSocketReader::EnableEcho</a></div><div class="ttdeci">void EnableEcho(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00167">torcwebsocketreader.cpp:167</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_afa4abe22b1dbea3aec70283af2336809"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#afa4abe22b1dbea3aec70283af2336809">TorcHTTPRequest::GetHTTPRequestType</a></div><div class="ttdeci">HTTPRequestType GetHTTPRequestType(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00271">torchttprequest.cpp:271</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_ad9297ae797b71ffca318acbd1cfac50a"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#ad9297ae797b71ffca318acbd1cfac50a">TorcWebSocket::SubscriberDeleted</a></div><div class="ttdeci">void SubscriberDeleted(QObject *Subscriber)</div><div class="ttdoc">A subscriber object has been deleted. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00743">torcwebsocket.cpp:743</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_ac674f9a21142ee3a2c0f02546585df57"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#ac674f9a21142ee3a2c0f02546585df57">TorcWebSocketReader::GetPayload</a></div><div class="ttdeci">const QByteArray &amp; GetPayload(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00147">torcwebsocketreader.cpp:147</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_reader_html_adfb6ba6f08ad97603bcd0dddabdc36b6"><div class="ttname"><a href="../../d2/d37/class_torc_h_t_t_p_reader.html#adfb6ba6f08ad97603bcd0dddabdc36b6">TorcHTTPReader::Read</a></div><div class="ttdeci">bool Read(QTcpSocket *Socket)</div><div class="ttdoc">Read and parse data from the given socket. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/torchttpreader_8cpp_source.html#l00089">torchttpreader.cpp:89</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a387c32f90d8e7ddfe83af23bbc20abaf"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a387c32f90d8e7ddfe83af23bbc20abaf">TorcWebSocket::Connected</a></div><div class="ttdeci">void Connected(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00772">torcwebsocket.cpp:772</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a26ae58518a15222c8461207ab5514270ad69ba1f0035fc53b0d304ec5cd5d4baf"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a26ae58518a15222c8461207ab5514270ad69ba1f0035fc53b0d304ec5cd5d4baf">TorcWebSocketReader::CloseGoingAway</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/torcwebsocketreader_8h_source.html#l00038">torcwebsocketreader.h:38</a></div></div>
<div class="ttc" id="torclocalcontext_8cpp_html_a071080a60a9799e8b9609cb8898ef14f"><div class="ttname"><a href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a></div><div class="ttdeci">TorcLocalContext * gLocalContext</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00047">torclocalcontext.cpp:47</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_reader_html_ac226509ed3fc1ec31953b76cd6d7adb1"><div class="ttname"><a href="../../d2/d37/class_torc_h_t_t_p_reader.html#ac226509ed3fc1ec31953b76cd6d7adb1">TorcHTTPReader::IsReady</a></div><div class="ttdeci">bool IsReady(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/torchttpreader_8cpp_source.html#l00055">torchttpreader.cpp:55</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a77eb83175f0e3855273d2458420db823"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a77eb83175f0e3855273d2458420db823">TorcHTTPRequest::SetConnection</a></div><div class="ttdeci">void SetConnection(HTTPConnection Connection)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00183">torchttprequest.cpp:183</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_ad9dfd7a6372a7be05888a5472ab03202a1929f68c1017438cba7bdde26f09d5a4"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202a1929f68c1017438cba7bdde26f09d5a4">TorcRPCRequest::Cancelled</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d52/torcrpcrequest_8h_source.html#l00022">torcrpcrequest.h:22</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_html_a137ad2328a7bece60939bd7616e334d9"><div class="ttname"><a href="../../db/dc7/class_torc_h_t_t_p_server.html#a137ad2328a7bece60939bd7616e334d9">TorcHTTPServer::Authorise</a></div><div class="ttdeci">static void Authorise(const QString &amp;Host, TorcHTTPRequest &amp;Request, bool ForceCheck)</div><div class="ttdoc">Ensures remote user is authorised to access this request. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/torchttpserver_8cpp_source.html#l00495">torchttpserver.cpp:495</a></div></div>
<div class="ttc" id="class_torc_reference_counter_html_ac3b2e586cfe82404dfae25731ce24bbe"><div class="ttname"><a href="../../d6/dad/class_torc_reference_counter.html#ac3b2e586cfe82404dfae25731ce24bbe">TorcReferenceCounter::UpRef</a></div><div class="ttdeci">void UpRef(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/torcreferencecounted_8cpp_source.html#l00046">torcreferencecounted.cpp:46</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a89ef1ed7e16ec1772e47b105162cde12"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a89ef1ed7e16ec1772e47b105162cde12">TorcWebSocket::ConnectionUpgraded</a></div><div class="ttdeci">void ConnectionUpgraded(void)</div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a440af48a5b5c5152fa6ec32a801b8a5fa9bad93d81a8b6eee3e3c36773f3feaa9"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a440af48a5b5c5152fa6ec32a801b8a5fa9bad93d81a8b6eee3e3c36773f3feaa9">TorcWebSocketReader::Version8</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/torcwebsocketreader_8h_source.html#l00060">torcwebsocketreader.h:60</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_ad9dfd7a6372a7be05888a5472ab03202a1a9c8600564e7cf6603486fdf936f8c2"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202a1a9c8600564e7cf6603486fdf936f8c2">TorcRPCRequest::ReplyReceived</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d52/torcrpcrequest_8h_source.html#l00021">torcrpcrequest.h:21</a></div></div>
<div class="ttc" id="torchttprequest_8h_html"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html">torchttprequest.h</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_handler_html_ac64379341026ef6b5ec3e42b997f248b"><div class="ttname"><a href="../../d5/d15/class_torc_h_t_t_p_handler.html#ac64379341026ef6b5ec3e42b997f248b">TorcHTTPHandler::Signature</a></div><div class="ttdeci">QString Signature(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d87/torchttphandler_8cpp_source.html#l00065">torchttphandler.cpp:65</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a440af48a5b5c5152fa6ec32a801b8a5fa8470ec20af21ae003bc4d57fde3388d0"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a440af48a5b5c5152fa6ec32a801b8a5fa8470ec20af21ae003bc4d57fde3388d0">TorcWebSocketReader::Version13</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/torcwebsocketreader_8h_source.html#l00061">torcwebsocketreader.h:61</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a498d3260cc7afff8d581fe0756c0283b"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a498d3260cc7afff8d581fe0756c0283b">TorcHTTPRequest::GetHTTPStatus</a></div><div class="ttdeci">HTTPStatus GetHTTPStatus(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00261">torchttprequest.cpp:261</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_afaa4f56bb539c6cf2a5c6c25e39ee99f"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#afaa4f56bb539c6cf2a5c6c25e39ee99f">TorcWebSocketReader::SubProtocolsToString</a></div><div class="ttdeci">static QString SubProtocolsToString(WSSubProtocols Protocols)</div><div class="ttdoc">Convert SubProtocols to HTTP readable string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00091">torcwebsocketreader.cpp:91</a></div></div>
<div class="ttc" id="torcloggingdefs_8h_html_a6bb428c1ccb88c717bfa26f1fcc7c33e"><div class="ttname"><a href="../../d1/d37/torcloggingdefs_8h.html#a6bb428c1ccb88c717bfa26f1fcc7c33e">true</a></div><div class="ttdeci">VERBOSE_PREAMBLE true</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/torcloggingdefs_8h_source.html#l00048">torcloggingdefs.h:48</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_ae80345e9ff3afd418759e958b0e0b2b9"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#ae80345e9ff3afd418759e958b0e0b2b9">TorcWebSocket::IsSecure</a></div><div class="ttdeci">bool IsSecure(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00421">torcwebsocket.cpp:421</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_ab616c0fcb76ff53cb85b471078fbdebe"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#ab616c0fcb76ff53cb85b471078fbdebe">TorcRPCRequest::GetData</a></div><div class="ttdeci">QByteArray &amp; GetData(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00457">torcrpcrequest.cpp:457</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_ac406e3d9c27182cf19c09293e222b813"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#ac406e3d9c27182cf19c09293e222b813">TorcHTTPRequest::StatusToString</a></div><div class="ttdeci">static QString StatusToString(HTTPStatus Status)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00823">torchttprequest.cpp:823</a></div></div>
<div class="ttc" id="torcrpcrequest_8h_html"><div class="ttname"><a href="../../dd/d52/torcrpcrequest_8h.html">torcrpcrequest.h</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_aa8b2f12e92f6a387ac0e30b02c2f5678"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#aa8b2f12e92f6a387ac0e30b02c2f5678">TorcRPCRequest::GetID</a></div><div class="ttdeci">int GetID(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00427">torcrpcrequest.cpp:427</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a5c5b0d099be9af01eee59245e27c0264"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a5c5b0d099be9af01eee59245e27c0264">TorcWebSocket::HandleNotification</a></div><div class="ttdeci">bool HandleNotification(const QString &amp;Method)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00506">torcwebsocket.cpp:506</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_html_adbbc7a6ee089b03b2871d0ad156cacbd"><div class="ttname"><a href="../../db/dc7/class_torc_h_t_t_p_server.html#adbbc7a6ee089b03b2871d0ad156cacbd">TorcHTTPServer::HandleRequest</a></div><div class="ttdeci">static void HandleRequest(const QString &amp;PeerAddress, int PeerPort, const QString &amp;LocalAddress, int LocalPort, TorcHTTPRequest &amp;Request)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/torchttpserver_8cpp_source.html#l00127">torchttpserver.cpp:127</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html">TorcHTTPService</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dee/torchttpservice_8h_source.html#l00018">torchttpservice.h:18</a></div></div>
<div class="ttc" id="class_torc_local_context_html_aa09db82a2aaa43aa08cef5f30d32e271"><div class="ttname"><a href="../../d7/d17/class_torc_local_context.html#aa09db82a2aaa43aa08cef5f30d32e271">TorcLocalContext::GetUuid</a></div><div class="ttdeci">QString GetUuid(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00499">torclocalcontext.cpp:499</a></div></div>
<div class="ttc" id="class_torc_network_html_a97321aa2f3ccde2ae513cca94b277a85"><div class="ttname"><a href="../../d8/d73/class_torc_network.html#a97321aa2f3ccde2ae513cca94b277a85">TorcNetwork::IPAddressToLiteral</a></div><div class="ttdeci">static QString IPAddressToLiteral(const QHostAddress &amp;Address, int Port, bool UseLocalhost=true)</div><div class="ttdoc">Convert an IP address to a string literal. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d9c/torcnetwork_8cpp_source.html#l00196">torcnetwork.cpp:196</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_abfdd8c288ba8bfed32669bd1853eb0abaa1b719f2a2692decd287e79c7581d390"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#abfdd8c288ba8bfed32669bd1853eb0abaa1b719f2a2692decd287e79c7581d390">HTTPResponse</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00020">torchttprequest.h:20</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a6ead4fc6218b912c0ede245c1557ac8c"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a6ead4fc6218b912c0ede245c1557ac8c">TorcWebSocket::Disconnect</a></div><div class="ttdeci">void Disconnect(void)</div></div>
<div class="ttc" id="class_torc_web_socket_html_af4a3a0beba0fd40c47a0b558ff9c3ef9"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#af4a3a0beba0fd40c47a0b558ff9c3ef9">TorcWebSocket::CancelRequest</a></div><div class="ttdeci">void CancelRequest(TorcRPCRequest *Request)</div><div class="ttdoc">Cancel a Remote Procedure Call. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00570">torcwebsocket.cpp:570</a></div></div>
<div class="ttc" id="class_torc_reference_counter_html_ae166de84902f0bd7b195ac2729cf50ac"><div class="ttname"><a href="../../d6/dad/class_torc_reference_counter.html#ae166de84902f0bd7b195ac2729cf50ac">TorcReferenceCounter::DownRef</a></div><div class="ttdeci">virtual bool DownRef(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/torcreferencecounted_8cpp_source.html#l00051">torcreferencecounted.cpp:51</a></div></div>
<div class="ttc" id="torclogging_8h_html"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html">torclogging.h</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a7bfe2f62f752f6747c781f98a415a159"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a7bfe2f62f752f6747c781f98a415a159">TorcHTTPRequest::IsAuthorised</a></div><div class="ttdeci">HTTPAuthorisation IsAuthorised(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l01101">torchttprequest.cpp:1101</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_aa0a87f4b77ef3e4942e972fbea7ca143"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#aa0a87f4b77ef3e4942e972fbea7ca143">TorcRPCRequest::AddState</a></div><div class="ttdeci">void AddState(int State)</div><div class="ttdoc">Progress the state for this request. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00386">torcrpcrequest.cpp:386</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_1_1_status_html_a72c26ba82b22a758e5612f82d794d6ac"><div class="ttname"><a href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a72c26ba82b22a758e5612f82d794d6ac">TorcHTTPServer::Status::secure</a></div><div class="ttdeci">bool secure</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1b/torchttpserver_8h_source.html#l00037">torchttpserver.h:37</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a754e7c9b48b64232a694ebe1e35e320fa456a5f79d83f5ea69e304355e4071c96"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a754e7c9b48b64232a694ebe1e35e320fa456a5f79d83f5ea69e304355e4071c96">HTTPPreAuthorised</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00105">torchttprequest.h:105</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a1ddb19a4d3cde2f9200fb5f9dd108c8f"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a1ddb19a4d3cde2f9200fb5f9dd108c8f">TorcWebSocketReader::SendFrame</a></div><div class="ttdeci">void SendFrame(OpCode Code, QByteArray &amp;Payload)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00191">torcwebsocketreader.cpp:191</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html">TorcRPCRequest</a></div><div class="ttdoc">A class encapsulating a Remote Procedure Call. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d52/torcrpcrequest_8h_source.html#l00014">torcrpcrequest.h:14</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_a773028b98957c57fbd235948e7e7685b"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#a773028b98957c57fbd235948e7e7685b">TorcRPCRequest::NotifyParent</a></div><div class="ttdeci">void NotifyParent(void)</div><div class="ttdoc">Signal to the parent that the request is ready (but may be errored). </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00312">torcrpcrequest.cpp:312</a></div></div>
<div class="ttc" id="class_torc_network_html_afea981874003c3efb564e34964de77fe"><div class="ttname"><a href="../../d8/d73/class_torc_network.html#afea981874003c3efb564e34964de77fe">TorcNetwork::AllowableSslErrors</a></div><div class="ttdeci">static QList&lt; QSslError &gt; AllowableSslErrors(const QList&lt; QSslError &gt; &amp;Errors)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d9c/torcnetwork_8cpp_source.html#l00650">torcnetwork.cpp:650</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a37ac21f43b408a8e0bb5178633a61c1f"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a37ac21f43b408a8e0bb5178633a61c1f">TorcWebSocket::SocketState</a></div><div class="ttdeci">SocketState</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/torcwebsocket_8h_source.html#l00028">torcwebsocket.h:28</a></div></div>
<div class="ttc" id="class_torc_reference_counter_html_a6f81bd851c3accb637ff9d11f4a861d9"><div class="ttname"><a href="../../d6/dad/class_torc_reference_counter.html#a6f81bd851c3accb637ff9d11f4a861d9">TorcReferenceCounter::IsShared</a></div><div class="ttdeci">bool IsShared(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/torcreferencecounted_8cpp_source.html#l00072">torcreferencecounted.cpp:72</a></div></div>
<div class="ttc" id="class_torc_networked_context_html_a7f8eee3766155c3d0f63a255ddf5c447"><div class="ttname"><a href="../../d8/d93/class_torc_networked_context.html#a7f8eee3766155c3d0f63a255ddf5c447">TorcNetworkedContext::PeerConnected</a></div><div class="ttdeci">static void PeerConnected(TorcWebSocketThread *Thread, const QVariantMap &amp;Data)</div><div class="ttdoc">Respond to a valid WebSocket upgrade request and schedule creation of a WebSocket on the give QTcpSoc...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d48/torcnetworkedcontext_8cpp_source.html#l00803">torcnetworkedcontext.cpp:803</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a10bdb4115d9564dab2b3108e1839ea8c"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a10bdb4115d9564dab2b3108e1839ea8c">TorcWebSocketReader::Read</a></div><div class="ttdeci">bool Read(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00359">torcwebsocketreader.cpp:359</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_a7e895894a445761424d38c26366f2b51"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#a7e895894a445761424d38c26366f2b51">TorcRPCRequest::GetMethod</a></div><div class="ttdeci">QString GetMethod(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00432">torcrpcrequest.cpp:432</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a1b376ce4e70dc4cc8fdc7ceb337b08ed"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a1b376ce4e70dc4cc8fdc7ceb337b08ed">TorcWebSocket::TorcWebSocket</a></div><div class="ttdeci">TorcWebSocket(TorcWebSocketThread *Parent, qintptr SocketDescriptor, bool Secure)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00061">torcwebsocket.cpp:61</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a1f106722f0fd7466e04df42c60204968"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a1f106722f0fd7466e04df42c60204968">TorcWebSocket::SSLErrors</a></div><div class="ttdeci">void SSLErrors(const QList&lt; QSslError &gt; &amp;Errors)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00414">torcwebsocket.cpp:414</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_af96b3ff07d66b9de039e5c14d7a9e8fc"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#af96b3ff07d66b9de039e5c14d7a9e8fc">TorcHTTPRequest::GetPath</a></div><div class="ttdeci">QString GetPath(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00286">torchttprequest.cpp:286</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a9e82b042fb67936910250c4833a62c1c"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a9e82b042fb67936910250c4833a62c1c">TorcHTTPRequest::Headers</a></div><div class="ttdeci">const QMap&lt; QString, QString &gt; &amp; Headers(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00301">torchttprequest.cpp:301</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a754e7c9b48b64232a694ebe1e35e320fa7fd0bbb3ae8c5081bad5ebac9529a294"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a754e7c9b48b64232a694ebe1e35e320fa7fd0bbb3ae8c5081bad5ebac9529a294">HTTPAuthorised</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00106">torchttprequest.h:106</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a01340bcc9cce6aa1d156bd0468c708fca4b7bc98bd06886fb880d680c5a4cf813"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fca4b7bc98bd06886fb880d680c5a4cf813">HTTP_SwitchingProtocols</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00067">torchttprequest.h:67</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a28fe4579b3cd4ba23153b6fa4ec007c5"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a28fe4579b3cd4ba23153b6fa4ec007c5">TorcHTTPRequest::GetMethod</a></div><div class="ttdeci">QString GetMethod(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00291">torchttprequest.cpp:291</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_ad9dfd7a6372a7be05888a5472ab03202ab8772ec6531d6b7226bffeaf255fff44"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202ab8772ec6531d6b7226bffeaf255fff44">TorcRPCRequest::TimedOut</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d52/torcrpcrequest_8h_source.html#l00023">torcrpcrequest.h:23</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_a9ae1b2648525d982113035df1bc54f4b"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#a9ae1b2648525d982113035df1bc54f4b">TorcRPCRequest::GetState</a></div><div class="ttdeci">int GetState(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00422">torcrpcrequest.cpp:422</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a19c10456d6a95b46f776d9b91e069ce6"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a19c10456d6a95b46f776d9b91e069ce6">TorcWebSocket::CloseSocket</a></div><div class="ttdeci">void CloseSocket(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00759">torcwebsocket.cpp:759</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a3dec9534407db137400e3f4b394d5c3f"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a3dec9534407db137400e3f4b394d5c3f">TorcWebSocket::Disconnected</a></div><div class="ttdeci">void Disconnected(void)</div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_html_a31cdb1ef6354d2a3de8266715b4c08d0"><div class="ttname"><a href="../../db/dc7/class_torc_h_t_t_p_server.html#a31cdb1ef6354d2a3de8266715b4c08d0">TorcHTTPServer::GetStatus</a></div><div class="ttdeci">static Status GetStatus(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/torchttpserver_8cpp_source.html#l00239">torchttpserver.cpp:239</a></div></div>
<div class="ttc" id="torcwebsocket_8h_html_a6af462a8f47f9705c7fa40fd87af71a2"><div class="ttname"><a href="../../da/dbe/torcwebsocket_8h.html#a6af462a8f47f9705c7fa40fd87af71a2">FULL_SOCKET_TIMEOUT</a></div><div class="ttdeci">#define FULL_SOCKET_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/torcwebsocket_8h_source.html#l00021">torcwebsocket.h:21</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a6c998b57e09ce050435169ced7f2dcd8a6825bca3fd6cd84ba3394c74b851c2f2"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8a6825bca3fd6cd84ba3394c74b851c2f2">TorcWebSocketReader::SubProtocolNone</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/torcwebsocketreader_8h_source.html#l00066">torcwebsocketreader.h:66</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a5d0dec072db7d0b0e82637d878dc28f5"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a5d0dec072db7d0b0e82637d878dc28f5">TorcWebSocket::event</a></div><div class="ttdeci">bool event(QEvent *Event) override</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00981">torcwebsocket.cpp:981</a></div></div>
<div class="ttc" id="torcwebsocket_8h_html_a416115c7e746dd442e496d354bf73e8d"><div class="ttname"><a href="../../da/dbe/torcwebsocket_8h.html#a416115c7e746dd442e496d354bf73e8d">HTTP_SOCKET_TIMEOUT</a></div><div class="ttdeci">#define HTTP_SOCKET_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/torcwebsocket_8h_source.html#l00020">torcwebsocket.h:20</a></div></div>
<div class="ttc" id="torcloggingdefs_8h_html_a93519f65dd0ef21fc5be0c286a833ae4"><div class="ttname"><a href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a></div><div class="ttdeci">VERBOSE_PREAMBLE General info Playback related messages File and AutoExpire related messages Network protocol related messages Audio related messages JobQueue related messages EIT related messages DSMCC carousel related messages UPnP debugging messages xmltv output and related messages Media Manager debugging messages External executable related messages false</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/torcloggingdefs_8h_source.html#l00110">torcloggingdefs.h:110</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_a3ddfd420e63d0f742b92456c00f1fca9"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#a3ddfd420e63d0f742b92456c00f1fca9">TorcRPCRequest::IsNotification</a></div><div class="ttdeci">bool IsNotification(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00306">torcrpcrequest.cpp:306</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_ad74b355acfe235b1e2e025a1665521a1"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#ad74b355acfe235b1e2e025a1665521a1">TorcHTTPRequest::SetResponseHeader</a></div><div class="ttdeci">void SetResponseHeader(const QString &amp;Header, const QString &amp;Value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00210">torchttprequest.cpp:210</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_aee839f1d92eb29217727a7a13ded7e24"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#aee839f1d92eb29217727a7a13ded7e24">TorcRPCRequest::SerialiseRequest</a></div><div class="ttdeci">QByteArray &amp; SerialiseRequest(TorcWebSocketReader::WSSubProtocol Protocol)</div><div class="ttdoc">Serialise the request for the given protocol. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00345">torcrpcrequest.cpp:345</a></div></div>
<div class="ttc" id="torcnetwork_8h_html"><div class="ttname"><a href="../../da/da5/torcnetwork_8h.html">torcnetwork.h</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a37ac21f43b408a8e0bb5178633a61c1faae50100da949fe6f7da6444a39e85499"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a37ac21f43b408a8e0bb5178633a61c1faae50100da949fe6f7da6444a39e85499">TorcWebSocket::DisconnectedSt</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/dbe/torcwebsocket_8h_source.html#l00030">torcwebsocket.h:30</a></div></div>
<div class="ttc" id="torcwebsocket_8h_html"><div class="ttname"><a href="../../da/dbe/torcwebsocket_8h.html">torcwebsocket.h</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a914891256c98eeefa90011b7fc36adab"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a914891256c98eeefa90011b7fc36adab">TorcWebSocketReader::SubProtocolsFromString</a></div><div class="ttdeci">static WSSubProtocols SubProtocolsFromString(const QString &amp;Protocols)</div><div class="ttdoc">Parse supported WSSubProtocols from Protocols. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00101">torcwebsocketreader.cpp:101</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html">TorcWebSocketReader</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/torcwebsocketreader_8h_source.html#l00010">torcwebsocketreader.h:10</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_a2900e3c051379c8086f9d23b1bae3450"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#a2900e3c051379c8086f9d23b1bae3450">TorcRPCRequest::GetReply</a></div><div class="ttdeci">const QVariant &amp; GetReply(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00442">torcrpcrequest.cpp:442</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a88c14ab01d28126e755d4253a325cace"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a88c14ab01d28126e755d4253a325cace">TorcWebSocket::GetSupportedSubProtocols</a></div><div class="ttdeci">static QVariantList GetSupportedSubProtocols(void)</div><div class="ttdoc">Return a list of supported WebSocket sub-protocols. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00392">torcwebsocket.cpp:392</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_aaf5f723c14c08549a972954cb0df0a29"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#aaf5f723c14c08549a972954cb0df0a29">TorcWebSocket::Encrypted</a></div><div class="ttdeci">void Encrypted(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00402">torcwebsocket.cpp:402</a></div></div>
<div class="ttc" id="torcnetworkedcontext_8h_html"><div class="ttname"><a href="../../d5/d9a/torcnetworkedcontext_8h.html">torcnetworkedcontext.h</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a6c998b57e09ce050435169ced7f2dcd8ac807614f4ebee06e2c4982dc1c96168f"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a6c998b57e09ce050435169ced7f2dcd8ac807614f4ebee06e2c4982dc1c96168f">TorcWebSocketReader::SubProtocolJSONRPC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/torcwebsocketreader_8h_source.html#l00067">torcwebsocketreader.h:67</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_ad9dfd7a6372a7be05888a5472ab03202adf839f3be385f7a4eaac996223ed9ed4"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#ad9dfd7a6372a7be05888a5472ab03202adf839f3be385f7a4eaac996223ed9ed4">TorcRPCRequest::RequestSent</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d52/torcrpcrequest_8h_source.html#l00020">torcrpcrequest.h:20</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_services_html_ae8444ae326f123a375ff798be6a121b3"><div class="ttname"><a href="../../d1/d54/class_torc_h_t_t_p_services.html#ae8444ae326f123a375ff798be6a121b3">TorcHTTPServices::GetVersion</a></div><div class="ttdeci">static QString GetVersion(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d1a/torchttpservices_8cpp_source.html#l00064">torchttpservices.cpp:64</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_aa83d3c746b0ea4ee16b037daee4828fe"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#aa83d3c746b0ea4ee16b037daee4828fe">TorcHTTPRequest::SetSecure</a></div><div class="ttdeci">void SetSecure(bool Secure)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00251">torchttprequest.cpp:251</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_aad9c4665e4bf1e7a32ca7955a879da11"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#aad9c4665e4bf1e7a32ca7955a879da11">TorcHTTPRequest::SetStatus</a></div><div class="ttdeci">void SetStatus(HTTPStatus Status)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00188">torchttprequest.cpp:188</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_1_1_status_html_ad40bdc4e02c701bb9b1781ca72367b12"><div class="ttname"><a href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">TorcHTTPServer::Status::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1b/torchttpserver_8h_source.html#l00036">torchttpserver.h:36</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_1_1_status_html"><div class="ttname"><a href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1b/torchttpserver_8h_source.html#l00031">torchttpserver.h:31</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_html_ac96d6052c5e361d6cfa04406ac64f7b2"><div class="ttname"><a href="../../db/dc7/class_torc_h_t_t_p_server.html#ac96d6052c5e361d6cfa04406ac64f7b2">TorcHTTPServer::PlatformName</a></div><div class="ttdeci">static QString PlatformName(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/torchttpserver_8cpp_source.html#l00246">torchttpserver.cpp:246</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_aa5a4b1c823eb77de82ea44c3912f931f"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#aa5a4b1c823eb77de82ea44c3912f931f">TorcHTTPService::GetProperty</a></div><div class="ttdeci">QVariant GetProperty(int Index)</div><div class="ttdoc">Get the value of a given property. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00829">torchttpservice.cpp:829</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_service_html_a193024836d5518d050445c68bb559f37"><div class="ttname"><a href="../../d6/d70/class_torc_h_t_t_p_service.html#a193024836d5518d050445c68bb559f37">TorcHTTPService::GetMethod</a></div><div class="ttdeci">QString GetMethod(int Index)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d77/torchttpservice_8cpp_source.html#l00817">torchttpservice.cpp:817</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a771d8450a6fc08a5697c6eba32c20962"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a771d8450a6fc08a5697c6eba32c20962">TorcWebSocketReader::InitiateClose</a></div><div class="ttdeci">void InitiateClose(CloseCode Close, const QString &amp;Reason)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00178">torcwebsocketreader.cpp:178</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_ae22e5823f7a45393d5d008d298935f19"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#ae22e5823f7a45393d5d008d298935f19">TorcWebSocket::ReadyRead</a></div><div class="ttdeci">void ReadyRead(void)</div><div class="ttdoc">Process incoming data. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00666">torcwebsocket.cpp:666</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a31e443b1967b3fd821d92e7d65de593daefb75807ee00696bfa83d0003fd9ec45"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a31e443b1967b3fd821d92e7d65de593daefb75807ee00696bfa83d0003fd9ec45">HTTPConnectionUpgrade</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00090">torchttprequest.h:90</a></div></div>
<div class="ttc" id="torchttpserver_8h_html"><div class="ttname"><a href="../../df/d1b/torchttpserver_8h.html">torchttpserver.h</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_a4311922f02204d218df8293b28210ff5"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#a4311922f02204d218df8293b28210ff5">TorcRPCRequest::SetReply</a></div><div class="ttdeci">void SetReply(const QVariant &amp;Reply)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00417">torcrpcrequest.cpp:417</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a07e0d4900c71f8c8ab1d6748773d91a1"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a07e0d4900c71f8c8ab1d6748773d91a1">TorcHTTPRequest::SetResponseType</a></div><div class="ttdeci">void SetResponseType(HTTPResponseType Type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00193">torchttprequest.cpp:193</a></div></div>
<div class="ttc" id="class_torc_web_socket_thread_html"><div class="ttname"><a href="../../d3/d5b/class_torc_web_socket_thread.html">TorcWebSocketThread</a></div><div class="ttdoc">Wraps a TorcQThread around a TorcWebsocket. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d9e/torcwebsocketthread_8h_source.html#l00010">torcwebsocketthread.h:10</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a29634dbeaf7d935ad4d596be7d47886c"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a29634dbeaf7d935ad4d596be7d47886c">TorcWebSocket::Error</a></div><div class="ttdeci">void Error(QAbstractSocket::SocketError)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00957">torcwebsocket.cpp:957</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_aa179cd3af30b547f9777573fc9121069"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#aa179cd3af30b547f9777573fc9121069">TorcWebSocketReader::Reset</a></div><div class="ttdeci">void Reset(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00152">torcwebsocketreader.cpp:152</a></div></div>
<div class="ttc" id="class_torc_local_context_html_a6b6b5cc4732fee612a1a5e3ebe2cfcf1"><div class="ttname"><a href="../../d7/d17/class_torc_local_context.html#a6b6b5cc4732fee612a1a5e3ebe2cfcf1">TorcLocalContext::GetStartTime</a></div><div class="ttdeci">qint64 GetStartTime(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00510">torclocalcontext.cpp:510</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_af654fd3766309d8cb444f3bdf97e02d0"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#af654fd3766309d8cb444f3bdf97e02d0">TorcHTTPRequest::GetHTTPProtocol</a></div><div class="ttdeci">HTTPProtocol GetHTTPProtocol(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00276">torchttprequest.cpp:276</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a01340bcc9cce6aa1d156bd0468c708fcae6ec39e387f642513e62edf9b5af7f93"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a01340bcc9cce6aa1d156bd0468c708fcae6ec39e387f642513e62edf9b5af7f93">HTTP_BadRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00072">torchttprequest.h:72</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_html_acd8ffa7ed1862bfdba35af63855a2a8d"><div class="ttname"><a href="../../db/dc7/class_torc_h_t_t_p_server.html#acd8ffa7ed1862bfdba35af63855a2a8d">TorcHTTPServer::ServerDescription</a></div><div class="ttdeci">static QString ServerDescription(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/torchttpserver_8cpp_source.html#l00800">torchttpserver.cpp:800</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a91bec1aa6e99dbc88741d0f8f8881343"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a91bec1aa6e99dbc88741d0f8f8881343">TorcWebSocketReader::FormatForSubProtocol</a></div><div class="ttdeci">static OpCode FormatForSubProtocol(WSSubProtocol Protocol)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00076">torcwebsocketreader.cpp:76</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_a78431899018db70ec4be51aaeba8bdf7a0fa0de831c702f7d65dde3ee573f5ef8"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#a78431899018db70ec4be51aaeba8bdf7a0fa0de831c702f7d65dde3ee573f5ef8">HTTPGet</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00027">torchttprequest.h:27</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a47efc5e08385a02a885b1b1673b71307"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a47efc5e08385a02a885b1b1673b71307">TorcWebSocket::~TorcWebSocket</a></div><div class="ttdeci">~TorcWebSocket()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00112">torcwebsocket.cpp:112</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a5c57ac25075e4c4de2e4435e3dc97a79"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a5c57ac25075e4c4de2e4435e3dc97a79">TorcHTTPRequest::GetHTTPType</a></div><div class="ttdeci">HTTPType GetHTTPType(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00266">torchttprequest.cpp:266</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_a1c19367a0f47c85d3f3445cc885c0609"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#a1c19367a0f47c85d3f3445cc885c0609">TorcRPCRequest::GetParent</a></div><div class="ttdeci">QObject * GetParent(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00437">torcrpcrequest.cpp:437</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a902950a3ad3401e3c7cadcc7dc58d66f"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a902950a3ad3401e3c7cadcc7dc58d66f">TorcWebSocket::TimedOut</a></div><div class="ttdeci">void TimedOut(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00966">torcwebsocket.cpp:966</a></div></div>
<div class="ttc" id="torchttprequest_8h_html_ad0f1d98da3f74ea990bd91362a200e49ae58e121513274f5874ade749d85ac0e4"><div class="ttname"><a href="../../df/dd7/torchttprequest_8h.html#ad0f1d98da3f74ea990bd91362a200e49ae58e121513274f5874ade749d85ac0e4">HTTPResponseNone</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd7/torchttprequest_8h_source.html#l00039">torchttprequest.h:39</a></div></div>
<div class="ttc" id="torclogging_8h_html_a73a147108bf0df6442820b82b022ef94"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a></div><div class="ttdeci">#define LOG(_MASK_, _LEVEL_, _FORMAT_,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df9/torclogging_8h_source.html#l00031">torclogging.h:31</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a214b329b02c694f61045e92761daba9b"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a214b329b02c694f61045e92761daba9b">TorcWebSocket::PropertyChanged</a></div><div class="ttdeci">void PropertyChanged(void)</div><div class="ttdoc">Receives notifications when a property for a subscribed service has changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00494">torcwebsocket.cpp:494</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a274e621fc583fc9170fafae0de1a9f97"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a274e621fc583fc9170fafae0de1a9f97">TorcWebSocket::RemoteRequest</a></div><div class="ttdeci">void RemoteRequest(TorcRPCRequest *Request)</div><div class="ttdoc">Initiate a Remote Procedure Call. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00527">torcwebsocket.cpp:527</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a18f310f62f3108bdf1b243420918657b"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a18f310f62f3108bdf1b243420918657b">TorcWebSocket::Start</a></div><div class="ttdeci">void Start(void)</div><div class="ttdoc">Initialise the websocket once its parent thread is ready. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/torcwebsocket_8cpp_source.html#l00427">torcwebsocket.cpp:427</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_aa6d7eb36c3c225a55510ef7b52c468ab"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#aa6d7eb36c3c225a55510ef7b52c468ab">TorcRPCRequest::AddParameter</a></div><div class="ttdeci">void AddParameter(const QString &amp;Name, const QVariant &amp;Value)</div><div class="ttdoc">Add Parameter and value to list of call parameters. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00402">torcrpcrequest.cpp:402</a></div></div>
<div class="ttc" id="class_torc_local_context_html_a6585544b1dd0f8ebb815ed3ad150a2cd"><div class="ttname"><a href="../../d7/d17/class_torc_local_context.html#a6585544b1dd0f8ebb815ed3ad150a2cd">TorcLocalContext::GetPriority</a></div><div class="ttdeci">int GetPriority(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00516">torclocalcontext.cpp:516</a></div></div>
<div class="ttc" id="class_torc_r_p_c_request_html_a865ef10756f640e86e9984a76904e307"><div class="ttname"><a href="../../db/dc6/class_torc_r_p_c_request.html#a865ef10756f640e86e9984a76904e307">TorcRPCRequest::SetID</a></div><div class="ttdeci">void SetID(int ID)</div><div class="ttdoc">Set the unique ID for this request. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/torcrpcrequest_8cpp_source.html#l00392">torcrpcrequest.cpp:392</a></div></div>
<div class="ttc" id="class_torc_web_socket_html_a915fa325ab6cbed6f8f368df66af4b59"><div class="ttname"><a href="../../d9/d0a/class_torc_web_socket.html#a915fa325ab6cbed6f8f368df66af4b59">TorcWebSocket::ConnectionEstablished</a></div><div class="ttdeci">void ConnectionEstablished(void)</div></div>
<div class="ttc" id="torcwebsocketreader_8h_html_ac3f30770c63b354f160d10355141b646"><div class="ttname"><a href="../../d7/d28/torcwebsocketreader_8h.html#ac3f30770c63b354f160d10355141b646">TORC_JSON_RPC</a></div><div class="ttdeci">#define TORC_JSON_RPC</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/torcwebsocketreader_8h_source.html#l00008">torcwebsocketreader.h:8</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_reader_html_a6f4f66a41347776b55a368459b179521"><div class="ttname"><a href="../../d2/d37/class_torc_h_t_t_p_reader.html#a6f4f66a41347776b55a368459b179521">TorcHTTPReader::Reset</a></div><div class="ttdeci">void Reset(void)</div><div class="ttdoc">Reset the read state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d21/torchttpreader_8cpp_source.html#l00071">torchttpreader.cpp:71</a></div></div>
<div class="ttc" id="class_torc_web_socket_reader_html_a4d9f6b63801e378c8b377503339405b7"><div class="ttname"><a href="../../d3/d9a/class_torc_web_socket_reader.html#a4d9f6b63801e378c8b377503339405b7">TorcWebSocketReader::CloseSent</a></div><div class="ttdeci">bool CloseSent(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1b/torcwebsocketreader_8cpp_source.html#l00162">torcwebsocketreader.cpp:162</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_request_html_a0592d4ecd8e75f34bc2b0eeb2c29d077"><div class="ttname"><a href="../../da/dfc/class_torc_h_t_t_p_request.html#a0592d4ecd8e75f34bc2b0eeb2c29d077">TorcHTTPRequest::Respond</a></div><div class="ttdeci">void Respond(QTcpSocket *Socket)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da3/torchttprequest_8cpp_source.html#l00311">torchttprequest.cpp:311</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 30 2018 15:27:59 for Torc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
