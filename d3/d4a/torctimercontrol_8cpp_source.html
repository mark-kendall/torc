<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Torc: torctimercontrol.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Torc
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_3d370fd2770cf63261b7ee5a69ee79d2.html">controls</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">torctimercontrol.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d3/d4a/torctimercontrol_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Class TorcTimerControl</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">* Copyright (C) Mark Kendall 2015-18</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">* This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">* it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">* the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">* (at your option) any later version.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">* This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">* but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">* GNU General Public License for more details.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">* You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">* along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// Qt</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;QLocale&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;QVariant&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// Torc</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/df9/torclogging_8h.html">torclogging.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/dbd/torclocalcontext_8h.html">torclocalcontext.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d13/torctimercontrol_8h.html">torctimercontrol.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="../../d3/d4a/torctimercontrol_8cpp.html#adf147f20a670260cad77e5b14bce99fc">   29</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> quint64 <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#adf147f20a670260cad77e5b14bce99fc">kThou</a>  = 1000;</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="../../d3/d4a/torctimercontrol_8cpp.html#a441a4dd4641b059bf54016b08e95b6ce">   30</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> quint64 <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a441a4dd4641b059bf54016b08e95b6ce">kSixty</a> = 60;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="../../d3/d4a/torctimercontrol_8cpp.html#a65091728bb3d84749180249574c7c5cb">   31</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> quint64 <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a65091728bb3d84749180249574c7c5cb">k24</a>    = 24;</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="../../d3/d4a/torctimercontrol_8cpp.html#a36af2530cb2d4961de0126db418c66d4">   32</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> quint64 <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a36af2530cb2d4961de0126db418c66d4">k7</a>     = 7;</div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="../../d3/d4a/torctimercontrol_8cpp.html#a05efa1bb2d5592d9b48c4275aab7a2f8">   33</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> quint64 <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a05efa1bb2d5592d9b48c4275aab7a2f8">kMSecsInMinute</a> = <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a441a4dd4641b059bf54016b08e95b6ce">kSixty</a> * <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#adf147f20a670260cad77e5b14bce99fc">kThou</a>;</div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="../../d3/d4a/torctimercontrol_8cpp.html#a5e11f16c73f15a11b5d04326a57518f6">   34</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> quint64 <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a5e11f16c73f15a11b5d04326a57518f6">kMSecsInHour</a>   = <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a05efa1bb2d5592d9b48c4275aab7a2f8">kMSecsInMinute</a> * <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a441a4dd4641b059bf54016b08e95b6ce">kSixty</a>;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">   35</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> quint64 <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">kMSecsInDay</a>    = <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a5e11f16c73f15a11b5d04326a57518f6">kMSecsInHour</a> * <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a65091728bb3d84749180249574c7c5cb">k24</a>;</div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="../../d3/d4a/torctimercontrol_8cpp.html#a9d6085f2fc2a6e210e945168162dc6e2">   36</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> quint64 <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a9d6085f2fc2a6e210e945168162dc6e2">kMSecsinWeek</a>   = <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">kMSecsInDay</a> * <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a36af2530cb2d4961de0126db418c66d4">k7</a>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#a52315d3a961d9a55e961beb05aae94ef">   38</a></span>&#160;QString <a class="code" href="../../d6/d72/class_torc_timer_control.html#a52315d3a961d9a55e961beb05aae94ef">TorcTimerControl::TimerTypeToString</a>(<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371">TorcTimerControl::TimerType</a> <a class="code" href="../../d1/d34/class_torc_control.html#a9674689dc841799e823c26856123a8b0">Type</a>)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">switch</span> (Type)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a679ffd6156c5b06ae4fc0ee0d366617b">TorcTimerControl::Custom</a>:   <span class="keywordflow">return</span> QString(<span class="stringliteral">&quot;Custom&quot;</span>);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a2212749610b32f00e4e9cd88ef61d1ce">TorcTimerControl::Minutely</a>: <span class="keywordflow">return</span> QString(<span class="stringliteral">&quot;Minute&quot;</span>);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a783408861d26e3ec64d923a6c5986321">TorcTimerControl::Hourly</a>:   <span class="keywordflow">return</span> QString(<span class="stringliteral">&quot;Hourly&quot;</span>);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371aff959ce6b9dd5419e67ada2f5ee0c378">TorcTimerControl::Daily</a>:    <span class="keywordflow">return</span> QString(<span class="stringliteral">&quot;Daily&quot;</span>);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a903d4f24365683f748a9fb669c567f70">TorcTimerControl::Weekly</a>:   <span class="keywordflow">return</span> QString(<span class="stringliteral">&quot;Weekly&quot;</span>);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    }</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">return</span> QString(<span class="stringliteral">&quot;Unknown&quot;</span>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#a1fe778f5263991533237d64ce9bc240f">   53</a></span>&#160;<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371">TorcTimerControl::TimerType</a> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a1fe778f5263991533237d64ce9bc240f">TorcTimerControl::StringToTimerType</a>(<span class="keyword">const</span> QString &amp;<a class="code" href="../../d1/d34/class_torc_control.html#a9674689dc841799e823c26856123a8b0">Type</a>)</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    QString type = Type.trimmed().toUpper();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (<span class="stringliteral">&quot;CUSTOM&quot;</span>   == type) <span class="keywordflow">return</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a679ffd6156c5b06ae4fc0ee0d366617b">TorcTimerControl::Custom</a>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordflow">if</span> (<span class="stringliteral">&quot;MINUTELY&quot;</span> == type) <span class="keywordflow">return</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a2212749610b32f00e4e9cd88ef61d1ce">TorcTimerControl::Minutely</a>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">if</span> (<span class="stringliteral">&quot;HOURLY&quot;</span>   == type) <span class="keywordflow">return</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a783408861d26e3ec64d923a6c5986321">TorcTimerControl::Hourly</a>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> (<span class="stringliteral">&quot;DAILY&quot;</span>    == type) <span class="keywordflow">return</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371aff959ce6b9dd5419e67ada2f5ee0c378">TorcTimerControl::Daily</a>;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">if</span> (<span class="stringliteral">&quot;WEEKLY&quot;</span>   == type) <span class="keywordflow">return</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a903d4f24365683f748a9fb669c567f70">TorcTimerControl::Weekly</a>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371ac37ab8c1473981f07be7fe9778d80a9c">TorcTimerControl::UnknownTimerType</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#af41592c440babced7078bb00aaaecff8">   66</a></span>&#160;<a class="code" href="../../d6/d72/class_torc_timer_control.html#af41592c440babced7078bb00aaaecff8">TorcTimerControl::TorcTimerControl</a>(<span class="keyword">const</span> QString &amp;<a class="code" href="../../d1/d34/class_torc_control.html#a9674689dc841799e823c26856123a8b0">Type</a>, <span class="keyword">const</span> QVariantMap &amp;Details)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  : <a class="code" href="../../d1/d34/class_torc_control.html">TorcControl</a>(<a class="code" href="../../d1/d34/class_torc_control.html">TorcControl</a>::<a class="code" href="../../d1/d34/class_torc_control.html#a9674689dc841799e823c26856123a8b0a068b32323878afb25f83ee6edc15ea2e">Timer</a>, Details),</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    m_timerType(<a class="code" href="../../d6/d72/class_torc_timer_control.html#a1fe778f5263991533237d64ce9bc240f">StringToTimerType</a>(Type)),</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    m_startDay(0),</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    m_startTime(0),</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    m_duration(0),</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    m_durationDay(0),</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    m_periodDay(0),</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    m_periodTime(0),</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    m_timer(),</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    m_firstTrigger(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a6bb428c1ccb88c717bfa26f1fcc7c33e">true</a>),</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    m_randomStart(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    m_randomDuration(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    m_lastElapsed(0),</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    m_newRandom(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;{</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> randomcheck = <span class="keyword">true</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (randomcheck)</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        randomcheck = <span class="keyword">false</span>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">if</span> (RAND_MAX &lt; <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a9d6085f2fc2a6e210e945168162dc6e2">kMSecsinWeek</a>)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;Maximum random number is too low for effective use (%1)&quot;</span>).arg(RAND_MAX));</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span> (m_timerType == <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371ac37ab8c1473981f07be7fe9778d80a9c">TorcTimerControl::UnknownTimerType</a>)</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Unknown timer type &#39;%1&#39; for device &#39;%2&#39;&quot;</span>).arg(Details.value(<span class="stringliteral">&quot;type&quot;</span>).toString()).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>));</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordtype">int</span> days, hours, minutes, seconds = 0;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// a custom timer needs a period</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a679ffd6156c5b06ae4fc0ee0d366617b">TorcTimerControl::Custom</a> == m_timerType)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">if</span> (!Details.contains(<span class="stringliteral">&quot;period&quot;</span>))</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Custom timer %1 does not specify a period&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>));</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        QString periods = Details.value(<span class="stringliteral">&quot;period&quot;</span>).toString().toLower().trimmed();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        quint64 periodtime;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d34/class_torc_control.html#ad4713e8e70134bc9a86f1da32ff57fee">TorcControl::ParseTimeString</a>(periods, days, hours, minutes, seconds, periodtime))</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Failed to parse period from &#39;%1&#39;&quot;</span>).arg(periods));</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        m_periodDay  = days;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        m_periodTime = periodtime * 1000;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// the period must be at least 2 seconds to allow for defined on and off periods</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span> (m_periodTime &lt; 2000)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Custom timer %1 has duration of %2seconds - needs at least 2&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>).arg(m_periodTime / 1000));</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        m_periodTime = GetPeriodDuration();</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        m_periodDay  = m_periodTime / <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">kMSecsInDay</a>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// Sanity checks start time and duration</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// constraints:</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// - we need a defined off and on period</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// - the on period can be anywhere in the cycle (start, middle, end)</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// - the current on period must finish before the next is due to start</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// - so:</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">//   - start &gt;= 0</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">//   - start &lt; max</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">//   - duration &gt; 0</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">//   - duration &lt; max</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// - should cover all eventualities...</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// check for start time</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span> (!Details.contains(<span class="stringliteral">&quot;start&quot;</span>))</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Timer &#39;%1&#39; does not specify start time&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>));</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// a random start time</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    QString start  = Details.value(<span class="stringliteral">&quot;start&quot;</span>).toString().toLower().trimmed();</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">if</span> (start.contains(<span class="stringliteral">&quot;random&quot;</span>))</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        m_randomStart = <span class="keyword">true</span>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">// start time must be in the format DD:HH:MM or HH:MM or MM with an optional .SS appended</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        quint64 starttime;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d34/class_torc_control.html#ad4713e8e70134bc9a86f1da32ff57fee">TorcControl::ParseTimeString</a>(start, days, hours, minutes, seconds, starttime))</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Failed to parse start time from &#39;%1&#39;&quot;</span>).arg(start));</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        m_startDay  = days;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        m_startTime = starttime * 1000;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">if</span> (m_startTime &gt;= m_periodTime <span class="comment">/*|| m_startTime &lt; 0*/</span>)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Start time (%2) for %1 is invalid - must be in range 0-%3&quot;</span>)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                .arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>).arg(m_startTime / 1000).arg((m_periodTime / 1000) - 1));</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">// check duration - format as for start time</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span> (!Details.contains(<span class="stringliteral">&quot;duration&quot;</span>))</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Timer &#39;%1&#39; does not specify duration&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>));</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    QString durations = Details.value(<span class="stringliteral">&quot;duration&quot;</span>).toString().toLower().trimmed();</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">if</span> (durations.contains(<span class="stringliteral">&quot;random&quot;</span>))</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// a timer cannot have random start and duration</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> (m_randomStart)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Timer %1 cannot have random start AND duration&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>));</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        m_randomDuration = <span class="keyword">true</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        quint64 duration;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d34/class_torc_control.html#ad4713e8e70134bc9a86f1da32ff57fee">TorcControl::ParseTimeString</a>(durations, days, hours, minutes, seconds, duration))</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Failed to parse duration from &#39;%1&#39;&quot;</span>).arg(durations));</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        m_duration    = duration * 1000;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        m_durationDay = days;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">if</span> ((m_duration &lt; 1000) || (m_duration &gt;= m_periodTime))</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Duration (%1) for %2 is invalid - must be in range 1-%3&quot;</span>)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                .arg(m_duration / 1000).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>).arg((m_periodTime / 1000) - 1));</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// generate random start/duration if necessary</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    GenerateTimings();</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// everything appears to be valid at this stage</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="../../d1/d34/class_torc_control.html#ab1b456fdcac8ad1d9d7225eff0927561">m_parsed</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d8/d49/class_torc_observable.html#a171edc659834e25af5862f84e514b215">AddObserver</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#ab17287e8a8ca12d2540494e782bdb54d">  224</a></span>&#160;<a class="code" href="../../d6/d72/class_torc_timer_control.html#ab17287e8a8ca12d2540494e782bdb54d">TorcTimerControl::~TorcTimerControl</a>()</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;{</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d8/d49/class_torc_observable.html#afefd31617891afe709c8dc9d62368d5c">RemoveObserver</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;}</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#a8c3859eb34b61d8ca9def7b4e6dc3358">  229</a></span>&#160;<a class="code" href="../../d1/d34/class_torc_control.html#a9674689dc841799e823c26856123a8b0">TorcControl::Type</a> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a8c3859eb34b61d8ca9def7b4e6dc3358">TorcTimerControl::GetType</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d1/d34/class_torc_control.html#a9674689dc841799e823c26856123a8b0a068b32323878afb25f83ee6edc15ea2e">TorcControl::Timer</a>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#a9ecf2345898bf931f204e20593f29f6d">  234</a></span>&#160;QStringList <a class="code" href="../../d6/d72/class_torc_timer_control.html#a9ecf2345898bf931f204e20593f29f6d">TorcTimerControl::GetDescription</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;{</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    QStringList result;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    result.append(<a class="code" href="../../d6/d72/class_torc_timer_control.html#a52315d3a961d9a55e961beb05aae94ef">TimerTypeToString</a>(m_timerType));</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    result.append(tr(<span class="stringliteral">&quot;Period&quot;</span>) + <span class="stringliteral">&quot;: &quot;</span> + <a class="code" href="../../d1/d34/class_torc_control.html#a99aeedbcd80ce345c2427abf5dc2bc45">TorcControl::DurationToString</a>(m_periodDay, m_periodTime / 1000));</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    result.append(tr(<span class="stringliteral">&quot;Start&quot;</span>) + <span class="stringliteral">&quot;: &quot;</span> + (m_randomStart    ? tr(<span class="stringliteral">&quot;Random&quot;</span>) : <a class="code" href="../../d1/d34/class_torc_control.html#a99aeedbcd80ce345c2427abf5dc2bc45">TorcControl::DurationToString</a>(m_startDay, m_startTime / 1000)));</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    result.append(tr(<span class="stringliteral">&quot;Duration&quot;</span>) + <span class="stringliteral">&quot;: &quot;</span> + (m_randomDuration ? tr(<span class="stringliteral">&quot;Random&quot;</span>) : <a class="code" href="../../d1/d34/class_torc_control.html#a99aeedbcd80ce345c2427abf5dc2bc45">TorcControl::DurationToString</a>(m_durationDay, m_duration / 1000)));</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#a42f78bbfd061d6d5ea16b738d80409d7">  245</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a42f78bbfd061d6d5ea16b738d80409d7">TorcTimerControl::Validate</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;{</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    QMutexLocker locker(&amp;<a class="code" href="../../d5/d76/class_torc_device.html#a9d63017b24e1a69ad8ad51f09004289c">lock</a>);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">// don&#39;t repeat validation</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d34/class_torc_control.html#a2bee84dccdf821c4b51fab8ca7827301">m_validated</a>)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// common checks</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d34/class_torc_control.html#aecfb5aaa993892b6ac64f1299ffed8c9">TorcControl::Validate</a>())</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// a timer has no inputs</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d34/class_torc_control.html#a3e211eb2fc314791f517f2465a2f23d4">m_inputs</a>.isEmpty())</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Timer device &#39;%1&#39; cannot have inputs&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>));</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// need at least one output</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d34/class_torc_control.html#aad689569fd6a26c35df0f22b56f8f374">m_outputs</a>.isEmpty())</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Timer device &#39;%1&#39; needs at least one output&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>));</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// if we get this far, we can finish the device</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d34/class_torc_control.html#a6e70a8ee3b449f7a5fd61213a5645537">Finish</a>())</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// debug</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;Timer &#39;%1&#39;: %2&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>).arg(<a class="code" href="../../d6/d72/class_torc_timer_control.html#a9ecf2345898bf931f204e20593f29f6d">GetDescription</a>().join(<span class="stringliteral">&quot;,&quot;</span>)));</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    m_timer.setTimerType(Qt::PreciseTimer);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// connect the timer</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    connect(&amp;m_timer, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d6/d72/class_torc_timer_control.html#ad5c4ce3e8a18dae01b419f149aaa87ff">TimerTimeout</a>()));</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// all timers are single shot and reset at each trigger</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    m_timer.setSingleShot(<span class="keyword">true</span>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#af880678a6375212d468f1931d0a8e11c">  294</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#af880678a6375212d468f1931d0a8e11c">TorcTimerControl::Start</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;{</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    QMutexLocker locker(&amp;<a class="code" href="../../d5/d76/class_torc_device.html#a9d63017b24e1a69ad8ad51f09004289c">lock</a>);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d34/class_torc_control.html#ab1b456fdcac8ad1d9d7225eff0927561">m_parsed</a> || !<a class="code" href="../../d1/d34/class_torc_control.html#a2bee84dccdf821c4b51fab8ca7827301">m_validated</a>)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// trigger the timer for the next state change</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="../../d6/d72/class_torc_timer_control.html#ad5c4ce3e8a18dae01b419f149aaa87ff">TimerTimeout</a>();</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// ensure state is communicated</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="../../d1/d34/class_torc_control.html#a6d30a9f3ff8903dc6a4b4528fc4a1e14">SetValid</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    emit <a class="code" href="../../d5/d76/class_torc_device.html#a7695c5ac7cb395fbeb633dcbe67350b1">ValueChanged</a>(<a class="code" href="../../d5/d76/class_torc_device.html#ae077bff2755060265238ed6a3a47c5eb">value</a>);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#ad9ea9e11613335e46e6c73905d669ce4">  310</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#ad9ea9e11613335e46e6c73905d669ce4">TorcTimerControl::AllowInputs</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#a896ba108b8a34f6a0f1fa9200a75b182">  315</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a896ba108b8a34f6a0f1fa9200a75b182">TorcTimerControl::event</a>(QEvent *Event)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;{</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (Event &amp;&amp; Event-&gt;type() == <a class="code" href="../../d6/d78/class_torc_event.html#a3cae355e5cf80619e4370890e82d2a84">TorcEvent::TorcEventType</a>)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a> *<span class="keyword">event</span> = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a>*<span class="keyword">&gt;</span>(Event);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/d72/class_torc_timer_control.html#a896ba108b8a34f6a0f1fa9200a75b182">event</a> &amp;&amp; (<a class="code" href="../../d6/d72/class_torc_timer_control.html#a896ba108b8a34f6a0f1fa9200a75b182">event</a>-&gt;GetEvent() == <a class="code" href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473a05b4f2a87d2fcb673c6e496556366df3">Torc::SystemTimeChanged</a>))</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Timer %1 restarting&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>));</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            m_timer.stop();</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            m_firstTrigger = <span class="keyword">true</span>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <a class="code" href="../../d6/d72/class_torc_timer_control.html#ad5c4ce3e8a18dae01b419f149aaa87ff">TimerTimeout</a>();</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">return</span> TorcControl::event(Event);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;}</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#ad5c4ce3e8a18dae01b419f149aaa87ff">  333</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#ad5c4ce3e8a18dae01b419f149aaa87ff">TorcTimerControl::TimerTimeout</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    QMutexLocker locker(&amp;<a class="code" href="../../d5/d76/class_torc_device.html#a9d63017b24e1a69ad8ad51f09004289c">lock</a>);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keywordtype">bool</span> first = m_firstTrigger;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    m_firstTrigger = <span class="keyword">false</span>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">switch</span> (m_timerType)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a679ffd6156c5b06ae4fc0ee0d366617b">TorcTimerControl::Custom</a>:</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a2212749610b32f00e4e9cd88ef61d1ce">TorcTimerControl::Minutely</a>:</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a783408861d26e3ec64d923a6c5986321">TorcTimerControl::Hourly</a>:</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371aff959ce6b9dd5419e67ada2f5ee0c378">TorcTimerControl::Daily</a>:</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a903d4f24365683f748a9fb669c567f70">TorcTimerControl::Weekly</a>:</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="comment">// we need to establish the current time, the current state</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="comment">// and when the next trigger is needed.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="comment">// A timer that does not cross a period boundary has a pattern of</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="comment">// off/on, off/on/off or on/off. &#39;_-&#39; &#39;_-_&#39; &#39;-_&#39;</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="comment">// A timer that DOES cross a boundary will have a pattern of</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <span class="comment">// off/on/boundary/on/off &#39;_-|-_&#39; for its total cycle but within</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="comment">// the period it looks like &#39;-_-&#39; for the two overlapping sequences</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="comment">// so we have 4 total combinations to handle...</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                quint64 msecsinceperiodstart = MsecsSincePeriodStart();</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                quint64 finishtime   = m_startTime + m_duration;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="keywordtype">bool</span>    newrandom    = <span class="keyword">false</span>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordtype">bool</span>    newvalue     = <span class="keyword">false</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                quint64 nexttimer    = 0;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="comment">// start is zero</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                <span class="comment">// on/off -_</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                <span class="keywordflow">if</span> (m_startTime == 0)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                    newvalue  = msecsinceperiodstart &lt;= m_duration;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                    nexttimer = newvalue ? m_duration - msecsinceperiodstart : m_periodTime - msecsinceperiodstart;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                    newrandom = <a class="code" href="../../d5/d76/class_torc_device.html#ae077bff2755060265238ed6a3a47c5eb">value</a> &lt; 1.0 &amp;&amp; newvalue; <span class="comment">// transitioning from low to high</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                }</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <span class="comment">// start + duration &lt; max</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                <span class="comment">// off/on/off _-_</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (finishtime &lt; m_periodTime)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    <span class="keywordflow">if</span> (msecsinceperiodstart &lt; m_startTime)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                        newvalue  = <span class="keyword">false</span>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                        nexttimer = m_startTime - msecsinceperiodstart;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msecsinceperiodstart &gt; finishtime)</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                        newvalue  = <span class="keyword">false</span>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        nexttimer = m_periodTime - msecsinceperiodstart;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                    {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        <span class="comment">// m_startTime &lt;= timesinceperiodstart &lt;= finishtime</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                        newvalue  = <span class="keyword">true</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                        nexttimer = finishtime - msecsinceperiodstart;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                    }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    <span class="keywordflow">if</span> (!newvalue &amp;&amp; (<a class="code" href="../../d5/d76/class_torc_device.html#ae077bff2755060265238ed6a3a47c5eb">value</a> &lt; 1.0) &amp;&amp; (m_lastElapsed &gt; msecsinceperiodstart)) <span class="comment">// end of period boundary</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                        newrandom = <span class="keyword">true</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="comment">// start + duration = max</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                <span class="comment">// off/on _-</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (finishtime == m_periodTime)</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                    newvalue  = msecsinceperiodstart &gt;= m_startTime;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    nexttimer = newvalue ? m_periodTime - msecsinceperiodstart : m_startTime - msecsinceperiodstart;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    newrandom = <a class="code" href="../../d5/d76/class_torc_device.html#ae077bff2755060265238ed6a3a47c5eb">value</a> &gt; 0.0 &amp;&amp; !newvalue; <span class="comment">// transitioning from high to low</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                }</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <span class="comment">// on/off/on -_-</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (finishtime &gt; m_periodTime)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    <span class="comment">// a random timer should never hit this condition as it becomes too involved</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    <span class="comment">// trying to trigger the correct timeouts</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                    <span class="keywordflow">if</span> (m_randomDuration || m_randomStart)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Invalid condition for random timer - disabling&quot;</span>);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                    }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    quint64 firststart = finishtime - m_periodTime;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    <span class="keywordflow">if</span> (msecsinceperiodstart &lt;= firststart)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                    {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        newvalue  = <span class="keyword">true</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        nexttimer = firststart - msecsinceperiodstart;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                    }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msecsinceperiodstart &gt;= m_startTime)</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                    {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        newvalue  = <span class="keyword">true</span>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                        nexttimer = m_periodTime - msecsinceperiodstart;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                    }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                    <span class="keywordflow">else</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                    {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                        newvalue  = <span class="keyword">false</span>;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                        nexttimer = m_startTime - msecsinceperiodstart;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                <span class="keywordflow">if</span> (first &amp;&amp; newvalue)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Triggering timer &#39;%1&#39; late - will run for %2seconds instead of %3 %4&quot;</span>)</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                        .arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>).arg(nexttimer/1000.0).arg(m_duration/1000).arg(QDateTime::currentDateTime().toString(<span class="stringliteral">&quot;HH:mm:ss.zzz&quot;</span>)));</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                m_lastElapsed = msecsinceperiodstart;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                <span class="comment">// the end of the &#39;random&#39; sequence. Calculate next sequence and then</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <span class="comment">// recalculate next timeout. Don&#39;t set the value as it may momentarily be set to the incorrect value.</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                <span class="comment">// m_newRandom prevents a potential infinite loop as a new random start/duration may immediately</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <span class="comment">// trigger another. Don&#39;t reset random on first trigger - it has only just been set!</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="keywordflow">if</span> (!first &amp;&amp; newrandom &amp;&amp; !m_newRandom &amp;&amp; (m_randomDuration || m_randomStart))</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    m_newRandom = <span class="keyword">true</span>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    GenerateTimings();</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                    <a class="code" href="../../d6/d72/class_torc_timer_control.html#ad5c4ce3e8a18dae01b419f149aaa87ff">TimerTimeout</a>();</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                m_newRandom = <span class="keyword">false</span>;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                <span class="comment">// trigger timer a little early to hone in and give sub-second accuracy</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                quint64 adjust = nexttimer / 10;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <span class="keywordflow">if</span> (nexttimer &gt; 100)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                    nexttimer -= adjust;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <span class="comment">// avoid lengthy timers - max 1 hour</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="keywordflow">if</span> (nexttimer &gt; <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a5e11f16c73f15a11b5d04326a57518f6">kMSecsInHour</a>)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    nexttimer = <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a5e11f16c73f15a11b5d04326a57518f6">kMSecsInHour</a>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <a class="code" href="../../d1/d34/class_torc_control.html#aacd131384c523cf16c54ab906d41329c">SetValue</a>(newvalue);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                m_timer.start(nexttimer);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// should be unreachable</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Unknown timer state - SERIOUS ERROR&quot;</span>);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;}</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#a048085fd2523320c8ab1f9add1b10c39">  477</a></span>&#160;<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371">TorcTimerControl::TimerType</a> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a048085fd2523320c8ab1f9add1b10c39">TorcTimerControl::GetTimerType</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span> m_timerType;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno"><a class="line" href="../../d6/d72/class_torc_timer_control.html#a3cad10239debf2ff664c667e69f1c996">  482</a></span>&#160;quint64 <a class="code" href="../../d6/d72/class_torc_timer_control.html#a3cad10239debf2ff664c667e69f1c996">TorcTimerControl::TimeSinceLastTransition</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;{</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    QMutexLocker locker(&amp;<a class="code" href="../../d5/d76/class_torc_device.html#a9d63017b24e1a69ad8ad51f09004289c">lock</a>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">// Custom timers don&#39;t have a defined start time</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a679ffd6156c5b06ae4fc0ee0d366617b">TorcTimerControl::Custom</a> == m_timerType ||</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371ac37ab8c1473981f07be7fe9778d80a9c">TorcTimerControl::UnknownTimerType</a> == m_timerType)</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    quint64 msecsinceperiodstart = MsecsSincePeriodStart();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    quint64 finishtime   = m_startTime + m_duration;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    quint64 lasttimer    = 0;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// N.B. There can only ever be two &#39;reference&#39; transitions - the last low to high</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">//      and the last high to low. A boundary is NOT a transition (unless coincidental).</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="comment">// start is zero</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// on/off -_</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> (m_startTime == 0)</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        lasttimer = (msecsinceperiodstart &lt;= m_duration) ? msecsinceperiodstart : msecsinceperiodstart - m_duration;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// start + duration &lt; max</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">// off/on/off _-_</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (finishtime &lt; m_periodTime)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">if</span> (msecsinceperiodstart &lt; m_startTime)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            lasttimer = msecsinceperiodstart + (m_periodTime - finishtime);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msecsinceperiodstart &gt; finishtime)</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            lasttimer = msecsinceperiodstart - finishtime;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            lasttimer = msecsinceperiodstart - m_startTime;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">// start + duration = max</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">// off/on _-</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (finishtime == m_periodTime)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    {</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        lasttimer = (msecsinceperiodstart &gt;= m_startTime) ? msecsinceperiodstart - m_startTime : msecsinceperiodstart;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">// on/off/on -_-</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (finishtime &gt; m_periodTime)</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        quint64 firststart = finishtime - m_periodTime;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">if</span> (msecsinceperiodstart &lt;= firststart)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            lasttimer = msecsinceperiodstart + (m_periodTime - m_startTime);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msecsinceperiodstart &gt;= m_startTime)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            lasttimer = msecsinceperiodstart - m_startTime;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            lasttimer = msecsinceperiodstart - firststart;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    }</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordflow">return</span> lasttimer;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;}</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;quint64 TorcTimerControl::MsecsSincePeriodStart(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;{</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    QTime timenow = QTime::currentTime();</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordtype">int</span>       day = QDate::currentDate().dayOfWeek() - 1;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a679ffd6156c5b06ae4fc0ee0d366617b">TorcTimerControl::Custom</a> == m_timerType)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment">// always use the same reference Date/Time to ensure long duration custom timers start consistently</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="comment">// and to prevent drift</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> QDateTime reference = QDateTime::fromString(<span class="stringliteral">&quot;2000-01-01T00:00:00&quot;</span>, Qt::ISODate);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">if</span> (m_periodTime &gt; 0)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">return</span> (QDateTime::currentMSecsSinceEpoch() - reference.toMSecsSinceEpoch()) % m_periodTime;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">// clip hours for Hourly</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a783408861d26e3ec64d923a6c5986321">TorcTimerControl::Hourly</a> == m_timerType)</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        timenow = QTime(0, timenow.minute(), timenow.second(), timenow.msec());</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">// clip hours and minutes for minutely</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a2212749610b32f00e4e9cd88ef61d1ce">TorcTimerControl::Minutely</a> == m_timerType)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        timenow = QTime(0, 0, timenow.second(), timenow.msec());</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    quint64 msecsinceperiodstart = timenow.msecsSinceStartOfDay();</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// add days for Weekly</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a903d4f24365683f748a9fb669c567f70">TorcTimerControl::Weekly</a> == m_timerType)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        msecsinceperiodstart += day * <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">kMSecsInDay</a>;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">return</span> msecsinceperiodstart;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;quint64 TorcTimerControl::GetPeriodDuration(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">switch</span> (m_timerType)</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    {</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a2212749610b32f00e4e9cd88ef61d1ce">TorcTimerControl::Minutely</a>: <span class="keywordflow">return</span> <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a05efa1bb2d5592d9b48c4275aab7a2f8">kMSecsInMinute</a>;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a783408861d26e3ec64d923a6c5986321">TorcTimerControl::Hourly</a>:   <span class="keywordflow">return</span> <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a5e11f16c73f15a11b5d04326a57518f6">kMSecsInHour</a>;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371aff959ce6b9dd5419e67ada2f5ee0c378">TorcTimerControl::Daily</a>:    <span class="keywordflow">return</span> <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">kMSecsInDay</a>;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a903d4f24365683f748a9fb669c567f70">TorcTimerControl::Weekly</a>:   <span class="keywordflow">return</span> <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a9d6085f2fc2a6e210e945168162dc6e2">kMSecsinWeek</a>;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;}</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keywordtype">void</span> TorcTimerControl::GenerateTimings(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;{</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">// start or duration are limited in range as we must keep the cycle within the period</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">if</span> (m_randomDuration)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="comment">// for a 60 second timer, we need duration between 1 and 59 - a range of 58</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="comment">// start is already 0-59 - a range of 59...</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="comment">// if we clip the result, we lose the random distribution</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="comment">// so we need to scale down the start time to restrict the range</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="comment">// which means we need to operate to ms accuracy and round down</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        quint64 start = (quint64)((<span class="keywordtype">double</span>)m_startTime * ((double)(m_periodTime - 1000) / (double)m_periodTime));</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        quint64 mod   = (m_periodTime / 1000) - (start / 1000); <span class="comment">// range 2&lt;-&gt;period</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                mod  -= 1; <span class="comment">// range 1&lt;-&gt;(period-1)</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        m_duration    = (qrand() % mod); <span class="comment">// range 0&lt;-&gt;period-2</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        m_duration   += 1; <span class="comment">// range 1&lt;-&gt;period-1</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        m_duration   *= 1000;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        m_durationDay = m_duration / <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">kMSecsInDay</a>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;Timer %1 - new random duration %2&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>).arg(<a class="code" href="../../d1/d34/class_torc_control.html#a99aeedbcd80ce345c2427abf5dc2bc45">DurationToString</a>(m_durationDay, m_duration / 1000)));</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_randomStart)</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        quint64 mod = (m_periodTime / 1000) - (m_duration / 1000) + 1; <span class="comment">// range 2&lt;-&gt;period</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        m_startTime = qrand() % (mod); <span class="comment">// range 0&lt;-&gt;period-1</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        m_startTime *= 1000;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        m_startDay = m_startTime / <a class="code" href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">kMSecsInDay</a>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_DEBUG, QString(<span class="stringliteral">&quot;Timer %1 - new random start %2&quot;</span>).arg(<a class="code" href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">uniqueId</a>).arg(<a class="code" href="../../d1/d34/class_torc_control.html#a99aeedbcd80ce345c2427abf5dc2bc45">DurationToString</a>(m_startDay, m_startTime / 1000)));</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordtype">void</span> TorcTimerControl::CalculateOutput(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;{</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;}</div><div class="ttc" id="class_torc_timer_control_html_a52315d3a961d9a55e961beb05aae94ef"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a52315d3a961d9a55e961beb05aae94ef">TorcTimerControl::TimerTypeToString</a></div><div class="ttdeci">static QString TimerTypeToString(TorcTimerControl::TimerType Type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00038">torctimercontrol.cpp:38</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a1fe778f5263991533237d64ce9bc240f"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a1fe778f5263991533237d64ce9bc240f">TorcTimerControl::StringToTimerType</a></div><div class="ttdeci">static TorcTimerControl::TimerType StringToTimerType(const QString &amp;Type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00053">torctimercontrol.cpp:53</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_ab17287e8a8ca12d2540494e782bdb54d"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#ab17287e8a8ca12d2540494e782bdb54d">TorcTimerControl::~TorcTimerControl</a></div><div class="ttdeci">~TorcTimerControl()</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00224">torctimercontrol.cpp:224</a></div></div>
<div class="ttc" id="class_torc_control_html_ad4713e8e70134bc9a86f1da32ff57fee"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#ad4713e8e70134bc9a86f1da32ff57fee">TorcControl::ParseTimeString</a></div><div class="ttdeci">static bool ParseTimeString(const QString &amp;Time, int &amp;Days, int &amp;Hours, int &amp;Minutes, int &amp;Seconds, quint64 &amp;DurationInSeconds)</div><div class="ttdoc">Parse a Torc time string into days, hours, minutes and, if present, seconds. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/torccontrol_8cpp_source.html#l00059">torccontrol.cpp:59</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_ad9ea9e11613335e46e6c73905d669ce4"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#ad9ea9e11613335e46e6c73905d669ce4">TorcTimerControl::AllowInputs</a></div><div class="ttdeci">bool AllowInputs(void) const override</div><div class="ttdoc">Timers cannot have inputs. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00310">torctimercontrol.cpp:310</a></div></div>
<div class="ttc" id="class_torc_device_html_a7695c5ac7cb395fbeb633dcbe67350b1"><div class="ttname"><a href="../../d5/d76/class_torc_device.html#a7695c5ac7cb395fbeb633dcbe67350b1">TorcDevice::ValueChanged</a></div><div class="ttdeci">void ValueChanged(double Value)</div></div>
<div class="ttc" id="torclocalcontext_8cpp_html_a071080a60a9799e8b9609cb8898ef14f"><div class="ttname"><a href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a></div><div class="ttdeci">TorcLocalContext * gLocalContext</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00047">torclocalcontext.cpp:47</a></div></div>
<div class="ttc" id="class_torc_control_html_aecfb5aaa993892b6ac64f1299ffed8c9"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#aecfb5aaa993892b6ac64f1299ffed8c9">TorcControl::Validate</a></div><div class="ttdeci">virtual bool Validate(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/torccontrol_8cpp_source.html#l00229">torccontrol.cpp:229</a></div></div>
<div class="ttc" id="torctimercontrol_8cpp_html_a65091728bb3d84749180249574c7c5cb"><div class="ttname"><a href="../../d3/d4a/torctimercontrol_8cpp.html#a65091728bb3d84749180249574c7c5cb">k24</a></div><div class="ttdeci">static const quint64 k24</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00031">torctimercontrol.cpp:31</a></div></div>
<div class="ttc" id="class_torc_device_html_a1b7a04bc441a57c039dda6a5d8c7b7c3"><div class="ttname"><a href="../../d5/d76/class_torc_device.html#a1b7a04bc441a57c039dda6a5d8c7b7c3">TorcDevice::uniqueId</a></div><div class="ttdeci">QString uniqueId</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/df7/torcdevice_8h_source.html#l00061">torcdevice.h:61</a></div></div>
<div class="ttc" id="torctimercontrol_8cpp_html_a9d6085f2fc2a6e210e945168162dc6e2"><div class="ttname"><a href="../../d3/d4a/torctimercontrol_8cpp.html#a9d6085f2fc2a6e210e945168162dc6e2">kMSecsinWeek</a></div><div class="ttdeci">static const quint64 kMSecsinWeek</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00036">torctimercontrol.cpp:36</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a4f8f01816ff0addffb4f269028050371"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371">TorcTimerControl::TimerType</a></div><div class="ttdeci">TimerType</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d13/torctimercontrol_8h_source.html#l00016">torctimercontrol.h:16</a></div></div>
<div class="ttc" id="class_torc_control_html_a3e211eb2fc314791f517f2465a2f23d4"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#a3e211eb2fc314791f517f2465a2f23d4">TorcControl::m_inputs</a></div><div class="ttdeci">QMap&lt; QObject *, QString &gt; m_inputs</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/torccontrol_8h_source.html#l00074">torccontrol.h:74</a></div></div>
<div class="ttc" id="torcloggingdefs_8h_html_a6bb428c1ccb88c717bfa26f1fcc7c33e"><div class="ttname"><a href="../../d1/d37/torcloggingdefs_8h.html#a6bb428c1ccb88c717bfa26f1fcc7c33e">true</a></div><div class="ttdeci">VERBOSE_PREAMBLE true</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/torcloggingdefs_8h_source.html#l00048">torcloggingdefs.h:48</a></div></div>
<div class="ttc" id="torctimercontrol_8cpp_html_a05efa1bb2d5592d9b48c4275aab7a2f8"><div class="ttname"><a href="../../d3/d4a/torctimercontrol_8cpp.html#a05efa1bb2d5592d9b48c4275aab7a2f8">kMSecsInMinute</a></div><div class="ttdeci">static const quint64 kMSecsInMinute</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00033">torctimercontrol.cpp:33</a></div></div>
<div class="ttc" id="torctimercontrol_8h_html"><div class="ttname"><a href="../../d8/d13/torctimercontrol_8h.html">torctimercontrol.h</a></div></div>
<div class="ttc" id="class_torc_control_html_a2bee84dccdf821c4b51fab8ca7827301"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#a2bee84dccdf821c4b51fab8ca7827301">TorcControl::m_validated</a></div><div class="ttdeci">bool m_validated</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/torccontrol_8h_source.html#l00071">torccontrol.h:71</a></div></div>
<div class="ttc" id="torclogging_8h_html"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html">torclogging.h</a></div></div>
<div class="ttc" id="torctimercontrol_8cpp_html_adf147f20a670260cad77e5b14bce99fc"><div class="ttname"><a href="../../d3/d4a/torctimercontrol_8cpp.html#adf147f20a670260cad77e5b14bce99fc">kThou</a></div><div class="ttdeci">static const quint64 kThou</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00029">torctimercontrol.cpp:29</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a4f8f01816ff0addffb4f269028050371aff959ce6b9dd5419e67ada2f5ee0c378"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371aff959ce6b9dd5419e67ada2f5ee0c378">TorcTimerControl::Daily</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d13/torctimercontrol_8h_source.html#l00022">torctimercontrol.h:22</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a42f78bbfd061d6d5ea16b738d80409d7"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a42f78bbfd061d6d5ea16b738d80409d7">TorcTimerControl::Validate</a></div><div class="ttdeci">bool Validate(void) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00245">torctimercontrol.cpp:245</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a4f8f01816ff0addffb4f269028050371a903d4f24365683f748a9fb669c567f70"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a903d4f24365683f748a9fb669c567f70">TorcTimerControl::Weekly</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d13/torctimercontrol_8h_source.html#l00023">torctimercontrol.h:23</a></div></div>
<div class="ttc" id="class_torc_control_html_ab1b456fdcac8ad1d9d7225eff0927561"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#ab1b456fdcac8ad1d9d7225eff0927561">TorcControl::m_parsed</a></div><div class="ttdeci">bool m_parsed</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/torccontrol_8h_source.html#l00070">torccontrol.h:70</a></div></div>
<div class="ttc" id="class_torc_control_html_a6d30a9f3ff8903dc6a4b4528fc4a1e14"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#a6d30a9f3ff8903dc6a4b4528fc4a1e14">TorcControl::SetValid</a></div><div class="ttdeci">void SetValid(bool Valid) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/torccontrol_8cpp_source.html#l00634">torccontrol.cpp:634</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a048085fd2523320c8ab1f9add1b10c39"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a048085fd2523320c8ab1f9add1b10c39">TorcTimerControl::GetTimerType</a></div><div class="ttdeci">TorcTimerControl::TimerType GetTimerType(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00477">torctimercontrol.cpp:477</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_ad5c4ce3e8a18dae01b419f149aaa87ff"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#ad5c4ce3e8a18dae01b419f149aaa87ff">TorcTimerControl::TimerTimeout</a></div><div class="ttdeci">void TimerTimeout(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00333">torctimercontrol.cpp:333</a></div></div>
<div class="ttc" id="class_torc_control_html_a9674689dc841799e823c26856123a8b0a068b32323878afb25f83ee6edc15ea2e"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#a9674689dc841799e823c26856123a8b0a068b32323878afb25f83ee6edc15ea2e">TorcControl::Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/torccontrol_8h_source.html#l00028">torccontrol.h:28</a></div></div>
<div class="ttc" id="torctimercontrol_8cpp_html_a22bf7020d02d9a458d89b7b7825123f5"><div class="ttname"><a href="../../d3/d4a/torctimercontrol_8cpp.html#a22bf7020d02d9a458d89b7b7825123f5">kMSecsInDay</a></div><div class="ttdeci">static const quint64 kMSecsInDay</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00035">torctimercontrol.cpp:35</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a3cad10239debf2ff664c667e69f1c996"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a3cad10239debf2ff664c667e69f1c996">TorcTimerControl::TimeSinceLastTransition</a></div><div class="ttdeci">quint64 TimeSinceLastTransition(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00482">torctimercontrol.cpp:482</a></div></div>
<div class="ttc" id="class_torc_control_html_aacd131384c523cf16c54ab906d41329c"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#aacd131384c523cf16c54ab906d41329c">TorcControl::SetValue</a></div><div class="ttdeci">void SetValue(double Value) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/torccontrol_8cpp_source.html#l00626">torccontrol.cpp:626</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a4f8f01816ff0addffb4f269028050371ac37ab8c1473981f07be7fe9778d80a9c"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371ac37ab8c1473981f07be7fe9778d80a9c">TorcTimerControl::UnknownTimerType</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d13/torctimercontrol_8h_source.html#l00018">torctimercontrol.h:18</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a4f8f01816ff0addffb4f269028050371a679ffd6156c5b06ae4fc0ee0d366617b"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a679ffd6156c5b06ae4fc0ee0d366617b">TorcTimerControl::Custom</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d13/torctimercontrol_8h_source.html#l00019">torctimercontrol.h:19</a></div></div>
<div class="ttc" id="class_torc_device_html_a9d63017b24e1a69ad8ad51f09004289c"><div class="ttname"><a href="../../d5/d76/class_torc_device.html#a9d63017b24e1a69ad8ad51f09004289c">TorcDevice::lock</a></div><div class="ttdeci">QMutex lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/df7/torcdevice_8h_source.html#l00064">torcdevice.h:64</a></div></div>
<div class="ttc" id="class_torc_event_html_a3cae355e5cf80619e4370890e82d2a84"><div class="ttname"><a href="../../d6/d78/class_torc_event.html#a3cae355e5cf80619e4370890e82d2a84">TorcEvent::TorcEventType</a></div><div class="ttdeci">static Type TorcEventType</div><div class="ttdoc">Register TorcEventType with QEvent. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d66/torcevent_8h_source.html#l00019">torcevent.h:19</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_af41592c440babced7078bb00aaaecff8"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#af41592c440babced7078bb00aaaecff8">TorcTimerControl::TorcTimerControl</a></div><div class="ttdeci">TorcTimerControl(const QString &amp;Type, const QVariantMap &amp;Details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00066">torctimercontrol.cpp:66</a></div></div>
<div class="ttc" id="class_torc_control_html_a99aeedbcd80ce345c2427abf5dc2bc45"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#a99aeedbcd80ce345c2427abf5dc2bc45">TorcControl::DurationToString</a></div><div class="ttdeci">static QString DurationToString(int Days, quint64 Duration)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/torccontrol_8cpp_source.html#l00179">torccontrol.cpp:179</a></div></div>
<div class="ttc" id="class_torc_device_html_ae077bff2755060265238ed6a3a47c5eb"><div class="ttname"><a href="../../d5/d76/class_torc_device.html#ae077bff2755060265238ed6a3a47c5eb">TorcDevice::value</a></div><div class="ttdeci">double value</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/df7/torcdevice_8h_source.html#l00058">torcdevice.h:58</a></div></div>
<div class="ttc" id="torcloggingdefs_8h_html_a93519f65dd0ef21fc5be0c286a833ae4"><div class="ttname"><a href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a></div><div class="ttdeci">VERBOSE_PREAMBLE General info Playback related messages File and AutoExpire related messages Network protocol related messages Audio related messages JobQueue related messages EIT related messages DSMCC carousel related messages UPnP debugging messages xmltv output and related messages Media Manager debugging messages External executable related messages false</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/torcloggingdefs_8h_source.html#l00110">torcloggingdefs.h:110</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a4f8f01816ff0addffb4f269028050371a2212749610b32f00e4e9cd88ef61d1ce"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a2212749610b32f00e4e9cd88ef61d1ce">TorcTimerControl::Minutely</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d13/torctimercontrol_8h_source.html#l00020">torctimercontrol.h:20</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a4f8f01816ff0addffb4f269028050371a783408861d26e3ec64d923a6c5986321"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a4f8f01816ff0addffb4f269028050371a783408861d26e3ec64d923a6c5986321">TorcTimerControl::Hourly</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d13/torctimercontrol_8h_source.html#l00021">torctimercontrol.h:21</a></div></div>
<div class="ttc" id="class_torc_control_html_a6e70a8ee3b449f7a5fd61213a5645537"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#a6e70a8ee3b449f7a5fd61213a5645537">TorcControl::Finish</a></div><div class="ttdeci">bool Finish(void)</div><div class="ttdoc">Finish setup of the control. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/torccontrol_8cpp_source.html#l00434">torccontrol.cpp:434</a></div></div>
<div class="ttc" id="class_torc_event_html"><div class="ttname"><a href="../../d6/d78/class_torc_event.html">TorcEvent</a></div><div class="ttdoc">A general purpose event object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d66/torcevent_8h_source.html#l00009">torcevent.h:9</a></div></div>
<div class="ttc" id="class_torc_html_ae24951db8926b98a75762aef8448e473a05b4f2a87d2fcb673c6e496556366df3"><div class="ttname"><a href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473a05b4f2a87d2fcb673c6e496556366df3">Torc::SystemTimeChanged</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dbd/torclocalcontext_8h_source.html#l00065">torclocalcontext.h:65</a></div></div>
<div class="ttc" id="class_torc_control_html"><div class="ttname"><a href="../../d1/d34/class_torc_control.html">TorcControl</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/torccontrol_8h_source.html#l00015">torccontrol.h:15</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a9ecf2345898bf931f204e20593f29f6d"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a9ecf2345898bf931f204e20593f29f6d">TorcTimerControl::GetDescription</a></div><div class="ttdeci">QStringList GetDescription(void) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00234">torctimercontrol.cpp:234</a></div></div>
<div class="ttc" id="class_torc_observable_html_a171edc659834e25af5862f84e514b215"><div class="ttname"><a href="../../d8/d49/class_torc_observable.html#a171edc659834e25af5862f84e514b215">TorcObservable::AddObserver</a></div><div class="ttdeci">void AddObserver(QObject *Observer)</div><div class="ttdoc">brief Register the given object to receive events. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d74/torcobservable_8cpp_source.html#l00051">torcobservable.cpp:51</a></div></div>
<div class="ttc" id="torctimercontrol_8cpp_html_a5e11f16c73f15a11b5d04326a57518f6"><div class="ttname"><a href="../../d3/d4a/torctimercontrol_8cpp.html#a5e11f16c73f15a11b5d04326a57518f6">kMSecsInHour</a></div><div class="ttdeci">static const quint64 kMSecsInHour</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00034">torctimercontrol.cpp:34</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a8c3859eb34b61d8ca9def7b4e6dc3358"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a8c3859eb34b61d8ca9def7b4e6dc3358">TorcTimerControl::GetType</a></div><div class="ttdeci">TorcControl::Type GetType(void) const override</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00229">torctimercontrol.cpp:229</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_af880678a6375212d468f1931d0a8e11c"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#af880678a6375212d468f1931d0a8e11c">TorcTimerControl::Start</a></div><div class="ttdeci">void Start(void) override</div><div class="ttdoc">Initialise the timer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00294">torctimercontrol.cpp:294</a></div></div>
<div class="ttc" id="class_torc_observable_html_afefd31617891afe709c8dc9d62368d5c"><div class="ttname"><a href="../../d8/d49/class_torc_observable.html#afefd31617891afe709c8dc9d62368d5c">TorcObservable::RemoveObserver</a></div><div class="ttdeci">void RemoveObserver(QObject *Observer)</div><div class="ttdoc">brief Deregister the given object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d74/torcobservable_8cpp_source.html#l00060">torcobservable.cpp:60</a></div></div>
<div class="ttc" id="class_torc_control_html_a9674689dc841799e823c26856123a8b0"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#a9674689dc841799e823c26856123a8b0">TorcControl::Type</a></div><div class="ttdeci">Type</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/torccontrol_8h_source.html#l00024">torccontrol.h:24</a></div></div>
<div class="ttc" id="torctimercontrol_8cpp_html_a36af2530cb2d4961de0126db418c66d4"><div class="ttname"><a href="../../d3/d4a/torctimercontrol_8cpp.html#a36af2530cb2d4961de0126db418c66d4">k7</a></div><div class="ttdeci">static const quint64 k7</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00032">torctimercontrol.cpp:32</a></div></div>
<div class="ttc" id="class_torc_timer_control_html_a896ba108b8a34f6a0f1fa9200a75b182"><div class="ttname"><a href="../../d6/d72/class_torc_timer_control.html#a896ba108b8a34f6a0f1fa9200a75b182">TorcTimerControl::event</a></div><div class="ttdeci">bool event(QEvent *Event) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00315">torctimercontrol.cpp:315</a></div></div>
<div class="ttc" id="torclocalcontext_8h_html"><div class="ttname"><a href="../../dd/dbd/torclocalcontext_8h.html">torclocalcontext.h</a></div></div>
<div class="ttc" id="torctimercontrol_8cpp_html_a441a4dd4641b059bf54016b08e95b6ce"><div class="ttname"><a href="../../d3/d4a/torctimercontrol_8cpp.html#a441a4dd4641b059bf54016b08e95b6ce">kSixty</a></div><div class="ttdeci">static const quint64 kSixty</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4a/torctimercontrol_8cpp_source.html#l00030">torctimercontrol.cpp:30</a></div></div>
<div class="ttc" id="class_torc_control_html_aad689569fd6a26c35df0f22b56f8f374"><div class="ttname"><a href="../../d1/d34/class_torc_control.html#aad689569fd6a26c35df0f22b56f8f374">TorcControl::m_outputs</a></div><div class="ttdeci">QMap&lt; QObject *, QString &gt; m_outputs</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d9a/torccontrol_8h_source.html#l00075">torccontrol.h:75</a></div></div>
<div class="ttc" id="torclogging_8h_html_a73a147108bf0df6442820b82b022ef94"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a></div><div class="ttdeci">#define LOG(_MASK_, _LEVEL_, _FORMAT_,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df9/torclogging_8h_source.html#l00031">torclogging.h:31</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 30 2018 09:48:59 for Torc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
