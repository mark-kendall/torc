<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Torc: torcssdp.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Torc
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_19e1fafdf157c27762559b97f5d6a2d3.html">torc</a></li><li class="navelem"><a class="el" href="../../dir_600fd7ae3a660f6e1e69017e043cea0b.html">upnp</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">torcssdp.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d9/de1/torcssdp_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Class TorcSSDP</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">* This file is part of the Torc project.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">* Copyright (C) Mark Kendall 2013-18</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">* This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">* it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">* the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">* (at your option) any later version.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">* This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">* but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">* GNU General Public License for more details.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">* You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">* along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">* Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301,</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">* USA.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// Qt</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;QHostAddress&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// Torc</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/dbd/torclocalcontext_8h.html">torclocalcontext.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d1b/torchttpserver_8h.html">torchttpserver.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d49/torccoreutils_8h.html">torccoreutils.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/df9/torclogging_8h.html">torclogging.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/dd5/torcadminthread_8h.html">torcadminthread.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/da5/torcnetwork_8h.html">torcnetwork.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d1e/torcupnp_8h.html">torcupnp.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d3e/torcssdp_8h.html">torcssdp.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html">TorcSSDP</a>* <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">TorcSSDP::gSSDP</a>        = NULL;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;QMutex*   <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">TorcSSDP::gSSDPLock</a>    = <span class="keyword">new</span> QMutex(QMutex::Recursive);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5abb7fce588cff6cbd6c75a1627922fb">TorcSSDP::gSearchEnabled</a>    = <span class="keyword">false</span>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a2b9a9048af5f3f9ecb45a330d5f03095">TorcSSDP::gSearchOptions</a> = <a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a>();</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a01fb2b03ee18c9e24677a18f2b13bac5">TorcSSDP::gAnnounceEnabled</a>  = <span class="keyword">false</span>;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9e86c8c6bcfa458958c9cd0849b91419">TorcSSDP::gAnnounceOptions</a> = <a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a>();</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a98488cd4c2ef79c857fc8259fb6d7cc3">   43</a></span>&#160;<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a2a634eb6a4a9a474ce7d33842763e559">TorcSSDPSearchResponse::TorcSSDPSearchResponse</a>(<span class="keyword">const</span> QHostAddress &amp;Address, <span class="keyword">const</span> ResponseTypes Types, <span class="keywordtype">int</span> Port)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  : m_responseAddress(Address),</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    m_responseTypes(Types),</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    m_port(Port)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;{</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a2a634eb6a4a9a474ce7d33842763e559">   50</a></span>&#160;<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a2a634eb6a4a9a474ce7d33842763e559">TorcSSDPSearchResponse::TorcSSDPSearchResponse</a>()</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  : <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a0d98bbcc302539bf981f5a4c83007d43">m_responseAddress</a>(QHostAddress(QHostAddress::Any)),</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a4e81c6fc74ddbc3abf918e1c9209dd48">m_responseTypes</a>(<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html">TorcSSDPSearchResponse</a>::<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769cae92770ec3cf2afc093f57610043a4a0a">None</a>),</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#abf7aefdc04c3701849622cebafe2f996">m_port</a>(0)</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;{</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#ae19905f3250aa4e74eec14f040e9202b">   63</a></span>&#160;<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ae19905f3250aa4e74eec14f040e9202b">TorcSSDP::TorcSSDP</a>()</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  : QObject(),</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    m_searchOptions(),</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    m_announceOptions(),</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    m_serverString(),</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    m_searching(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    m_searchDebugged(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    m_firstSearchTimer(0),</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    m_secondSearchTimer(0),</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    m_firstAnnounceTimer(0),</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    m_secondAnnounceTimer(0),</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    m_refreshTimer(0),</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    m_started(<a class="code" href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a>),</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    m_ipv4Address(),</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    m_ipv6Address(),</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    m_addressess(),</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    m_ipv4GroupAddress(<a class="code" href="../../dd/d3e/torcssdp_8h.html#ae94140955813659d90e1c7e72cce8e46">TORC_IPV4_UDP_MULTICAST_ADDR</a>),</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    m_ipv4MulticastSocket(NULL),</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    m_ipv6LinkGroupBaseAddress(<a class="code" href="../../dd/d3e/torcssdp_8h.html#ae4a9dced97fa44af2bab554b642fa99b">TORC_IPV6_UDP_MULTICAST_ADDR2</a>),</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    m_ipv6LinkMulticastSocket(NULL),</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    m_discoveredDevices(),</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    m_ipv4UnicastSocket(NULL),</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    m_ipv6UnicastSocket(NULL),</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    m_responseTimer(),</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    m_responseQueue()</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#if (QT_VERSION &gt;= QT_VERSION_CHECK(5, 4, 0))</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    m_serverString = QString(<span class="stringliteral">&quot;%1/%2 UPnP/1.0 Torc/0.1&quot;</span>).arg(QSysInfo::kernelType()).arg(QSysInfo::kernelVersion());</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    m_serverString = QString(<span class="stringliteral">&quot;OldTorc/OldVersion UPnP/1.0 Torc/0.1&quot;</span>);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d8/d49/class_torc_observable.html#a171edc659834e25af5862f84e514b215">AddObserver</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d73/class_torc_network.html#a63a043981858567c24cd286fe8f77e11">TorcNetwork::IsAvailable</a>())</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        Start();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// minimum advertisement duration is 30 mins (1800 seconds). Check for expiry</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// every 5 minutes and flush stale entries</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    m_refreshTimer = startTimer(5 * 60 * 1000, Qt::VeryCoarseTimer);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// start the response timer here and connect its signal</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// we use a full QTimer as we need to know how long it has remaining</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    connect(&amp;m_responseTimer, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ab28eb676648e2fb0e0356f3de140c98b">ProcessResponses</a>()));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    m_responseTimer.start(5000);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a5f0a4894979cb515abebb0d81482a770">  109</a></span>&#160;<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5f0a4894979cb515abebb0d81482a770">TorcSSDP::~TorcSSDP</a>()</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;{</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    Stop();</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> (m_refreshTimer)</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        killTimer(m_refreshTimer);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d8/d49/class_torc_observable.html#afefd31617891afe709c8dc9d62368d5c">RemoveObserver</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="keywordtype">void</span> TorcSSDP::Start(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;{</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (m_started)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        Stop();</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Starting SSDP as %1&quot;</span>).arg(m_serverString));</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// try and get the interface the network is using</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    QNetworkInterface interface;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    QList&lt;QNetworkInterface&gt; interfaces = QNetworkInterface::allInterfaces();</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">foreach</span> (QNetworkInterface i, interfaces)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        QNetworkInterface::InterfaceFlags flags = i.flags();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">if</span> (flags &amp; QNetworkInterface::IsUp &amp;&amp;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            flags &amp; QNetworkInterface::IsRunning &amp;&amp;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            flags &amp; QNetworkInterface::CanMulticast &amp;&amp;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            !(flags &amp; QNetworkInterface::IsLoopBack))</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Using interface &#39;%1&#39; for multicast&quot;</span>).arg(i.name()));</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keyword">interface </span>= i;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// create the list of known own addresses</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    m_ipv4Address = QString();</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    m_ipv6Address = QString();</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    m_addressess = QNetworkInterface::allAddresses();</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// try and determine suitable ipv4 and ipv6 addresses</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">// at the moment I cannot test &#39;proper&#39; IPv6 support, so allow link local for now</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    QString ipv6linklocal;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">foreach</span> (QHostAddress address, m_addressess)</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d73/class_torc_network.html#a4ce7f625cf153e5e7b07434ed688dbea">TorcNetwork::IsGlobal</a>(address))</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d73/class_torc_network.html#abfa4272255a3ef40373868c06c7479af">TorcNetwork::IsExternal</a>(address))</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d73/class_torc_network.html#a7823cef66f9141ae778b4eb2ff3ba0b1">TorcNetwork::IsLocal</a>(address))</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            <span class="keywordflow">if</span> (address.protocol() == QAbstractSocket::IPv4Protocol)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                m_ipv4Address = address.toString();</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                m_ipv6Address = address.toString();</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d8/d73/class_torc_network.html#a50f0913259a1ad5a0f6c3faafeebd609">TorcNetwork::IsLinkLocal</a>(address) &amp;&amp; address.protocol() == QAbstractSocket::IPv6Protocol)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            ipv6linklocal = address.toString();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// fall back to link local for ipv6</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">if</span> (m_ipv6Address.isEmpty() &amp;&amp; !ipv6linklocal.isEmpty())</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        m_ipv6Address = ipv6linklocal;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span> (!m_ipv6Address.isEmpty() &amp;&amp; !m_ipv6Address.startsWith(<span class="stringliteral">&quot;[&quot;</span>))</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        m_ipv6Address = QString(<span class="stringliteral">&quot;[%1]&quot;</span>).arg(m_ipv6Address);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span> (m_ipv4Address.isEmpty())</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Disabling SSDP IPv4 - no valid address detected&quot;</span>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;SSDP IPv4 host url: %1&quot;</span>).arg(m_ipv4Address));</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> (m_ipv6Address.isEmpty())</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Disabling SSDP IPv6 - no valid address detected&quot;</span>);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;SSDP IPv6 host url: %1 (if enabled)&quot;</span>).arg(m_ipv6Address));</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// create sockets</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">if</span> (interface.isValid())</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        m_ipv4MulticastSocket       = CreateMulticastSocket(m_ipv4GroupAddress, <span class="keyword">this</span>, interface);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        m_ipv6LinkMulticastSocket   = CreateMulticastSocket(m_ipv6LinkGroupBaseAddress, <span class="keyword">this</span>, interface);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        m_ipv4UnicastSocket         = CreateSearchSocket(QHostAddress(QHostAddress::AnyIPv4), <span class="keyword">this</span>);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        m_ipv6UnicastSocket         = CreateSearchSocket(QHostAddress(QHostAddress::AnyIPv6), <span class="keyword">this</span>);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, <span class="stringliteral">&quot;Failed to create SSDP sockets - no suitable network interface&quot;</span>);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// check whether search or announce was requested before we started</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">bool</span> search;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordtype">bool</span> announce;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        QMutexLocker locker(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        search    = <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5abb7fce588cff6cbd6c75a1627922fb">gSearchEnabled</a>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        announce  = <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a01fb2b03ee18c9e24677a18f2b13bac5">gAnnounceEnabled</a>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (search)</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        StartSearch();</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">if</span> (announce)</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        StartAnnounce();</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    m_started = <span class="keyword">true</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keywordtype">void</span> TorcSSDP::Stop(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// cancel search and announce</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    StopSearch();</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    StopAnnounce();</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// discard queued responses</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    m_responseQueue.clear();</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// Network is no longer available - notify clients that services have gone away</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    QHash&lt;QString,TorcUPNPDescription&gt;::const_iterator it2 = m_discoveredDevices.begin();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">for</span> ( ; it2 != m_discoveredDevices.end(); ++it2)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        QVariantMap data;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        data.insert(<span class="stringliteral">&quot;usn&quot;</span>, it2.value().GetUSN());</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a> <span class="keyword">event</span> = <a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a>(<a class="code" href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473aec50861553c03287693438ea703b12cf">Torc::ServiceWentAway</a>, data);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d8/d49/class_torc_observable.html#ae7e6e9e00d6fd50bc062690104012779">Notify</a>(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    m_discoveredDevices.clear();</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    m_addressess.clear();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    m_ipv4Address = QString();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    m_ipv6Address = QString();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> (m_started)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Stopping SSDP&quot;</span>);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    m_started = <span class="keyword">false</span>;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (m_ipv4MulticastSocket)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        m_ipv4MulticastSocket-&gt;close();</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">if</span> (m_ipv6LinkMulticastSocket)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        m_ipv6LinkMulticastSocket-&gt;close();</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">if</span> (m_ipv4UnicastSocket)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        m_ipv4UnicastSocket-&gt;close();</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span> (m_ipv6UnicastSocket)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        m_ipv6UnicastSocket-&gt;close();</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keyword">delete</span> m_ipv4MulticastSocket;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keyword">delete</span> m_ipv6LinkMulticastSocket;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keyword">delete</span> m_ipv4UnicastSocket;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keyword">delete</span> m_ipv6UnicastSocket;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    m_ipv4MulticastSocket     = NULL;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    m_ipv6LinkMulticastSocket = NULL;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    m_ipv4UnicastSocket       = NULL;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    m_ipv6UnicastSocket       = NULL;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a50c026037a427016a65e24a6991f74bd">  269</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a50c026037a427016a65e24a6991f74bd">TorcSSDP::Search</a>(<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a> Options)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;{</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    QMutexLocker locker(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5abb7fce588cff6cbd6c75a1627922fb">gSearchEnabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a2b9a9048af5f3f9ecb45a330d5f03095">gSearchOptions</a> = Options;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        QMetaObject::invokeMethod(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>, <span class="stringliteral">&quot;SearchPriv&quot;</span>, Qt::AutoConnection);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#aae6fd2282aa316bdc6ded69a33db6ee1">  283</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#aae6fd2282aa316bdc6ded69a33db6ee1">TorcSSDP::CancelSearch</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;{</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    QMutexLocker locker(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5abb7fce588cff6cbd6c75a1627922fb">gSearchEnabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        QMetaObject::invokeMethod(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>, <span class="stringliteral">&quot;CancelSearchPriv&quot;</span>, Qt::AutoConnection);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;}</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a4c42137b3ac13b4a44460e9cf197ab96">  294</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a4c42137b3ac13b4a44460e9cf197ab96">TorcSSDP::Announce</a>(<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a> Options)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;{</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    QMutexLocker locker(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a01fb2b03ee18c9e24677a18f2b13bac5">gAnnounceEnabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9e86c8c6bcfa458958c9cd0849b91419">gAnnounceOptions</a> = Options;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        QMetaObject::invokeMethod(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>, <span class="stringliteral">&quot;AnnouncePriv&quot;</span>, Qt::AutoConnection);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a99f3b9bc646f776011d2edce80c01a01">  305</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a99f3b9bc646f776011d2edce80c01a01">TorcSSDP::CancelAnnounce</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;{</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    QMutexLocker locker(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a01fb2b03ee18c9e24677a18f2b13bac5">gAnnounceEnabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9e86c8c6bcfa458958c9cd0849b91419">gAnnounceOptions</a>.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a> = 0;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        QMetaObject::invokeMethod(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>, <span class="stringliteral">&quot;CancelAnnouncePriv&quot;</span>, Qt::AutoConnection);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#add1317e81894c30a1f774210f41ea298">  314</a></span>&#160;<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html">TorcSSDP</a>* <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#add1317e81894c30a1f774210f41ea298">TorcSSDP::Create</a>(<span class="keywordtype">bool</span> Destroy)</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    QMutexLocker locker(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (!Destroy)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a> = <span class="keyword">new</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ae19905f3250aa4e74eec14f040e9202b">TorcSSDP</a>();</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keyword">delete</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">gSSDP</a> = NULL;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;QUdpSocket* TorcSSDP::CreateSearchSocket(<span class="keyword">const</span> QHostAddress &amp;HostAddress, QObject *Owner)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;{</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    QUdpSocket *socket = <span class="keyword">new</span> QUdpSocket();</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">if</span> (socket-&gt;bind(HostAddress, 1900, QUdpSocket::ShareAddress))</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        socket-&gt;setSocketOption(QAbstractSocket::MulticastTtlOption, 4);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        socket-&gt;setSocketOption(QAbstractSocket::MulticastLoopbackOption, 1);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        QObject::connect(socket, SIGNAL(readyRead()), Owner, SLOT(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a19135cfe7c3bc7b821563ee2689cb207">Read</a>()));</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_INFO, QString(<span class="stringliteral">&quot;%1 SSDP unicast socket %2:%3&quot;</span>)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            .arg(HostAddress.protocol() == QAbstractSocket::IPv6Protocol ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            .arg(socket-&gt;localAddress().toString())</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            .arg(QString::number(socket-&gt;localPort())));</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">return</span> socket;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Failed to bind %1 SSDP search socket with address %3 (%2)&quot;</span>)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        .arg(HostAddress.protocol() == QAbstractSocket::IPv6Protocol ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>).arg(socket-&gt;errorString())</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        .arg(HostAddress.toString()));</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keyword">delete</span> socket;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;QUdpSocket* TorcSSDP::CreateMulticastSocket(<span class="keyword">const</span> QHostAddress &amp;HostAddress, QObject *Owner, <span class="keyword">const</span> QNetworkInterface &amp;Interface)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;{</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    QUdpSocket *socket = <span class="keyword">new</span> QUdpSocket();</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">if</span> (socket-&gt;bind(HostAddress, <a class="code" href="../../dd/d3e/torcssdp_8h.html#a1ff9f7302adb11794b9542d49fd09e5a">TORC_SSDP_UDP_MULTICAST_PORT</a>, QUdpSocket::ShareAddress))</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">if</span> (socket-&gt;joinMulticastGroup(HostAddress, Interface))</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            QObject::connect(socket, SIGNAL(readyRead()), Owner, SLOT(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a19135cfe7c3bc7b821563ee2689cb207">Read</a>()));</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_INFO, QString(<span class="stringliteral">&quot;%1 SSDP multicast socket %2:%3&quot;</span>)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                .arg(HostAddress.protocol() == QAbstractSocket::IPv6Protocol ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                .arg(socket-&gt;localAddress().toString())</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                .arg(QString::number(socket-&gt;localPort())));</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">return</span> socket;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Failed to join %1 multicast group (%2)&quot;</span>)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            .arg(HostAddress.protocol() == QAbstractSocket::IPv6Protocol ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            .arg(socket-&gt;errorString()));</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Failed to bind %1 SSDP multicast socket with address %3 (%2)&quot;</span>)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            .arg(HostAddress.protocol() == QAbstractSocket::IPv6Protocol ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>).arg(socket-&gt;errorString())</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            .arg(HostAddress.toString()));</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    }</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keyword">delete</span> socket;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a7eb4da2ab784a3a2e30db764e412f724">  382</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a7eb4da2ab784a3a2e30db764e412f724">TorcSSDP::SendSearch</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;{</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// evented when the network is available or we have restarted and then twice every five minutes</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// we only search for the Torc root device</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    QString searchdevice = <a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>;<span class="comment">//&quot;ssdp:all&quot;;</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> QString search(<span class="stringliteral">&quot;M-SEARCH * HTTP/1.1\r\n&quot;</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                <span class="stringliteral">&quot;HOST: %1\r\n&quot;</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                <span class="stringliteral">&quot;MAN: \&quot;ssdp:discover\&quot;\r\n&quot;</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                <span class="stringliteral">&quot;MX: 3\r\n&quot;</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                <span class="stringliteral">&quot;ST: %2\r\n\r\n&quot;</span>);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">if</span> (!m_ipv4Address.isEmpty() &amp;&amp; m_ipv4MulticastSocket &amp;&amp; m_ipv4MulticastSocket-&gt;isValid() &amp;&amp; m_ipv4MulticastSocket-&gt;state() == QAbstractSocket::BoundState)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        m_ipv4MulticastSocket-&gt;setSocketOption(QAbstractSocket::MulticastTtlOption, 2);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        QByteArray ipv4search = QString(search).arg(<a class="code" href="../../dd/d3e/torcssdp_8h.html#a51611a65bb1cc4852c13a9267ca828b8">TORC_IPV4_UDP_MULTICAST_URL</a>).arg(searchdevice).toLocal8Bit();</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        qint64 sent = m_ipv4MulticastSocket-&gt;writeDatagram(ipv4search, m_ipv4GroupAddress, <a class="code" href="../../dd/d3e/torcssdp_8h.html#a1ff9f7302adb11794b9542d49fd09e5a">TORC_SSDP_UDP_MULTICAST_PORT</a>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordflow">if</span> (sent != ipv4search.size())</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Error sending IPv4 search request (%1)&quot;</span>).arg(m_ipv4MulticastSocket-&gt;errorString()));</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!m_searchDebugged)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Sent IPv4 SSDP global search request&quot;</span>);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Will send further IPv4 requests every 5 minutes&quot;</span>);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (m_searchOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a56381f0140b8900f6dfbf88bb0a9f93b">ipv6</a> &amp;&amp; !m_ipv6Address.isEmpty() &amp;&amp; m_ipv6LinkMulticastSocket &amp;&amp; m_ipv6LinkMulticastSocket-&gt;isValid() &amp;&amp; m_ipv6LinkMulticastSocket-&gt;state() == QAbstractSocket::BoundState)</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        m_ipv6LinkMulticastSocket-&gt;setSocketOption(QAbstractSocket::MulticastTtlOption, 2);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        QByteArray ipv6search = QString(search).arg(<a class="code" href="../../dd/d3e/torcssdp_8h.html#a61e57da949c4343c7aaf653dde7232e9">TORC_IPV6_UDP_MULTICAST_URL</a>).arg(searchdevice).toLocal8Bit();</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        qint64 sent = m_ipv6LinkMulticastSocket-&gt;writeDatagram(ipv6search, m_ipv6LinkGroupBaseAddress, <a class="code" href="../../dd/d3e/torcssdp_8h.html#a1ff9f7302adb11794b9542d49fd09e5a">TORC_SSDP_UDP_MULTICAST_PORT</a>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">if</span> (sent != ipv6search.size())</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Error sending IPv6 search request (%1)&quot;</span>).arg(m_ipv6LinkMulticastSocket-&gt;errorString()));</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!m_searchDebugged)</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Sent IPv6 SSDP global search request&quot;</span>);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;Will send further IPv6 requests every 5 minutes&quot;</span>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    m_searchDebugged = <span class="keyword">true</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#abc16b76005253f4d021a8a22697e8ddd">  428</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#abc16b76005253f4d021a8a22697e8ddd">TorcSSDP::SearchPriv</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;{</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// if we haven&#39;t started or the network is unavailable, the search will be triggered when we restart</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> (m_started &amp;&amp; <a class="code" href="../../d8/d73/class_torc_network.html#a63a043981858567c24cd286fe8f77e11">TorcNetwork::IsAvailable</a>())</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        StartSearch();</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;}</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a0eb025e2313b424eab4394df327f4e5b">  435</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a0eb025e2313b424eab4394df327f4e5b">TorcSSDP::CancelSearchPriv</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;{</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    StopSearch();</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;}</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#ad07e43d22a5c733b408d26fafbb8256b">  440</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ad07e43d22a5c733b408d26fafbb8256b">TorcSSDP::AnnouncePriv</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;{</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// if we haven&#39;t started or the network is unavailable, announce will be triggered when we restart</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span> (m_started &amp;&amp; <a class="code" href="../../d8/d73/class_torc_network.html#a63a043981858567c24cd286fe8f77e11">TorcNetwork::IsAvailable</a>())</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        StartAnnounce();</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a6127ee169ed7612aa6d99c6c847c760a">  447</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a6127ee169ed7612aa6d99c6c847c760a">TorcSSDP::CancelAnnouncePriv</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;{</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    StopAnnounce();</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;}</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="keywordtype">void</span> TorcSSDP::StartAnnounce(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;{</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>-&gt;lock();</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a> newoptions = <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9e86c8c6bcfa458958c9cd0849b91419">gAnnounceOptions</a>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>-&gt;unlock();</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (m_announceOptions == newoptions)</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;SSDP announce options unchanged - not restarting&quot;</span>);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    StopAnnounce();</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Starting SSDP announce (%1)&quot;</span>).arg(<a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>));</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    m_announceOptions = newoptions;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// schedule first announce almost immediately</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    m_firstAnnounceTimer = startTimer(100, Qt::CoarseTimer);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// and schedule another shortly afterwards</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    m_secondAnnounceTimer = startTimer(500, Qt::CoarseTimer);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;}</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordtype">void</span> TorcSSDP::StopAnnounce(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;{</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Stopping SSDP announce (%1)&quot;</span>).arg(<a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>));</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (m_firstAnnounceTimer)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        killTimer(m_firstAnnounceTimer);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        m_firstAnnounceTimer = 0;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> (m_secondAnnounceTimer)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    {</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        killTimer(m_secondAnnounceTimer);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        m_secondAnnounceTimer = 0;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    }</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">// try and send out byebye</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">SendAnnounce</a>(<span class="keyword">false</span>, <span class="keyword">false</span>); <span class="comment">// IPv4 byebye</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">if</span> (m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a56381f0140b8900f6dfbf88bb0a9f93b">ipv6</a>)</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">SendAnnounce</a>(<span class="keyword">true</span>, <span class="keyword">false</span>);  <span class="comment">// IPv6 byebye</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a> = 0;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;}</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">  503</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">TorcSSDP::SendAnnounce</a>(<span class="keywordtype">bool</span> IPv6, <span class="keywordtype">bool</span> Alive)</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;{</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span> (!m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, <span class="stringliteral">&quot;Cannot send announce - no port set&quot;</span>);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    }</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    QUdpSocket *socket = IPv6 ? m_ipv6LinkMulticastSocket : m_ipv4MulticastSocket;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span> ((IPv6 &amp;&amp; m_ipv6Address.isEmpty()) || (!IPv6 &amp;&amp; m_ipv4Address.isEmpty()))</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span> (!socket || !socket-&gt;isValid() || socket-&gt;state() != QAbstractSocket::BoundState)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">/* We need to send out 3 packets and then repeat after a short period of time.</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">     * Packet 1 - NT: upnp:rootdevice                             USN: uuid:device-UUID::upnp:rootdevice</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">     * Packet 2 - NT: uuid:device-UUID                            USN: uuid:device-UUID</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">     * Packet 3 - NT: urn:schemas-torcapp-org:device:TorcClient:1 USN: uuid:device-UUID::urn:schemas-torcapp-org:device:TorcClient:1</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> QString notify(<span class="stringliteral">&quot;NOTIFY * HTTP/1.1\r\n&quot;</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                <span class="stringliteral">&quot;HOST: %1\r\n&quot;</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                                <span class="stringliteral">&quot;CACHE-CONTROL: max-age=1800\r\n&quot;</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                <span class="stringliteral">&quot;LOCATION: http%2://%3:%4/upnp/description\r\n&quot;</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                                <span class="stringliteral">&quot;NT: %5\r\n&quot;</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                <span class="stringliteral">&quot;NTS: ssdp:%6\r\n&quot;</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                <span class="stringliteral">&quot;SERVER: %7\r\n&quot;</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                <span class="stringliteral">&quot;USN: %8\r\n&quot;</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                                <span class="stringliteral">&quot;NAME: %9\r\n&quot;</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                                <span class="stringliteral">&quot;APIVERSION: %10\r\n&quot;</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                <span class="stringliteral">&quot;STARTTIME: %11\r\n&quot;</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                                <span class="stringliteral">&quot;PRIORITY: %12\r\n%13\r\n&quot;</span>);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    QString ip           = IPv6 ? <a class="code" href="../../dd/d3e/torcssdp_8h.html#a61e57da949c4343c7aaf653dde7232e9">TORC_IPV6_UDP_MULTICAST_URL</a> : <a class="code" href="../../dd/d3e/torcssdp_8h.html#a51611a65bb1cc4852c13a9267ca828b8">TORC_IPV4_UDP_MULTICAST_URL</a>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    QHostAddress address = IPv6 ? m_ipv6LinkGroupBaseAddress : m_ipv4GroupAddress;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    QString uuid         = QString(<span class="stringliteral">&quot;uuid:&quot;</span>) + <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#aa09db82a2aaa43aa08cef5f30d32e271">GetUuid</a>();</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    QString alive        = Alive ? <span class="stringliteral">&quot;alive&quot;</span> : <span class="stringliteral">&quot;byebye&quot;</span>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    QString url          = IPv6 ? m_ipv6Address : m_ipv4Address;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    QString secure       = m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a72c26ba82b22a758e5612f82d794d6ac">secure</a> ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    QString secure2      = m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a72c26ba82b22a758e5612f82d794d6ac">secure</a> ? <span class="stringliteral">&quot;SECURE: yes\r\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    QString name         = <a class="code" href="../../db/dc7/class_torc_h_t_t_p_server.html#acd8ffa7ed1862bfdba35af63855a2a8d">TorcHTTPServer::ServerDescription</a>();</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    QString apiversion   = <a class="code" href="../../d1/d54/class_torc_h_t_t_p_services.html#ae8444ae326f123a375ff798be6a121b3">TorcHTTPServices::GetVersion</a>();</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    QString starttime    = QString::number(<a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#a6b6b5cc4732fee612a1a5e3ebe2cfcf1">GetStartTime</a>());</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    QString priority     = QString::number(<a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#a6585544b1dd0f8ebb815ed3ad150a2cd">GetPriority</a>());</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    QByteArray packet1   = QString(notify).arg(ip).arg(secure).arg(url).arg(m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>).arg(<span class="stringliteral">&quot;upnp:rootdevice&quot;</span>).arg(alive).arg(m_serverString).arg(uuid + <span class="stringliteral">&quot;::upnp::rootdevice&quot;</span>)</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                          .arg(name).arg(apiversion).arg(starttime).arg(priority).arg(secure2).toLocal8Bit();</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    QByteArray packet2   = QString(notify).arg(ip).arg(secure).arg(url).arg(m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>).arg(uuid).arg(alive).arg(m_serverString).arg(uuid)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                          .arg(name).arg(apiversion).arg(starttime).arg(priority).arg(secure2).toLocal8Bit();</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    QByteArray packet3   = QString(notify).arg(ip).arg(secure).arg(url).arg(m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>).arg(<a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>).arg(alive).arg(m_serverString).arg(uuid + <span class="stringliteral">&quot;::&quot;</span> + <a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                                          .arg(name).arg(apiversion).arg(starttime).arg(priority).arg(secure2).toLocal8Bit();</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    socket-&gt;setSocketOption(QAbstractSocket::MulticastTtlOption, 4);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    qint64 sent = socket-&gt;writeDatagram(packet1, address, <a class="code" href="../../dd/d3e/torcssdp_8h.html#a1ff9f7302adb11794b9542d49fd09e5a">TORC_SSDP_UDP_MULTICAST_PORT</a>);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    sent       += socket-&gt;writeDatagram(packet2, address, <a class="code" href="../../dd/d3e/torcssdp_8h.html#a1ff9f7302adb11794b9542d49fd09e5a">TORC_SSDP_UDP_MULTICAST_PORT</a>);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    sent       += socket-&gt;writeDatagram(packet3, address, <a class="code" href="../../dd/d3e/torcssdp_8h.html#a1ff9f7302adb11794b9542d49fd09e5a">TORC_SSDP_UDP_MULTICAST_PORT</a>);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">if</span> (sent != (packet1.size() + packet2.size() + packet3.size()))</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Error sending 3 %1 SSDP NOTIFYs (%2)&quot;</span>).arg(IPv6 ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>).arg(m_ipv4MulticastSocket-&gt;errorString()));</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_INFO, QString(<span class="stringliteral">&quot;Sent 3 %1 SSDP NOTIFYs &quot;</span>).arg(IPv6 ? <span class="stringliteral">&quot;IPv6&quot;</span> : <span class="stringliteral">&quot;IPv4&quot;</span>));</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;}</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">  566</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">TorcSSDP::event</a>(QEvent *Event)</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;{</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> (Event-&gt;type() == <a class="code" href="../../d6/d78/class_torc_event.html#a3cae355e5cf80619e4370890e82d2a84">TorcEvent::TorcEventType</a>)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a>* <span class="keyword">event</span> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a>*<span class="keyword">&gt;</span>(Event);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>-&gt;GetEvent() == <a class="code" href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473a5154ecec904db653a391442a7ee99df3">Torc::NetworkAvailable</a>)</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                Start();</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>-&gt;GetEvent() == <a class="code" href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473af8c2e5445befd829a232aac0c257c3a3">Torc::NetworkUnavailable</a>)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                Stop();</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Event-&gt;type() == QEvent::Timer)</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        QTimerEvent* <span class="keyword">event</span> = <span class="keyword">dynamic_cast&lt;</span>QTimerEvent*<span class="keyword">&gt;</span>(Event);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <span class="comment">// N.B. we kill the timers as we don&#39;t know whether they were the initial, short</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="comment">// duration timers or not</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <span class="comment">// 2 search timers will be active if enabled, 5 seconds apart.</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            <span class="comment">// reschedule them for 5 minutes</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>-&gt;timerId() == m_firstSearchTimer)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            {</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                killTimer(m_firstSearchTimer);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a7eb4da2ab784a3a2e30db764e412f724">SendSearch</a>();</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                m_firstSearchTimer = startTimer(5 * 60 * 1000);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            }</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>-&gt;timerId() == m_secondSearchTimer)</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                killTimer(m_secondSearchTimer);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a7eb4da2ab784a3a2e30db764e412f724">SendSearch</a>();</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                m_secondSearchTimer = startTimer(5 * 60 * 1000);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="comment">// 2 announce timers will be active if enabled - a short time apart</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="comment">// reshechedule them for every 10 minutes - although max-age is set to 30 mins (1800 seconds)</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>-&gt;timerId() == m_firstAnnounceTimer)</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                killTimer(m_firstAnnounceTimer);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">SendAnnounce</a>(<span class="keyword">false</span>, <span class="keyword">true</span>); <span class="comment">//IPv4 alive</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                <span class="keywordflow">if</span> (m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a56381f0140b8900f6dfbf88bb0a9f93b">ipv6</a>)</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">SendAnnounce</a>(<span class="keyword">true</span>, <span class="keyword">true</span>);  <span class="comment">//IPv6 alive</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                m_firstAnnounceTimer = startTimer(10 * 60 * 1000);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>-&gt;timerId() == m_secondAnnounceTimer)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                killTimer(m_secondAnnounceTimer);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">SendAnnounce</a>(<span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                <span class="keywordflow">if</span> (m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a56381f0140b8900f6dfbf88bb0a9f93b">ipv6</a>)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">SendAnnounce</a>(<span class="keyword">true</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                m_secondAnnounceTimer = startTimer(10 * 60 * 1000);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            <span class="comment">// refresh the cache</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>-&gt;timerId() == m_refreshTimer)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                Refresh();</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, <span class="stringliteral">&quot;Timer even from unknown timer&quot;</span>);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">return</span> QObject::event(Event);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;}</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#a19135cfe7c3bc7b821563ee2689cb207">  638</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a19135cfe7c3bc7b821563ee2689cb207">TorcSSDP::Read</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;{</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    QUdpSocket *socket = <span class="keyword">dynamic_cast&lt;</span>QUdpSocket*<span class="keyword">&gt;</span>(sender());</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">while</span> (socket &amp;&amp; socket-&gt;hasPendingDatagrams())</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        QHostAddress address;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        quint16 port;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        QByteArray datagram;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        datagram.resize(socket-&gt;pendingDatagramSize());</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        socket-&gt;readDatagram(datagram.data(), datagram.size(), &amp;address, &amp;port);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="comment">// filter out our own messages.</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="comment">// N.B. this also filters out messages from other instances running on the same device (with the same ip)</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="keywordflow">if</span> ((m_ipv4MulticastSocket &amp;&amp; (port == m_ipv4MulticastSocket-&gt;localPort())) || (m_ipv6LinkMulticastSocket &amp;&amp; (port == m_ipv6LinkMulticastSocket-&gt;localPort())))</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <span class="keywordflow">if</span> (m_addressess.contains(address))</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="comment">// use a QString for greater flexibility in splitting and searching text</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        QString data(datagram);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_DEBUG, <span class="stringliteral">&quot;Raw datagram:\r\n&quot;</span> + data);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="comment">// split data into lines</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        QStringList lines = data.split(<span class="stringliteral">&quot;\r\n&quot;</span>, QString::SkipEmptyParts);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="keywordflow">if</span> (lines.isEmpty())</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        QMap&lt;QString,QString&gt; headers;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="comment">// pull out type</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        QString type = lines.takeFirst().trimmed();</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">// process headers</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keywordflow">while</span> (!lines.isEmpty())</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            QString header = lines.takeFirst();</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <span class="keywordtype">int</span> index = header.indexOf(<span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="keywordflow">if</span> (index &gt; -1)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                headers.insert(header.left(index).trimmed().toLower(), header.mid(index + 1).trimmed());</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        }</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">if</span> (type.startsWith(<span class="stringliteral">&quot;HTTP&quot;</span>, Qt::CaseInsensitive))</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="comment">// response</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="keywordflow">if</span> (headers.contains(<span class="stringliteral">&quot;cache-control&quot;</span>))</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                qint64 expires = GetExpiryTime(headers.value(<span class="stringliteral">&quot;cache-control&quot;</span>));</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                <span class="keywordflow">if</span> (expires &gt; 0)</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                    ProcessDevice(headers, expires, <span class="keyword">true</span><span class="comment">/*add*/</span>);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type.startsWith(<span class="stringliteral">&quot;NOTIFY&quot;</span>, Qt::CaseInsensitive))</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="comment">// notfification ssdp:alive or ssdp:bye</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="keywordflow">if</span> (headers.contains(<span class="stringliteral">&quot;nts&quot;</span>))</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="keywordtype">bool</span> add = headers[<span class="stringliteral">&quot;nts&quot;</span>] != <span class="stringliteral">&quot;ssdp:byebye&quot;</span>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                <span class="keywordflow">if</span> (add)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    <span class="keywordflow">if</span> (headers.contains(<span class="stringliteral">&quot;cache-control&quot;</span>))</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                    {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        qint64 expires = GetExpiryTime(headers.value(<span class="stringliteral">&quot;cache-control&quot;</span>));</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                        <span class="keywordflow">if</span> (expires &gt; 0)</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                            ProcessDevice(headers, expires, <span class="keyword">true</span><span class="comment">/*add*/</span>);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                    }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                    ProcessDevice(headers, 1, <span class="keyword">false</span><span class="comment">/*remove*/</span>);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            }</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type.startsWith(<span class="stringliteral">&quot;M-SEARCH&quot;</span>, Qt::CaseInsensitive))</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="comment">// check MAN for ssdp:discover</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordflow">if</span> (headers.value(<span class="stringliteral">&quot;man&quot;</span>).contains(<span class="stringliteral">&quot;ssdp:discover&quot;</span>,Qt::CaseInsensitive))</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="comment">// already have host address from datagram</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                <span class="comment">// need MX value in seconds</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                <span class="comment">// lazy - should be present and in the range 1-120 - but limit to 5</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                <span class="keywordtype">int</span> mx = qBound(1, headers.value(<span class="stringliteral">&quot;mx&quot;</span>).toInt(), 5);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                <span class="comment">// check the target</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                TorcSSDPSearchResponse::ResponseTypes types(<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769cae92770ec3cf2afc093f57610043a4a0a">TorcSSDPSearchResponse::None</a>);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                QString st = headers.value(<span class="stringliteral">&quot;st&quot;</span>);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                <span class="keywordflow">if</span> (st == <span class="stringliteral">&quot;ssdp:all&quot;</span>)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                    types |= <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769ca22b89dc38bf5bac1ace9913bf4d8bd83">TorcSSDPSearchResponse::Root</a>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                    types |= <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769cae0a196c14b34c27685c313971a85e03a">TorcSSDPSearchResponse::UUID</a>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                    types |= <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769ca083bc1b9df6b6dac3ede55b322c7a00b">TorcSSDPSearchResponse::Device</a>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (st == <span class="stringliteral">&quot;upnp:rootdevice&quot;</span>)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                    types |= <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769ca22b89dc38bf5bac1ace9913bf4d8bd83">TorcSSDPSearchResponse::Root</a>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (st.startsWith(<span class="stringliteral">&quot;uuid:&quot;</span>))</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                    <span class="keywordflow">if</span> (st.mid(5) == <a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>)</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                        types |= <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769cae0a196c14b34c27685c313971a85e03a">TorcSSDPSearchResponse::UUID</a>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                }</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (st == <a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>)</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                    types |= <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769ca083bc1b9df6b6dac3ede55b322c7a00b">TorcSSDPSearchResponse::Device</a>;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                <span class="keywordflow">if</span> (types &gt; <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769cae92770ec3cf2afc093f57610043a4a0a">TorcSSDPSearchResponse::None</a>)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                    qint64 firstrandom  = qrand() % ((mx * 1000) &gt;&gt; 1);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                    qint64 secondrandom = qrand() % (mx * 1000);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                    m_responseQueue.insertMulti(QDateTime::currentMSecsSinceEpoch() + firstrandom, <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html">TorcSSDPSearchResponse</a>(address, types, port));</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                    m_responseQueue.insertMulti(QDateTime::currentMSecsSinceEpoch() + secondrandom, <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html">TorcSSDPSearchResponse</a>(address, types, port));</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                    <span class="comment">// if the first response is due before the response timer times out, reset it.</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                    firstrandom = qMin(firstrandom, secondrandom);</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                    <span class="keywordflow">if</span> (firstrandom &lt; m_responseTimer.remainingTime())</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                        m_responseTimer.start(firstrandom + 1);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                }</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_INFO, <span class="stringliteral">&quot;Unknown MAN value in search request &quot;</span>);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;}</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno"><a class="line" href="../../d7/d61/class_torc_s_s_d_p.html#ab28eb676648e2fb0e0356f3de140c98b">  764</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#ab28eb676648e2fb0e0356f3de140c98b">TorcSSDP::ProcessResponses</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;{</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    qint64 timenow = QDateTime::currentMSecsSinceEpoch();</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordtype">bool</span> finished = <span class="keyword">false</span>;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordflow">while</span> (!finished &amp;&amp; !m_responseQueue.isEmpty())</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        qint64 time = m_responseQueue.firstKey();</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="keywordflow">if</span> (time &lt;= timenow)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html">TorcSSDPSearchResponse</a> response = m_responseQueue.take(time);</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            ProcessResponse(response);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            finished = <span class="keyword">true</span>;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        }</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    qint64 nextcheck = 5000;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordflow">if</span> (!m_responseQueue.isEmpty())</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        nextcheck = m_responseQueue.firstKey() - timenow;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    m_responseTimer.start(nextcheck);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;}</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="keywordtype">void</span> TorcSSDP::ProcessResponse(<span class="keyword">const</span> <a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html">TorcSSDPSearchResponse</a> &amp;Response)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;{</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">if</span> (!m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>)</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_ERR, QString(<span class="stringliteral">&quot;Cannot send response to %1 - no port set, not advertising!&quot;</span>)</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            .arg(Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a0d98bbcc302539bf981f5a4c83007d43">m_responseAddress</a>.toString()));</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    }</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">/* As per notify (NT -&gt; ST)</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">     * Root   - ST: upnp:rootdevice                             USN: uuid:device-UUID::upnp:rootdevice</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">     * UUID   - ST: uuid:device-UUID                            USN: uuid:device-UUID</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">     * Device - ST: urn:schemas-torcapp-org:device:TorcClient:1 USN: uuid:device-UUID::urn:schemas-torcapp-org:device:TorcClient:1</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="comment">// TODO this duplicates format from TorcHTTPRequest</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> QString dateformat(<span class="stringliteral">&quot;ddd, dd MMM yyyy HH:mm:ss &#39;GMT&#39;&quot;</span>);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> QString reply(<span class="stringliteral">&quot;HTTP/1.1 200 OK\r\n&quot;</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                               <span class="stringliteral">&quot;CACHE-CONTROL: max-age=1800\r\n&quot;</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                               <span class="stringliteral">&quot;DATE: %1\r\n&quot;</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                               <span class="stringliteral">&quot;EXT:\r\n&quot;</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                               <span class="stringliteral">&quot;LOCATION: http%2://%3:%4/upnp/description\r\n&quot;</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                               <span class="stringliteral">&quot;SERVER: %5\r\n&quot;</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                               <span class="stringliteral">&quot;ST: %6\r\n&quot;</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                               <span class="stringliteral">&quot;USN: %7\r\n&quot;</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                               <span class="stringliteral">&quot;NAME: %8\r\n&quot;</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                               <span class="stringliteral">&quot;APIVERSION: %9\r\n&quot;</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                               <span class="stringliteral">&quot;STARTTIME: %10\r\n&quot;</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                               <span class="stringliteral">&quot;PRIORITY: %11\r\n%12\r\n&quot;</span>);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    QString date       = QDateTime::currentDateTime().toString(dateformat);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    QString uuid       = QString(<span class="stringliteral">&quot;uuid:&quot;</span>) + <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#aa09db82a2aaa43aa08cef5f30d32e271">GetUuid</a>();</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordtype">bool</span> ipv6          = Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a0d98bbcc302539bf981f5a4c83007d43">m_responseAddress</a>.protocol() == QAbstractSocket::IPv6Protocol;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">if</span> ((ipv6 &amp;&amp; m_ipv6Address.isEmpty()) || (!ipv6 &amp;&amp; m_ipv4Address.isEmpty()))</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    QUdpSocket *socket = ipv6 ? m_ipv6UnicastSocket : m_ipv4UnicastSocket;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    QString raddress   = QString(<span class="stringliteral">&quot;%1:%2&quot;</span>).arg(Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a0d98bbcc302539bf981f5a4c83007d43">m_responseAddress</a>.toString()).arg(Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#abf7aefdc04c3701849622cebafe2f996">m_port</a>);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    QString secure     = m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a72c26ba82b22a758e5612f82d794d6ac">secure</a> ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    QString secure2    = m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a72c26ba82b22a758e5612f82d794d6ac">secure</a> ? <span class="stringliteral">&quot;SECURE: yes\r\n&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    QString name       = <a class="code" href="../../db/dc7/class_torc_h_t_t_p_server.html#acd8ffa7ed1862bfdba35af63855a2a8d">TorcHTTPServer::ServerDescription</a>();</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    QString apiversion = <a class="code" href="../../d1/d54/class_torc_h_t_t_p_services.html#ae8444ae326f123a375ff798be6a121b3">TorcHTTPServices::GetVersion</a>();</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    QString starttime  = QString::number(<a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#a6b6b5cc4732fee612a1a5e3ebe2cfcf1">GetStartTime</a>());</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    QString priority   = QString::number(<a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d7/d17/class_torc_local_context.html#a6585544b1dd0f8ebb815ed3ad150a2cd">GetPriority</a>());</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordtype">int</span> sent;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    QByteArray packet;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">if</span> (Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a4e81c6fc74ddbc3abf918e1c9209dd48">m_responseTypes</a>.testFlag(<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769ca22b89dc38bf5bac1ace9913bf4d8bd83">TorcSSDPSearchResponse::Root</a>))</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    {</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        packet = QString(reply).arg(date).arg(secure).arg(ipv6 ? m_ipv6Address : m_ipv4Address).arg(m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>).arg(m_serverString).arg(<span class="stringliteral">&quot;upnp:rootdevice&quot;</span>)</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                               .arg(uuid + <span class="stringliteral">&quot;::upnp:rootdevice&quot;</span>).arg(name).arg(apiversion).arg(starttime).arg(priority).arg(secure2).toLocal8Bit();</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        sent = socket-&gt;writeDatagram(packet, Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a0d98bbcc302539bf981f5a4c83007d43">m_responseAddress</a>, Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#abf7aefdc04c3701849622cebafe2f996">m_port</a>);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="keywordflow">if</span> (sent != packet.size())</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;Error sending SSDP root search response to %1 (%2)&quot;</span>).arg(raddress).arg(socket-&gt;errorString()));</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_INFO, QString(<span class="stringliteral">&quot;Sent SSDP root search response to %1&quot;</span>).arg(raddress));</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    }</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">if</span> (Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a4e81c6fc74ddbc3abf918e1c9209dd48">m_responseTypes</a>.testFlag(<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769cae0a196c14b34c27685c313971a85e03a">TorcSSDPSearchResponse::UUID</a>))</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        packet = QString(reply).arg(date).arg(secure).arg(ipv6 ? m_ipv6Address : m_ipv4Address).arg(m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>).arg(m_serverString).arg(uuid)</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                               .arg(uuid).arg(name).arg(apiversion).arg(starttime).arg(priority).arg(secure2).toLocal8Bit();</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        sent = socket-&gt;writeDatagram(packet, Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a0d98bbcc302539bf981f5a4c83007d43">m_responseAddress</a>, Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#abf7aefdc04c3701849622cebafe2f996">m_port</a>);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">if</span> (sent != packet.size())</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;Error sending SSDP UUID search response to %1 (%2)&quot;</span>).arg(raddress).arg(socket-&gt;errorString()));</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_INFO, QString(<span class="stringliteral">&quot;Sent SSDP UUID search response to %1&quot;</span>).arg(raddress));</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    }</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">if</span> (Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a4e81c6fc74ddbc3abf918e1c9209dd48">m_responseTypes</a>.testFlag(<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769ca083bc1b9df6b6dac3ede55b322c7a00b">TorcSSDPSearchResponse::Device</a>))</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        packet = QString(reply).arg(date).arg(secure).arg(ipv6 ? m_ipv6Address : m_ipv4Address).arg(m_announceOptions.<a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">port</a>).arg(m_serverString).arg(<a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>)</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                               .arg(uuid + <span class="stringliteral">&quot;::&quot;</span> + <a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>).arg(name).arg(apiversion).arg(starttime).arg(priority).arg(secure2).toLocal8Bit();</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        sent = socket-&gt;writeDatagram(packet, Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a0d98bbcc302539bf981f5a4c83007d43">m_responseAddress</a>, Response.<a class="code" href="../../d9/d91/class_torc_s_s_d_p_search_response.html#abf7aefdc04c3701849622cebafe2f996">m_port</a>);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">if</span> (sent != packet.size())</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_WARNING, QString(<span class="stringliteral">&quot;Error sending SSDP Device search response to %1 (%2)&quot;</span>).arg(raddress).arg(socket-&gt;errorString()));</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_INFO, QString(<span class="stringliteral">&quot;Sent SSDP UUID Device response to %1&quot;</span>).arg(raddress));</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    }</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;}</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="keywordtype">void</span> TorcSSDP::Refresh(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;{</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">if</span> (!m_started)</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    qint64 now = QDateTime::currentMSecsSinceEpoch();</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// remove stale discovered devices (if still present, they should have notified</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">// a refresh)</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    QList&lt;TorcUPNPDescription&gt; removed;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    QMutableHashIterator&lt;QString,TorcUPNPDescription&gt; it(m_discoveredDevices);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">while</span> (it.hasNext())</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        it.next();</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keywordflow">if</span> (it.value().GetExpiry() &lt; now)</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            removed &lt;&lt; it.value();</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            it.remove();</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="comment">// notify removal</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    QList&lt;TorcUPNPDescription&gt;::const_iterator it2 = removed.begin();</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">for</span> ( ; it2 != removed.end(); ++it2)</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        QVariantMap data;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        data.insert(<span class="stringliteral">&quot;usn&quot;</span>, (*it2).GetUSN());</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a> <span class="keyword">event</span> = <a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a>(<a class="code" href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473aec50861553c03287693438ea703b12cf">Torc::ServiceWentAway</a>, data);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d8/d49/class_torc_observable.html#ae7e6e9e00d6fd50bc062690104012779">Notify</a>(<a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_NETWORK, LOG_INFO, QString(<span class="stringliteral">&quot;Removed %1 stale cache entries&quot;</span>).arg(removed.size()));</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;}</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="keywordtype">void</span> TorcSSDP::ProcessDevice(<span class="keyword">const</span> QMap&lt;QString,QString&gt; &amp;Headers, qint64 Expires, <span class="keywordtype">bool</span> Add)</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;{</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="keywordflow">if</span> (!Headers.contains(<span class="stringliteral">&quot;usn&quot;</span>) || !Headers.contains(<span class="stringliteral">&quot;location&quot;</span>) || Expires &lt; 1)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    QString USN = Headers.value(<span class="stringliteral">&quot;usn&quot;</span>);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    QString location = Headers.value(<span class="stringliteral">&quot;location&quot;</span>);</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">if</span> (!USN.contains(<a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>))</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordtype">bool</span> notify = <span class="keyword">true</span>;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span> (m_discoveredDevices.contains(USN))</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="comment">// is this just an expiry update?</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordflow">if</span> (Add)</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            notify = <span class="keyword">false</span>;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            (void)m_discoveredDevices.remove(USN);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            m_discoveredDevices.insert(USN, <a class="code" href="../../d8/d2c/class_torc_u_p_n_p_description.html">TorcUPNPDescription</a>(USN, location, Expires));</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            (void)m_discoveredDevices.remove(USN);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        }</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    }</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Add)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    {</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        m_discoveredDevices.insert(USN, <a class="code" href="../../d8/d2c/class_torc_u_p_n_p_description.html">TorcUPNPDescription</a>(USN, location, Expires));</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="comment">// update interested parties</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <span class="keywordflow">if</span> (notify)</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    {</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        QVariantMap data;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        data.insert(<span class="stringliteral">&quot;usn&quot;</span>, USN);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        data.insert(<span class="stringliteral">&quot;address&quot;</span>, location);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        data.insert(<span class="stringliteral">&quot;name&quot;</span>, Headers.value(<span class="stringliteral">&quot;name&quot;</span>));</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        data.insert(<span class="stringliteral">&quot;apiversion&quot;</span>, Headers.value(<span class="stringliteral">&quot;apiversion&quot;</span>));</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        data.insert(<span class="stringliteral">&quot;starttime&quot;</span>, Headers.value(<span class="stringliteral">&quot;starttime&quot;</span>));</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        data.insert(<span class="stringliteral">&quot;priority&quot;</span>, Headers.value(<span class="stringliteral">&quot;priority&quot;</span>));</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        <span class="keywordflow">if</span> (Headers.contains(<span class="stringliteral">&quot;secure&quot;</span>))</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            data.insert(<span class="stringliteral">&quot;secure&quot;</span>, <span class="stringliteral">&quot;yes&quot;</span>);</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <a class="code" href="../../d6/d78/class_torc_event.html">TorcEvent</a> <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">event</a>(Add ? <a class="code" href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473a523a01f7afe6f38dcf15963fb967d8ab">Torc::ServiceDiscovered</a> : <a class="code" href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473aec50861553c03287693438ea703b12cf">Torc::ServiceWentAway</a>, data);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <a class="code" href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a>-&gt;<a class="code" href="../../d8/d49/class_torc_observable.html#ae7e6e9e00d6fd50bc062690104012779">Notify</a>(event);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;}</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="keywordtype">void</span> TorcSSDP::StartSearch(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;{</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>-&gt;lock();</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <a class="code" href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a> newoptions = <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a2b9a9048af5f3f9ecb45a330d5f03095">gSearchOptions</a>;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">gSSDPLock</a>-&gt;unlock();</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordflow">if</span> (m_searching &amp;&amp; newoptions == m_searchOptions)</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;SSDP search options unchanged - not restarting&quot;</span>);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    }</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    StopSearch();</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Starting SSDP search for %1 devices&quot;</span>).arg(<a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>));</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    m_searchOptions = newoptions;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="comment">// schedule first search almost immediately - this is evented to ensure subsequent searches are scheduled</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    m_firstSearchTimer = startTimer(1, Qt::CoarseTimer);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">// and schedule another search for after the MX time in our first request (3)</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    m_secondSearchTimer = startTimer(5000, Qt::CoarseTimer);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    m_searchDebugged = <span class="keyword">false</span>;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    m_searching = <span class="keyword">true</span>;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;}</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="keywordtype">void</span> TorcSSDP::StopSearch(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;{</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keywordflow">if</span> (m_searching)</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, QString(<span class="stringliteral">&quot;Stopping SSDP search for %1 devices&quot;</span>).arg(<a class="code" href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a>));</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">if</span> (m_firstSearchTimer)</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    {</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        killTimer(m_firstSearchTimer);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        m_firstSearchTimer = 0;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">if</span> (m_secondSearchTimer)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    {</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        killTimer(m_secondSearchTimer);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        m_secondSearchTimer = 0;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    m_searching = <span class="keyword">false</span>;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;}</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;qint64 TorcSSDP::GetExpiryTime(<span class="keyword">const</span> QString &amp;Expires)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;{</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">// NB this ignores the date header - just assume it is correct</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordtype">int</span> index = Expires.indexOf(<span class="stringliteral">&quot;max-age&quot;</span>, 0, Qt::CaseInsensitive);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="keywordflow">if</span> (index &gt; -1)</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="keywordtype">int</span> index2 = Expires.indexOf(<span class="stringliteral">&quot;=&quot;</span>, index);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">if</span> (index2 &gt; -1)</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        {</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            <span class="keywordtype">int</span> seconds = Expires.mid(index2 + 1).toInt();</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            <span class="keywordflow">return</span> QDateTime::currentMSecsSinceEpoch() + 1000 * seconds;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        }</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;}</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"><a class="line" href="../../df/d33/class_torc_s_s_d_p_thread.html#aa881896a310bfb283d00706fe2446a3f"> 1015</a></span>&#160;<a class="code" href="../../df/d33/class_torc_s_s_d_p_thread.html#aa881896a310bfb283d00706fe2446a3f">TorcSSDPThread::TorcSSDPThread</a>() : <a class="code" href="../../d2/d41/class_torc_q_thread.html">TorcQThread</a>(<span class="stringliteral">&quot;SSDP&quot;</span>)</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;{</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;}</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"><a class="line" href="../../df/d33/class_torc_s_s_d_p_thread.html#a823361be30c602fdba3d57e5c9e89a68"> 1019</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/d33/class_torc_s_s_d_p_thread.html#a823361be30c602fdba3d57e5c9e89a68">TorcSSDPThread::Start</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;{</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;SSDP thread starting&quot;</span>);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#add1317e81894c30a1f774210f41ea298">TorcSSDP::Create</a>();</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;}</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"><a class="line" href="../../df/d33/class_torc_s_s_d_p_thread.html#a5e8709732b556e2333aec437404a94ba"> 1025</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/d33/class_torc_s_s_d_p_thread.html#a5e8709732b556e2333aec437404a94ba">TorcSSDPThread::Finish</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;{</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <a class="code" href="../../d7/d61/class_torc_s_s_d_p.html#add1317e81894c30a1f774210f41ea298">TorcSSDP::Create</a>(<span class="keyword">true</span><span class="comment">/*destroy*/</span>);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <a class="code" href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a>(VB_GENERAL, LOG_INFO, <span class="stringliteral">&quot;SSDP thread stopping&quot;</span>);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;}</div><div class="ttc" id="class_torc_html_ae24951db8926b98a75762aef8448e473a523a01f7afe6f38dcf15963fb967d8ab"><div class="ttname"><a href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473a523a01f7afe6f38dcf15963fb967d8ab">Torc::ServiceDiscovered</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dbd/torclocalcontext_8h_source.html#l00062">torclocalcontext.h:62</a></div></div>
<div class="ttc" id="torcssdp_8h_html"><div class="ttname"><a href="../../dd/d3e/torcssdp_8h.html">torcssdp.h</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html_a6d4e6702aa1e073a7cf325081651769ca22b89dc38bf5bac1ace9913bf4d8bd83"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769ca22b89dc38bf5bac1ace9913bf4d8bd83">TorcSSDPSearchResponse::Root</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00029">torcssdp.h:29</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_thread_html_aa881896a310bfb283d00706fe2446a3f"><div class="ttname"><a href="../../df/d33/class_torc_s_s_d_p_thread.html#aa881896a310bfb283d00706fe2446a3f">TorcSSDPThread::TorcSSDPThread</a></div><div class="ttdeci">TorcSSDPThread()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l01015">torcssdp.cpp:1015</a></div></div>
<div class="ttc" id="torcssdp_8h_html_ae94140955813659d90e1c7e72cce8e46"><div class="ttname"><a href="../../dd/d3e/torcssdp_8h.html#ae94140955813659d90e1c7e72cce8e46">TORC_IPV4_UDP_MULTICAST_ADDR</a></div><div class="ttdeci">#define TORC_IPV4_UDP_MULTICAST_ADDR</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00017">torcssdp.h:17</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a5f0a4894979cb515abebb0d81482a770"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a5f0a4894979cb515abebb0d81482a770">TorcSSDP::~TorcSSDP</a></div><div class="ttdeci">~TorcSSDP()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00109">torcssdp.cpp:109</a></div></div>
<div class="ttc" id="torclocalcontext_8cpp_html_a071080a60a9799e8b9609cb8898ef14f"><div class="ttname"><a href="../../da/d67/torclocalcontext_8cpp.html#a071080a60a9799e8b9609cb8898ef14f">gLocalContext</a></div><div class="ttdeci">TorcLocalContext * gLocalContext</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00047">torclocalcontext.cpp:47</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a5756d02177329eab70632f5dd5076beb"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a5756d02177329eab70632f5dd5076beb">TorcSSDP::gSSDP</a></div><div class="ttdeci">static TorcSSDP * gSSDP</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00057">torcssdp.h:57</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a5032a0649b1ac1d8d6e37ad88c2aa8da"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a5032a0649b1ac1d8d6e37ad88c2aa8da">TorcSSDP::gSSDPLock</a></div><div class="ttdeci">static QMutex * gSSDPLock</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00058">torcssdp.h:58</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_ad847f6d3d9c43bf61ad2869a53e392f0"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#ad847f6d3d9c43bf61ad2869a53e392f0">TorcSSDP::SendAnnounce</a></div><div class="ttdeci">void SendAnnounce(bool IPv6, bool Alive)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00503">torcssdp.cpp:503</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html_a0d98bbcc302539bf981f5a4c83007d43"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a0d98bbcc302539bf981f5a4c83007d43">TorcSSDPSearchResponse::m_responseAddress</a></div><div class="ttdeci">QHostAddress m_responseAddress</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00040">torcssdp.h:40</a></div></div>
<div class="ttc" id="torcssdp_8h_html_a61e57da949c4343c7aaf653dde7232e9"><div class="ttname"><a href="../../dd/d3e/torcssdp_8h.html#a61e57da949c4343c7aaf653dde7232e9">TORC_IPV6_UDP_MULTICAST_URL</a></div><div class="ttdeci">#define TORC_IPV6_UDP_MULTICAST_URL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00021">torcssdp.h:21</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a6127ee169ed7612aa6d99c6c847c760a"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a6127ee169ed7612aa6d99c6c847c760a">TorcSSDP::CancelAnnouncePriv</a></div><div class="ttdeci">void CancelAnnouncePriv(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00447">torcssdp.cpp:447</a></div></div>
<div class="ttc" id="class_torc_html_ae24951db8926b98a75762aef8448e473aec50861553c03287693438ea703b12cf"><div class="ttname"><a href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473aec50861553c03287693438ea703b12cf">Torc::ServiceWentAway</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dbd/torclocalcontext_8h_source.html#l00063">torclocalcontext.h:63</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a7eb4da2ab784a3a2e30db764e412f724"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a7eb4da2ab784a3a2e30db764e412f724">TorcSSDP::SendSearch</a></div><div class="ttdeci">void SendSearch(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00382">torcssdp.cpp:382</a></div></div>
<div class="ttc" id="torcadminthread_8h_html"><div class="ttname"><a href="../../dd/dd5/torcadminthread_8h.html">torcadminthread.h</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_ad07e43d22a5c733b408d26fafbb8256b"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#ad07e43d22a5c733b408d26fafbb8256b">TorcSSDP::AnnouncePriv</a></div><div class="ttdeci">void AnnouncePriv(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00440">torcssdp.cpp:440</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a99f3b9bc646f776011d2edce80c01a01"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a99f3b9bc646f776011d2edce80c01a01">TorcSSDP::CancelAnnounce</a></div><div class="ttdeci">static void CancelAnnounce(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00305">torcssdp.cpp:305</a></div></div>
<div class="ttc" id="class_torc_network_html_a4ce7f625cf153e5e7b07434ed688dbea"><div class="ttname"><a href="../../d8/d73/class_torc_network.html#a4ce7f625cf153e5e7b07434ed688dbea">TorcNetwork::IsGlobal</a></div><div class="ttdeci">static bool IsGlobal(const QHostAddress &amp;Address)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d9c/torcnetwork_8cpp_source.html#l00258">torcnetwork.cpp:258</a></div></div>
<div class="ttc" id="class_torc_local_context_html_aa09db82a2aaa43aa08cef5f30d32e271"><div class="ttname"><a href="../../d7/d17/class_torc_local_context.html#aa09db82a2aaa43aa08cef5f30d32e271">TorcLocalContext::GetUuid</a></div><div class="ttdeci">QString GetUuid(void) const </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00499">torclocalcontext.cpp:499</a></div></div>
<div class="ttc" id="class_torc_network_html_a63a043981858567c24cd286fe8f77e11"><div class="ttname"><a href="../../d8/d73/class_torc_network.html#a63a043981858567c24cd286fe8f77e11">TorcNetwork::IsAvailable</a></div><div class="ttdeci">static bool IsAvailable(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d9c/torcnetwork_8cpp_source.html#l00046">torcnetwork.cpp:46</a></div></div>
<div class="ttc" id="torclogging_8h_html"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html">torclogging.h</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a19135cfe7c3bc7b821563ee2689cb207"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a19135cfe7c3bc7b821563ee2689cb207">TorcSSDP::Read</a></div><div class="ttdeci">void Read(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00638">torcssdp.cpp:638</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_1_1_status_html_a72c26ba82b22a758e5612f82d794d6ac"><div class="ttname"><a href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a72c26ba82b22a758e5612f82d794d6ac">TorcHTTPServer::Status::secure</a></div><div class="ttdeci">bool secure</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1b/torchttpserver_8h_source.html#l00037">torchttpserver.h:37</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_abc16b76005253f4d021a8a22697e8ddd"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#abc16b76005253f4d021a8a22697e8ddd">TorcSSDP::SearchPriv</a></div><div class="ttdeci">void SearchPriv(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00428">torcssdp.cpp:428</a></div></div>
<div class="ttc" id="torcssdp_8h_html_a51611a65bb1cc4852c13a9267ca828b8"><div class="ttname"><a href="../../dd/d3e/torcssdp_8h.html#a51611a65bb1cc4852c13a9267ca828b8">TORC_IPV4_UDP_MULTICAST_URL</a></div><div class="ttdeci">#define TORC_IPV4_UDP_MULTICAST_URL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00018">torcssdp.h:18</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_add1317e81894c30a1f774210f41ea298"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#add1317e81894c30a1f774210f41ea298">TorcSSDP::Create</a></div><div class="ttdeci">static TorcSSDP * Create(bool Destroy=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00314">torcssdp.cpp:314</a></div></div>
<div class="ttc" id="class_torc_u_p_n_p_description_html"><div class="ttname"><a href="../../d8/d2c/class_torc_u_p_n_p_description.html">TorcUPNPDescription</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d1e/torcupnp_8h_source.html#l00009">torcupnp.h:9</a></div></div>
<div class="ttc" id="torccoreutils_8h_html"><div class="ttname"><a href="../../d1/d49/torccoreutils_8h.html">torccoreutils.h</a></div></div>
<div class="ttc" id="torcupnp_8h_html"><div class="ttname"><a href="../../dd/d1e/torcupnp_8h.html">torcupnp.h</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html_a4e81c6fc74ddbc3abf918e1c9209dd48"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a4e81c6fc74ddbc3abf918e1c9209dd48">TorcSSDPSearchResponse::m_responseTypes</a></div><div class="ttdeci">ResponseTypes m_responseTypes</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00041">torcssdp.h:41</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_aae6fd2282aa316bdc6ded69a33db6ee1"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#aae6fd2282aa316bdc6ded69a33db6ee1">TorcSSDP::CancelSearch</a></div><div class="ttdeci">static void CancelSearch(void)</div><div class="ttdoc">Stop searching for a UPnP device type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00283">torcssdp.cpp:283</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a4c42137b3ac13b4a44460e9cf197ab96"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a4c42137b3ac13b4a44460e9cf197ab96">TorcSSDP::Announce</a></div><div class="ttdeci">static void Announce(TorcHTTPServer::Status Options)</div><div class="ttdoc">Publish the device. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00294">torcssdp.cpp:294</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html">TorcSSDP</a></div><div class="ttdoc">The public class for handling Simple Service Discovery Protocol searches and announcements. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00045">torcssdp.h:45</a></div></div>
<div class="ttc" id="class_torc_network_html_a50f0913259a1ad5a0f6c3faafeebd609"><div class="ttname"><a href="../../d8/d73/class_torc_network.html#a50f0913259a1ad5a0f6c3faafeebd609">TorcNetwork::IsLinkLocal</a></div><div class="ttdeci">static bool IsLinkLocal(const QHostAddress &amp;Address)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d9c/torcnetwork_8cpp_source.html#l00229">torcnetwork.cpp:229</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html_abf7aefdc04c3701849622cebafe2f996"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html#abf7aefdc04c3701849622cebafe2f996">TorcSSDPSearchResponse::m_port</a></div><div class="ttdeci">int m_port</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00042">torcssdp.h:42</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a9e86c8c6bcfa458958c9cd0849b91419"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a9e86c8c6bcfa458958c9cd0849b91419">TorcSSDP::gAnnounceOptions</a></div><div class="ttdeci">static TorcHTTPServer::Status gAnnounceOptions</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00062">torcssdp.h:62</a></div></div>
<div class="ttc" id="class_torc_html_ae24951db8926b98a75762aef8448e473af8c2e5445befd829a232aac0c257c3a3"><div class="ttname"><a href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473af8c2e5445befd829a232aac0c257c3a3">Torc::NetworkUnavailable</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dbd/torclocalcontext_8h_source.html#l00058">torclocalcontext.h:58</a></div></div>
<div class="ttc" id="class_torc_event_html_a3cae355e5cf80619e4370890e82d2a84"><div class="ttname"><a href="../../d6/d78/class_torc_event.html#a3cae355e5cf80619e4370890e82d2a84">TorcEvent::TorcEventType</a></div><div class="ttdeci">static Type TorcEventType</div><div class="ttdoc">Register TorcEventType with QEvent. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d66/torcevent_8h_source.html#l00019">torcevent.h:19</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a01fb2b03ee18c9e24677a18f2b13bac5"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a01fb2b03ee18c9e24677a18f2b13bac5">TorcSSDP::gAnnounceEnabled</a></div><div class="ttdeci">static bool gAnnounceEnabled</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00061">torcssdp.h:61</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a50c026037a427016a65e24a6991f74bd"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a50c026037a427016a65e24a6991f74bd">TorcSSDP::Search</a></div><div class="ttdeci">static void Search(TorcHTTPServer::Status Options)</div><div class="ttdoc">Search for Torc UPnP device type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00269">torcssdp.cpp:269</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_thread_html_a5e8709732b556e2333aec437404a94ba"><div class="ttname"><a href="../../df/d33/class_torc_s_s_d_p_thread.html#a5e8709732b556e2333aec437404a94ba">TorcSSDPThread::Finish</a></div><div class="ttdeci">void Finish(void) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l01025">torcssdp.cpp:1025</a></div></div>
<div class="ttc" id="torcloggingdefs_8h_html_a93519f65dd0ef21fc5be0c286a833ae4"><div class="ttname"><a href="../../d1/d37/torcloggingdefs_8h.html#a93519f65dd0ef21fc5be0c286a833ae4">false</a></div><div class="ttdeci">VERBOSE_PREAMBLE General info Playback related messages File and AutoExpire related messages Network protocol related messages Audio related messages JobQueue related messages EIT related messages DSMCC carousel related messages UPnP debugging messages xmltv output and related messages Media Manager debugging messages External executable related messages false</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d37/torcloggingdefs_8h_source.html#l00110">torcloggingdefs.h:110</a></div></div>
<div class="ttc" id="class_torc_network_html_abfa4272255a3ef40373868c06c7479af"><div class="ttname"><a href="../../d8/d73/class_torc_network.html#abfa4272255a3ef40373868c06c7479af">TorcNetwork::IsExternal</a></div><div class="ttdeci">static bool IsExternal(const QHostAddress &amp;Address)</div><div class="ttdoc">Returns true if the address is accessible from other devices. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d9c/torcnetwork_8cpp_source.html#l00222">torcnetwork.cpp:222</a></div></div>
<div class="ttc" id="torcupnp_8h_html_a9e8c9c25e6d9e69b2e66f7e236ca3b0c"><div class="ttname"><a href="../../dd/d1e/torcupnp_8h.html#a9e8c9c25e6d9e69b2e66f7e236ca3b0c">TORC_ROOT_UPNP_DEVICE</a></div><div class="ttdeci">#define TORC_ROOT_UPNP_DEVICE</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d1e/torcupnp_8h_source.html#l00007">torcupnp.h:7</a></div></div>
<div class="ttc" id="torcnetwork_8h_html"><div class="ttname"><a href="../../da/da5/torcnetwork_8h.html">torcnetwork.h</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_ae19905f3250aa4e74eec14f040e9202b"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#ae19905f3250aa4e74eec14f040e9202b">TorcSSDP::TorcSSDP</a></div><div class="ttdeci">TorcSSDP()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00063">torcssdp.cpp:63</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a5abb7fce588cff6cbd6c75a1627922fb"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a5abb7fce588cff6cbd6c75a1627922fb">TorcSSDP::gSearchEnabled</a></div><div class="ttdeci">static bool gSearchEnabled</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00059">torcssdp.h:59</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html">TorcSSDPSearchResponse</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00023">torcssdp.h:23</a></div></div>
<div class="ttc" id="class_torc_event_html"><div class="ttname"><a href="../../d6/d78/class_torc_event.html">TorcEvent</a></div><div class="ttdoc">A general purpose event object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d66/torcevent_8h_source.html#l00009">torcevent.h:9</a></div></div>
<div class="ttc" id="torcssdp_8h_html_ae4a9dced97fa44af2bab554b642fa99b"><div class="ttname"><a href="../../dd/d3e/torcssdp_8h.html#ae4a9dced97fa44af2bab554b642fa99b">TORC_IPV6_UDP_MULTICAST_ADDR2</a></div><div class="ttdeci">#define TORC_IPV6_UDP_MULTICAST_ADDR2</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00020">torcssdp.h:20</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_services_html_ae8444ae326f123a375ff798be6a121b3"><div class="ttname"><a href="../../d1/d54/class_torc_h_t_t_p_services.html#ae8444ae326f123a375ff798be6a121b3">TorcHTTPServices::GetVersion</a></div><div class="ttdeci">static QString GetVersion(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d1a/torchttpservices_8cpp_source.html#l00068">torchttpservices.cpp:68</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_1_1_status_html_ad40bdc4e02c701bb9b1781ca72367b12"><div class="ttname"><a href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#ad40bdc4e02c701bb9b1781ca72367b12">TorcHTTPServer::Status::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1b/torchttpserver_8h_source.html#l00036">torchttpserver.h:36</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html_a6d4e6702aa1e073a7cf325081651769ca083bc1b9df6b6dac3ede55b322c7a00b"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769ca083bc1b9df6b6dac3ede55b322c7a00b">TorcSSDPSearchResponse::Device</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00031">torcssdp.h:31</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_1_1_status_html"><div class="ttname"><a href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html">TorcHTTPServer::Status</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1b/torchttpserver_8h_source.html#l00031">torchttpserver.h:31</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a2b9a9048af5f3f9ecb45a330d5f03095"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a2b9a9048af5f3f9ecb45a330d5f03095">TorcSSDP::gSearchOptions</a></div><div class="ttdeci">static TorcHTTPServer::Status gSearchOptions</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00060">torcssdp.h:60</a></div></div>
<div class="ttc" id="class_torc_observable_html_a171edc659834e25af5862f84e514b215"><div class="ttname"><a href="../../d8/d49/class_torc_observable.html#a171edc659834e25af5862f84e514b215">TorcObservable::AddObserver</a></div><div class="ttdeci">void AddObserver(QObject *Observer)</div><div class="ttdoc">brief Register the given object to receive events. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d74/torcobservable_8cpp_source.html#l00051">torcobservable.cpp:51</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_1_1_status_html_a56381f0140b8900f6dfbf88bb0a9f93b"><div class="ttname"><a href="../../d4/dee/class_torc_h_t_t_p_server_1_1_status.html#a56381f0140b8900f6dfbf88bb0a9f93b">TorcHTTPServer::Status::ipv6</a></div><div class="ttdeci">bool ipv6</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d1b/torchttpserver_8h_source.html#l00039">torchttpserver.h:39</a></div></div>
<div class="ttc" id="class_torc_observable_html_ae7e6e9e00d6fd50bc062690104012779"><div class="ttname"><a href="../../d8/d49/class_torc_observable.html#ae7e6e9e00d6fd50bc062690104012779">TorcObservable::Notify</a></div><div class="ttdeci">void Notify(const TorcEvent &amp;Event)</div><div class="ttdoc">Brief Send the given event to each registered listener/observer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d74/torcobservable_8cpp_source.html#l00067">torcobservable.cpp:67</a></div></div>
<div class="ttc" id="torchttpserver_8h_html"><div class="ttname"><a href="../../df/d1b/torchttpserver_8h.html">torchttpserver.h</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a9ded39944d373ba08cd5747c49c2d8bf"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a9ded39944d373ba08cd5747c49c2d8bf">TorcSSDP::event</a></div><div class="ttdeci">bool event(QEvent *Event) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00566">torcssdp.cpp:566</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_thread_html_a823361be30c602fdba3d57e5c9e89a68"><div class="ttname"><a href="../../df/d33/class_torc_s_s_d_p_thread.html#a823361be30c602fdba3d57e5c9e89a68">TorcSSDPThread::Start</a></div><div class="ttdeci">void Start(void) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l01019">torcssdp.cpp:1019</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html_a6d4e6702aa1e073a7cf325081651769cae92770ec3cf2afc093f57610043a4a0a"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769cae92770ec3cf2afc093f57610043a4a0a">TorcSSDPSearchResponse::None</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00028">torcssdp.h:28</a></div></div>
<div class="ttc" id="class_torc_local_context_html_a6b6b5cc4732fee612a1a5e3ebe2cfcf1"><div class="ttname"><a href="../../d7/d17/class_torc_local_context.html#a6b6b5cc4732fee612a1a5e3ebe2cfcf1">TorcLocalContext::GetStartTime</a></div><div class="ttdeci">qint64 GetStartTime(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00510">torclocalcontext.cpp:510</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_ab28eb676648e2fb0e0356f3de140c98b"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#ab28eb676648e2fb0e0356f3de140c98b">TorcSSDP::ProcessResponses</a></div><div class="ttdeci">void ProcessResponses(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00764">torcssdp.cpp:764</a></div></div>
<div class="ttc" id="class_torc_observable_html_afefd31617891afe709c8dc9d62368d5c"><div class="ttname"><a href="../../d8/d49/class_torc_observable.html#afefd31617891afe709c8dc9d62368d5c">TorcObservable::RemoveObserver</a></div><div class="ttdeci">void RemoveObserver(QObject *Observer)</div><div class="ttdoc">brief Deregister the given object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d74/torcobservable_8cpp_source.html#l00060">torcobservable.cpp:60</a></div></div>
<div class="ttc" id="class_torc_h_t_t_p_server_html_acd8ffa7ed1862bfdba35af63855a2a8d"><div class="ttname"><a href="../../db/dc7/class_torc_h_t_t_p_server.html#acd8ffa7ed1862bfdba35af63855a2a8d">TorcHTTPServer::ServerDescription</a></div><div class="ttdeci">static QString ServerDescription(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/torchttpserver_8cpp_source.html#l00800">torchttpserver.cpp:800</a></div></div>
<div class="ttc" id="class_torc_q_thread_html"><div class="ttname"><a href="../../d2/d41/class_torc_q_thread.html">TorcQThread</a></div><div class="ttdoc">A Torc specific wrapper around QThread. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db0/torcqthread_8h_source.html#l00007">torcqthread.h:7</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html_a2a634eb6a4a9a474ce7d33842763e559"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a2a634eb6a4a9a474ce7d33842763e559">TorcSSDPSearchResponse::TorcSSDPSearchResponse</a></div><div class="ttdeci">TorcSSDPSearchResponse(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00050">torcssdp.cpp:50</a></div></div>
<div class="ttc" id="torcssdp_8h_html_a1ff9f7302adb11794b9542d49fd09e5a"><div class="ttname"><a href="../../dd/d3e/torcssdp_8h.html#a1ff9f7302adb11794b9542d49fd09e5a">TORC_SSDP_UDP_MULTICAST_PORT</a></div><div class="ttdeci">#define TORC_SSDP_UDP_MULTICAST_PORT</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00016">torcssdp.h:16</a></div></div>
<div class="ttc" id="class_torc_html_ae24951db8926b98a75762aef8448e473a5154ecec904db653a391442a7ee99df3"><div class="ttname"><a href="../../d6/db6/class_torc.html#ae24951db8926b98a75762aef8448e473a5154ecec904db653a391442a7ee99df3">Torc::NetworkAvailable</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dbd/torclocalcontext_8h_source.html#l00057">torclocalcontext.h:57</a></div></div>
<div class="ttc" id="torclocalcontext_8h_html"><div class="ttname"><a href="../../dd/dbd/torclocalcontext_8h.html">torclocalcontext.h</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_search_response_html_a6d4e6702aa1e073a7cf325081651769cae0a196c14b34c27685c313971a85e03a"><div class="ttname"><a href="../../d9/d91/class_torc_s_s_d_p_search_response.html#a6d4e6702aa1e073a7cf325081651769cae0a196c14b34c27685c313971a85e03a">TorcSSDPSearchResponse::UUID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3e/torcssdp_8h_source.html#l00030">torcssdp.h:30</a></div></div>
<div class="ttc" id="torclogging_8h_html_a73a147108bf0df6442820b82b022ef94"><div class="ttname"><a href="../../d4/df9/torclogging_8h.html#a73a147108bf0df6442820b82b022ef94">LOG</a></div><div class="ttdeci">#define LOG(_MASK_, _LEVEL_, _FORMAT_,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/df9/torclogging_8h_source.html#l00031">torclogging.h:31</a></div></div>
<div class="ttc" id="class_torc_local_context_html_a6585544b1dd0f8ebb815ed3ad150a2cd"><div class="ttname"><a href="../../d7/d17/class_torc_local_context.html#a6585544b1dd0f8ebb815ed3ad150a2cd">TorcLocalContext::GetPriority</a></div><div class="ttdeci">int GetPriority(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d67/torclocalcontext_8cpp_source.html#l00516">torclocalcontext.cpp:516</a></div></div>
<div class="ttc" id="class_torc_network_html_a7823cef66f9141ae778b4eb2ff3ba0b1"><div class="ttname"><a href="../../d8/d73/class_torc_network.html#a7823cef66f9141ae778b4eb2ff3ba0b1">TorcNetwork::IsLocal</a></div><div class="ttdeci">static bool IsLocal(const QHostAddress &amp;Address)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d9c/torcnetwork_8cpp_source.html#l00238">torcnetwork.cpp:238</a></div></div>
<div class="ttc" id="class_torc_s_s_d_p_html_a0eb025e2313b424eab4394df327f4e5b"><div class="ttname"><a href="../../d7/d61/class_torc_s_s_d_p.html#a0eb025e2313b424eab4394df327f4e5b">TorcSSDP::CancelSearchPriv</a></div><div class="ttdeci">void CancelSearchPriv(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de1/torcssdp_8cpp_source.html#l00435">torcssdp.cpp:435</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 28 2018 14:40:26 for Torc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
